<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>TryHackMe - Break Out The Cage :: sckull — TryHackMe, HackTheBox, CTF Writeups</title>    
  
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Titulo Break Out The Cage     Room Break Out The Cage   Info Help Cage bring back his acting career and investigate the nefarious goings on of his agent!   Puntos 240   Dificultad Facil   Maker Magna    NMAP Escaneo de puertos tcp, nmap nos muestra el puerto ftp (21), http (80) y el puerto ssh (22) abiertos."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://sckull.github.io/posts/breakthecage/" />


<link rel="stylesheet" href="https://sckull.github.io/assets/style.css">


<link rel="stylesheet" href="https://sckull.github.io/style.css">


<link rel="shortcut icon" href="https://sckull.github.io/img/favicon.png">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/57784fec54.js" crossorigin="anonymous"></script>


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="TryHackMe - Break Out The Cage :: sckull — TryHackMe, HackTheBox, CTF Writeups" />
<meta name="twitter:description" content="Titulo Break Out The Cage     Room Break Out The Cage   Info Help Cage bring back his acting career and investigate the nefarious goings on of his agent!   Puntos 240   Dificultad Facil   Maker Magna    NMAP Escaneo de puertos tcp, nmap nos muestra el puerto ftp (21), http (80) y el puerto ssh (22) abiertos." />
<meta name="twitter:site" content="https://sckull.github.io/" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="https://sckull.github.io/image/tryhackme/breakthecage/cover.png">





<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="TryHackMe - Break Out The Cage :: sckull — TryHackMe, HackTheBox, CTF Writeups">
<meta property="og:description" content="Titulo Break Out The Cage     Room Break Out The Cage   Info Help Cage bring back his acting career and investigate the nefarious goings on of his agent!   Puntos 240   Dificultad Facil   Maker Magna    NMAP Escaneo de puertos tcp, nmap nos muestra el puerto ftp (21), http (80) y el puerto ssh (22) abiertos." />
<meta property="og:url" content="https://sckull.github.io/posts/breakthecage/" />
<meta property="og:site_name" content="TryHackMe - Break Out The Cage" />
<meta property="og:image" content="https://sckull.github.io/image/tryhackme/breakthecage/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://sckull.github.io/"
        },
        "articleSection" : "posts",
        "name" : "TryHackMe - Break Out The Cage",
        "headline" : "TryHackMe - Break Out The Cage",
        "description" : "Titulo Break Out The Cage     Room Break Out The Cage   Info Help Cage bring back his acting career and investigate the nefarious goings on of his agent!   Puntos 240   Dificultad Facil   Maker Magna    NMAP Escaneo de puertos tcp, nmap nos muestra el puerto ftp (21), http (80) y el puerto ssh (22) abiertos.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-06-27 00:00:00 &#43;0000 UTC",
        "dateModified" : "2020-06-27 00:00:00 &#43;0000 UTC",
        "url" : "https://sckull.github.io/posts/breakthecage/",
        "wordCount" : "811",
        "keywords" : [ "tryhackme","CTF","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2020-06-27 00:00:00 &#43;0000 UTC" />




<a name="top"></a>
</head>

<body class="dark-theme">
  
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
      
        
                   

          

          

          
            <li><a href="/about">About</a></li>
          

        
      
        
                   

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

        
      
        
                   

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        

          

          

          
            <li><a href="/about">About</a></li>
          

      
    
      
        

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

      
    
      
        

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    

  <div class="post">
    <h2 class="post-title">TryHackMe - Break Out The Cage</h2>
    <div class="post-meta">
      
        <span class="post-date">
          <i class="fas fa-calendar-week"></i>
            Saturday, Jun 27, 2020
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
        <span class="post-read-time">— 4 min read</span>
      
    </div>
        
    
      <span class="post-tags">
        
         <a class="button-tag" href="https://sckull.github.io/tags/tryhackme/"><li class="fa fa-tag"></li> tryhackme</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/ctf/"><li class="fa fa-tag"></li> CTF</a>&nbsp;
        
      </span>
    

    
      
        <img src="https://sckull.github.io/posts/breakthecage/../../image/tryhackme/breakthecage/cover.png" class="post-cover center" />
      
      <hr />
     
    

    <div class="contenido">
      <h2>Contenido</h2>
      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#nmap">NMAP</a></li>
<li><a href="#http">HTTP</a>
<ul>
<li><a href="#gobuster">GOBUSTER</a></li>
</ul></li>
<li><a href="#ftp-task-1">FTP - <em>Task 1</em></a></li>
<li><a href="#user-weston-cage">USER - WESTON -&gt; CAGE</a></li>
<li><a href="#privilege-escalation">PRIVILEGE ESCALATION</a></li>
</ul></li>
</ul>
</nav>
    </div>

    <div class="post-content">      
      

<table>
<thead>
<tr>
<th>Titulo</th>
<th>Break Out The Cage</th>
</tr>
</thead>

<tbody>
<tr>
<td>Room</td>
<td>Break Out The Cage</td>
</tr>

<tr>
<td>Info</td>
<td>Help Cage bring back his acting career and investigate the nefarious goings on of his agent!</td>
</tr>

<tr>
<td>Puntos</td>
<td>240</td>
</tr>

<tr>
<td>Dificultad</td>
<td>Facil</td>
</tr>

<tr>
<td>Maker</td>
<td><a href="https://tryhackme.com/p/Magna">Magna</a></td>
</tr>
</tbody>
</table>

<h2 id="nmap">NMAP</h2>

<p>Escaneo de puertos tcp, nmap nos muestra el puerto ftp (21), http (80) y el puerto ssh (22) abiertos.</p>

<pre><code class="language-bash"># Nmap 7.80 scan initiated Sat Jun 27 22:24:17 2020 as: nmap -sV -o nmap_scan_mini breakthecage.thm
Nmap scan report for breakthecage.thm (10.10.15.25)
Host is up (0.16s latency).
Not shown: 997 closed ports
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Jun 27 22:25:00 2020 -- 1 IP address (1 host up) scanned in 43.71 seconds

# Nmap 7.80 scan initiated Sat Jun 27 22:24:15 2020 as: nmap -T4 -sV -sC -p- -o nmap_scan breakthecage.thm
Nmap scan report for breakthecage.thm (10.10.15.25)
Host is up (0.15s latency).
Not shown: 65532 closed ports
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-r--r--    1 0        0             396 May 25 23:33 dad_tasks
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.8.6.160
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 3
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 dd:fd:88:94:f8:c8:d1:1b:51:e3:7d:f8:1d:dd:82:3e (RSA)
|   256 3e:ba:38:63:2b:8d:1c:68:13:d5:05:ba:7a:ae:d9:3b (ECDSA)
|_  256 c0:a6:a3:64:44:1e:cf:47:5f:85:f6:1f:78:4c:59:d8 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Nicholas Cage Stories
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Jun 27 22:50:38 2020 -- 1 IP address (1 host up) scanned in 1582.44 seconds
</code></pre>

<h2 id="http">HTTP</h2>

<p>Encontramos una pagina web en el puerto 80.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_212632.png" alt="image" /></p>

<h3 id="gobuster">GOBUSTER</h3>

<p>Utilizamos gobuster para busqueda de directorios y archivos.</p>

<pre><code class="language-bash">root@upset:~/thm/breakoutthecage# gobuster dir -u http://breakthecage.thm/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -q -t 125 -x php,html,txt
/images (Status: 301)
/html (Status: 301)
/scripts (Status: 301)
/index.html (Status: 200)
/contracts (Status: 301)
/auditions (Status: 301)
</code></pre>

<p>Encontramos un directorio en donde hay un archivo mp3.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_214502.png" alt="image" /></p>

<p>Utilizamos <code>Sonic Visualiser</code> para verificar que el archivo no tenga algo dentro agregando una capa de espectrograma. Logramos ver una palabra que seguramente nos servira. <em>Puede que alguna de las letras sea engañosa, <code>audacity</code> tambien trae la opcion de agregar una capa de espectrograma.</em>
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_220332.png" alt="image" /></p>

<h2 id="ftp-task-1">FTP - <em>Task 1</em></h2>

<p>Nos conectamos al servicio FTP con las credenciales de anonymous:anonymous y encontramos un archivo que esta codificado en base64.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_220508.png" alt="image" /></p>

<p>Utilizamos <code>CyberChef</code> para decodificar el mensaje, al realizar esto vemos el mensaje &ldquo;descompuesto&rdquo;. Utilizamos <code>Vigenere Cipher</code> con la palabra que encontramos para obtener el mensaje real. <em>Task 1</em>
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_220704.png" alt="image" /></p>

<h2 id="user-weston-cage">USER - WESTON -&gt; CAGE</h2>

<p>Ahora que encontramos la contraseña de weston iniciamos sesion en el servicio ssh. Hacemos una pequeña enumeracion con <code>sudo -l -l</code> y vemos que tenemos permisos root (sudo) para ejecutar el comando <code>/usr/bin/bees</code>. El archivo contiene un comando, pero este no puede ser editado por el usuario actual.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_221307.png" alt="image" /></p>

<p>Utilizamos <code>pspy64</code> para ver si existe algun cronjob en la maquina, esto porque durante la enumeracion de los archivos se imprimia un mensaje diferente en pantalla.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_221929.png" alt="image" /></p>

<p>Encontramos un archivo que se ejecuta y se encuentra en el directorio <code>/opt/</code>.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_222245.png" alt="image" /></p>

<p>El codigo del script en python lee el archivo <code>.quotes</code> en el que hay una larga lista de frases, elige una aleatoria, la imprime mediante el comando <code>wall</code>.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_222425.png" alt="image" /></p>

<p>Para poder tomar ventaja de este script deberia de quedar de la siguiente forma para poder ejecutar comandos y una posible shell inversa.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_222740.png" alt="image" /></p>

<p>Renombramos el archivo <code>.quotes</code>, creamos uno nuevo con una frase y nuestra shell inversa.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_223420.png" alt="image" /></p>

<p>Ponemos a la escucha netcat en nuestra maquina, esperamos, y logramos obtener una shell con el usuario cage.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_223705.png" alt="image" /></p>

<p>Y nuestra flag <strong>user.txt</strong>.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_223835.png" alt="image" /></p>

<h2 id="privilege-escalation">PRIVILEGE ESCALATION</h2>

<p>En la carpeta principal de <em>cage</em> encontramos el archivo <code>id_rsa</code> que nos da acceso a una shell en el servicio ssh. En la carpeta <code>email_backup</code> encontramos varios correos en tres archivos. En uno de ellos hablan sobre una nota y lo que esta decia.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_224722.png" alt="image" /></p>

<p>Intentamos utilizarla como contraseña del usuario root pero no funcionó, por lo que utilizamos nuevamente <code>vignere cipher</code> pero esta vez no teniamos la clave y utilizamos <a href="https://www.dcode.fr/cifrado-vigenere"><strong>dcode.fr</strong></a> ya que nos muestra una lista de posibles claves y su resultado. Logramos encontrar su clave y el mensaje real.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_224915.png" alt="image" /></p>

<p>Utilizamos el mensaje real como contraseña del usuario root y logramos obtener acceso con este usuario, además encontramos nuevamente un backup de correos en su carpeta principal y en uno de ellos nuestra flag *<em>root.txt</em>.
<img src="../../image/tryhackme/breakthecage/Screenshot_20200627_225002.png" alt="image" /></p>

    </div>    
    <hr />
    
    <div>
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://sckull.github.io/posts/yearoftherabbit/">
                <span class="button__icon">←</span>
                <span class="button__text">TryHackMe - Year of the Rabbit</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://sckull.github.io/posts/lianyu/">
                <span class="button__text">TryHackMe - Lian_Yu</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    
  </div>
  
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span style="font-size: 0.85em;">© 2020 sckull</span>
        
      
      </div>
    
  </div>
</footer>

<script src="https://sckull.github.io/assets/main.js"></script>
<script src="https://sckull.github.io/assets/prism.js"></script>


<script src="https://sckull.github.io/assets/zooming.js"></script>
<script>  
  new Zooming({
   bgColor: '#000',
   bgOpacity: 0.5,
   customSize: '100%'
 }).listen('img')
</script>


  
  
  
  <a class="float" id="myBtn" href="#top"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
  
</div>



</body>
</html>
