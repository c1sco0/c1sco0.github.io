<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Hack The Box - Help :: sckull — HackTheBox Writeups, CTF</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Nombre Help     OS Linux   Puntos 20   Dificultad Facil   IP 10.10.10.121   Maker cymtrick      new Chart(document.getElementById(&#34;radar-chart&#34;), { type: &#39;radar&#39;, data: { labels: [&#34;Enumeration&#34;, &#34;Real-Life&#34;, &#34;CVE&#34;, &#34;Custom Exploitation&#34;, &#34;CTF-Like&#34;], datasets: [ { label: &#34;User&#34;, fill: true, backgroundColor: &#34;rgba(179,181,198,0.2)&#34;, borderColor: &#34;rgba(179,181,198,1)&#34;, pointBorderColor: &#34;#fff&#34;, pointBackgroundColor: &#34;rgba(179,181,198,1)&#34;, data: [6.2,7.2,8,2.3,2.8] }, { label: &#34;Maker&#34;, fill: true, backgroundColor: &#34;"/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://sckull.github.io/posts/help/" />


<link rel="stylesheet" href="https://sckull.github.io/assets/style.css">


<link rel="stylesheet" href="https://sckull.github.io/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://sckull.github.io/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://sckull.github.io/img/favicon.png">


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Hack The Box - Help :: sckull — HackTheBox Writeups, CTF" />
<meta name="twitter:description" content="Nombre Help     OS Linux   Puntos 20   Dificultad Facil   IP 10.10.10.121   Maker cymtrick      new Chart(document.getElementById(&#34;radar-chart&#34;), { type: &#39;radar&#39;, data: { labels: [&#34;Enumeration&#34;, &#34;Real-Life&#34;, &#34;CVE&#34;, &#34;Custom Exploitation&#34;, &#34;CTF-Like&#34;], datasets: [ { label: &#34;User&#34;, fill: true, backgroundColor: &#34;rgba(179,181,198,0.2)&#34;, borderColor: &#34;rgba(179,181,198,1)&#34;, pointBorderColor: &#34;#fff&#34;, pointBackgroundColor: &#34;rgba(179,181,198,1)&#34;, data: [6.2,7.2,8,2.3,2.8] }, { label: &#34;Maker&#34;, fill: true, backgroundColor: &#34;" />
<meta name="twitter:site" content="https://sckull.github.io" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="https://sckull.github.io/../../image/htb/help/cover.png">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hack The Box - Help :: sckull — HackTheBox Writeups, CTF">
<meta property="og:description" content="Nombre Help     OS Linux   Puntos 20   Dificultad Facil   IP 10.10.10.121   Maker cymtrick      new Chart(document.getElementById(&#34;radar-chart&#34;), { type: &#39;radar&#39;, data: { labels: [&#34;Enumeration&#34;, &#34;Real-Life&#34;, &#34;CVE&#34;, &#34;Custom Exploitation&#34;, &#34;CTF-Like&#34;], datasets: [ { label: &#34;User&#34;, fill: true, backgroundColor: &#34;rgba(179,181,198,0.2)&#34;, borderColor: &#34;rgba(179,181,198,1)&#34;, pointBorderColor: &#34;#fff&#34;, pointBackgroundColor: &#34;rgba(179,181,198,1)&#34;, data: [6.2,7.2,8,2.3,2.8] }, { label: &#34;Maker&#34;, fill: true, backgroundColor: &#34;" />
<meta property="og:url" content="https://sckull.github.io/posts/help/" />
<meta property="og:site_name" content="Hack The Box - Help" />
<meta property="og:image" content="https://sckull.github.io/../../image/htb/help/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2019-06-05 00:00:00 &#43;0000 UTC" />





</head>
<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />
<body class="">
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="https://sckull.github.io/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#000" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="https://sckull.github.io/about">About</a></li>
        
      
        
          <li><a href="https://sckull.github.io/tags/">Tags</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="https://sckull.github.io/about">About</a></li>
      
    
      
        <li><a href="https://sckull.github.io/tags/">Tags</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    
  <div class="post">
    <h2 class="post-title"><a href="https://sckull.github.io/posts/help/">Hack The Box - Help</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            Wednesday, Jun 5, 2019
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
    </div>
        
    
      <span class="post-tags">Tags:
        
         #<a href="https://sckull.github.io/tags/hackthebox/">hackthebox</a>&nbsp;
        
         #<a href="https://sckull.github.io/tags/nodejs/">nodejs</a>&nbsp;
        
         #<a href="https://sckull.github.io/tags/nmap/">nmap</a>&nbsp;
        
         #<a href="https://sckull.github.io/tags/gobuster/">gobuster</a>&nbsp;
        
         #<a href="https://sckull.github.io/tags/helpdeskz/">helpdeskz</a>&nbsp;
        
         #<a href="https://sckull.github.io/tags/cve-2017-16995/">cve-2017-16995</a>&nbsp;
        
         #<a href="https://sckull.github.io/tags/writeup/">writeup</a>&nbsp;
        
      </span>
    

    
      
        <img src="https://sckull.github.io/posts/help/../../image/htb/help/cover.png" class="post-cover" />
      
      <hr />
     
    
    <div class="post-content">      
      

<table>
<thead>
<tr>
<th>Nombre</th>
<th>Help</th>
</tr>
</thead>

<tbody>
<tr>
<td>OS</td>
<td>Linux</td>
</tr>

<tr>
<td>Puntos</td>
<td>20</td>
</tr>

<tr>
<td>Dificultad</td>
<td>Facil</td>
</tr>

<tr>
<td>IP</td>
<td>10.10.10.121</td>
</tr>

<tr>
<td>Maker</td>
<td><a href="https://www.hackthebox.eu/home/machines/profile/170">cymtrick</a></td>
</tr>
</tbody>
</table>

<div id="grapher"><canvas id="radar-chart" width="100" height="50"></canvas>
    <script>
    new Chart(document.getElementById("radar-chart"), {
    type: 'radar',
    data: {
      labels: ["Enumeration", "Real-Life", "CVE", "Custom Exploitation", "CTF-Like"],
      datasets: [
        {
          label: "User",
          fill: true,
          backgroundColor: "rgba(179,181,198,0.2)",
          borderColor: "rgba(179,181,198,1)",
          pointBorderColor: "#fff",
          pointBackgroundColor: "rgba(179,181,198,1)",
          data: [6.2,7.2,8,2.3,2.8]
        }, {
          label: "Maker",
          fill: true,
          backgroundColor: "rgba(255,99,132,0.2)",
          borderColor: "rgba(255,99,132,1)",
          pointBorderColor: "#fff",
          pointBackgroundColor: "rgba(255,99,132,1)",
          pointBorderColor: "#fff",
          data: [7,8,8,2.3,2]
        }
      ]
    },
    options: {
      title: {
        display: true,
        text: 'Calificacion'
      }
    }
});
    </script>
</div>

<hr />

<h2 id="nmap">NMAP</h2>

<p>Escaneo de puertos con nmap.</p>

<pre><code class="language-bash">Nmap 7.70 scan initiated Sat Jan 19 23:53:49 2019 as: nmap -sV -A -sC -o nmap.tcp 10.10.10.121
Nmap scan report for 10.10.10.121
Host is up (0.20s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.6 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 d5:b0:10:50:74:86:a3:9f:c5:53:6f:3b:4a:24:61:19 (ECDSA)
|_  256 e2:1b:88:d3:76:21:d4:1e:38:15:4a:81:11:b7:99:07 (ED25519)
80/tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
3000/tcp open  http    Node.js Express framework
|_http-title: Site doesn't have a title (application/json; charset=utf-8).
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.70%E=4%D=1/19%OT=22%CT=1%CU=32374%PV=Y%DS=2%DC=T%G=Y%TM=5C440D3
OS:6%P=x86_64-pc-linux-gnu)SEQ(SP=108%GCD=1%ISR=10B%TI=Z%CI=I%II=I%TS=8)OPS
OS:(O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M54DST1
OS:1NW7%O6=M54DST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120)ECN
OS:(R=Y%DF=Y%T=40%W=7210%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A
OS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F
OS:=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%
OS:T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD
OS:=S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 143/tcp)
HOP RTT       ADDRESS
1   168.27 ms 10.10.12.1
2   233.79 ms 10.10.10.121

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done at Sat Jan 19 23:55:02 2019 -- 1 IP address (1 host up) scanned in 74.09 seconds
</code></pre>

<h2 id="http-puerto-80">HTTP - Puerto 80</h2>

<p><img src="../../image/htb/help/Screenshot_20190607_171654.png" alt="image" /></p>

<h2 id="nodejs-puerto-3000">NODEJS - PUERTO 3000</h2>

<p>En este puerto, al visitarlo en firefox nos muestra un mensaje del tipo json.</p>

<pre><code class="language-json">{&quot;message&quot;:&quot;Hi Shiv, To get access please find the credentials with given query&quot;}
</code></pre>

<h2 id="gobuster">GOBUSTER</h2>

<p>Realizamos una busquedad de directorios y archivos con gobuser.</p>

<pre><code class="language-bash">root@sckull:~/htb/help/stuff# gobuster -w /usr/share/wordlists/dirb/common.txt -u http://10.10.10.121/ -np -t 25 -x php,html,txt

=====================================================
Gobuster v2.0.1              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://10.10.10.121/
[+] Threads      : 25
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Extensions   : php,html,txt
[+] Timeout      : 10s
=====================================================
18:29:01 Starting gobuster
=====================================================
/index.html (Status: 200)
/javascript (Status: 301)
/server-status (Status: 403)
/support (Status: 301)
=====================================================
18:32:32 Finished
=====================================================
</code></pre>

<h3 id="support">/support/</h3>

<pre><code class="language-bash">=====================================================
Gobuster v2.0.1              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://10.10.10.121/support/
[+] Threads      : 25
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Extensions   : php,html,txt
[+] Timeout      : 10s
=====================================================
18:34:31 Starting gobuster
=====================================================
/captcha.php (Status: 200)
/controllers (Status: 301)
/css (Status: 301)
/favicon.ico (Status: 200)
/images (Status: 301)
/includes (Status: 301)
/index.php (Status: 200)
/index.php (Status: 200)
/js (Status: 301)
/LICENSE.txt (Status: 200)
/readme.html (Status: 200)
/uploads (Status: 301)
/views (Status: 301)
=====================================================
18:37:12 Finished
=====================================================
</code></pre>

<h2 id="helpdeskz">HelpDeskZ</h2>

<p>En el la direccion <code>/support</code> encontramos una plataforma <code>HelpDeskZ</code> para soporte de sitios web.
<img src="../../image/htb/help/Screenshot_20190607_174038.png" alt="image" /></p>

<p>Investigamos acerca de esta plataforma y encontramos que podemos subir una shell mediante la creacion de un ticket en la plataforma, y tambien encontramos un exploit que se aprovecha de esta vulnerabilidad, dicho exploit se le pasa la url de la plataforma y el nombre de la shell que subimos, con estos parametros el exploit generar un hash md5 con el nombre del archivo y la hora actual.</p>

<p>Exploit: <a href="https://www.exploit-db.com/exploits/40300"><strong>HelpDeskZ 1.0.2 - Arbitrary File Upload</strong></a></p>

<p>La razon por la cual el exploit genera un hash md5 es porque la plataforma al subir un archivo genera un hash md5 con el nombre del archivo y la hora actual, para luego renombrar el archivo con el hash y guardarlo en <code>/uploads/tickets/</code>.</p>

<pre><code class="language-php">$filename = md5($_FILES['attachment']['name'].time()).&quot;.&quot;.$ext;
</code></pre>

<p>Tambien que tomar en cuenta que los archivos que se agregan al ticket se guardan en el directorio <code>/uploads/tickets/</code>.</p>

<p>Codigo de pagina de tickets:
<a href="https://github.com/evolutionscript/HelpDeskZ-1.0/blob/master/controllers/view_tickets_controller.php"><strong>GitHub: view_tickets_controller.php</strong></a></p>

<p>Utilizamos una reverse shell para poder ejecutar comandos dentro de la plataforma para ello vamos  renombrar nuestra reverse shell con caracteres null al final del archivo.</p>

<p>Configuracion Reverse shell:
<img src="../../image/htb/help/Screenshot_20190607_213126.png" alt="image" /></p>

<p>Ya que tenemos nuestra reverse shell debemos de tomar en cuenta que al ejecutar el exploit debemos de tener la misma hora del servidor en el que esta la plataforma. Obtuvimos la &ldquo;hora del servidor&rdquo; mediante la respuesta de un request en burpsuite, para luego utilizar esta &ldquo;hora o timezone&rdquo; en nuestra maquina.</p>

<p><img src="../../image/htb/help/Screenshot_20190607_182031.png" alt="image" /></p>

<h3 id="helpdeskz-ticket">HelpDeskZ - TICKET</h3>

<p>Para crear un ticket nos dirigimos hacia <code>Submit Ticket</code>, seleccionamos General y Siguiete.</p>

<p><img src="../../image/htb/help/Screenshot_20190607_211711.png" alt="image" /></p>

<p>Luego de esto rellenamos los campos que sean obligatorios (*), agregamos nuestro archivo (<code>shell.php%00.jpg</code>) y escribimos el captcha que nos muestra.</p>

<h3 id="exploit">EXPLOIT</h3>

<p>Cuando el archivo es subido ejecutamos nuestro exploit. Hay que mencionar que al exploit se le hicieron unos cambios, uno de ellos fue agregar un valor mas alto al rango y verbosidad.</p>

<pre><code class="language-bash">python exploit.py http://10.10.10.121/support/uploads/tickets/ shell.php
</code></pre>

<p><img src="../../image/htb/help/exploit-py.png" alt="image" /></p>

<p>Al encontrar nuestra reverse shell el exploit se congela y nos muestra la url.</p>

<p><img src="../../image/htb/help/exploitpy-found.png" alt="image" /></p>

<h3 id="netcat">NETCAT</h3>

<p>Por otro lado nuestra terminal en escucha con netcat obtuvo una shell.</p>

<p><img src="../../image/htb/help/shell-nc.png" alt="image" /></p>

<p>Y nuestra flag <code>user.txt</code>.</p>

<p><img src="../../image/htb/help/user-txt_hide.png" alt="image" /></p>

<h2 id="privilege-escalation">PRIVILEGE ESCALATION</h2>

<p>Para escalar privilegios hicimos una pequeña enumeracion, entre ellas el kernel, encontramos que el kernel que esta usando la maquina es vulnerable a un exploit.</p>

<p>Exploit: <a href="https://www.exploit-db.com/exploits/44298"><strong>Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation</strong></a></p>

<p><img src="../../image/htb/help/Screenshot_20190607_212300.png" alt="image" /></p>

<p>Compilamos y descargamos el exploit dentro de lamaquina, al ejecutarlo nos devuelve una shell con privilegios root.</p>

<p><img src="../../image/htb/help/root-user-exploit.png" alt="image" /></p>

<p>Y nuestra flag <code>root.txt</code>.</p>

<p><img src="../../image/htb/help/root-flag_hide.png" alt="image" /></p>

    </div>    
    <hr />
    <div >
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://sckull.github.io/posts/querier/">
                <span class="button__icon">←</span>
                <span class="button__text">Hack The Box - Querier</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://sckull.github.io/posts/chaos/">
                <span class="button__text">Hack The Box - Chaos</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    </div>
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="https://sckull.github.io/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#000" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        
      </div>
    
  </div>
</footer>

<script src="https://sckull.github.io/assets/main.js"></script>
<script src="https://sckull.github.io/assets/prism.js"></script>


  
</div>

</body>
</html>
